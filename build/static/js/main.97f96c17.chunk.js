/*! For license information please see main.97f96c17.chunk.js.LICENSE.txt */
(this.webpackJsonpcirrocumulus=this.webpackJsonpcirrocumulus||[]).push([[0],{269:function(e,t,n){"use strict";n.r(t);var a=n(1),i=n.n(a),r=n(49),o=n(22),s=n(125),l=n(192),c=n(33),u=n(337),d=n(189),h=n(190),p=n(166),f=n(19),v=n(102),b=n.n(v),m=n(193),g=n.n(m),j=n(4),O=n(7),x=n(8),y=n(229),S=function(e){Object(O.a)(n,e);var t=Object(x.a)(n);function n(){return Object(j.a)(this,n),t.apply(this,arguments)}return n}(Object(y.a)(Error)),w=n(25),C=n(5),k=function(){function e(t,n){Object(j.a)(this,e),this.vector=t,this.indices=n}return Object(C.a)(e,[{key:"getName",value:function(){return this.vector.getName()}},{key:"size",value:function(){return this.indices.length}},{key:"get",value:function(e){return this.vector.get(this.indices[e])}}]),e}(),E=n(40),z=n(146),T=n(371),P=n(346),M=n(156),A=n(329),I=n(330),D=n(76),_=n(107),R=n(351),N=n(94),F=n(195),L=n.n(F),B=n(89),U=n.n(B),V=n(0),H=["classes"],W=L()({insensitive:!0}),G={Diverging:["interpolateBrBG","interpolatePRGn","interpolatePiYG","interpolatePuOr","interpolateRdBu","interpolateRdGy","interpolateRdYlBu","interpolateRdYlGn","interpolateSpectral"],"Sequential (Single Hue)":["interpolateBlues","interpolateGreens","interpolateGreys","interpolateOranges","interpolatePurples","interpolateReds"],"Sequential (Multi-Hue)":["interpolateViridis","interpolateInferno","interpolateMagma","interpolatePlasma","interpolateWarm","interpolateCool","interpolateCubehelixDefault","interpolateBuGn","interpolateBuPu","interpolateGnBu","interpolateOrRd","interpolatePuBuGn","interpolatePuBu","interpolatePuRd","interpolateRdPu","interpolateYlGnBu","interpolateYlGn","interpolateYlOrBr","interpolateYlOrRd"],Cyclical:["interpolateRainbow","interpolateSinebow"]},J="SERVER_CAPABILITY_RENAME_CATEGORIES",X="SERVER_CAPABILITY_ADD_DATASET",q=["#393b79","#5254a3","#6b6ecf","#9c9ede","#637939","#8ca252","#b5cf6b","#cedb9c","#8c6d31","#bd9e39","#e7ba52","#e7cb94","#843c39","#ad494a","#d6616b","#e7969c","#7b4173","#a55194","#ce6dbd","#de9ed6"],K=["#3182bd","#6baed6","#9ecae1","#c6dbef","#e6550d","#fd8d3c","#fdae6b","#fdd0a2","#31a354","#74c476","#a1d99b","#c7e9c0","#756bb1","#9e9ac8","#bcbddc","#dadaeb","#636363","#969696","#bdbdbd","#d9d9d9"],Z="obs",Y="obsCat",Q="X",$="featureSet",ee="module",te="count",ne="image",ae="scatter",ie="meta_image",re="min_max_feature",oe="min_max_category",se="none";function le(e,t){var n=e[t];return null!=n&&null!=n.newValue?n.newValue:t}var ce={h1:{component:M.a,props:{gutterBottom:!0,variant:"h5"}},h2:{component:M.a,props:{gutterBottom:!0,variant:"h6"}},h3:{component:M.a,props:{gutterBottom:!0,variant:"subtitle1"}},h4:{component:M.a,props:{gutterBottom:!0,variant:"caption",paragraph:!0}},h5:{component:M.a,props:{gutterBottom:!0,variant:"caption",paragraph:!0}},h6:{component:M.a,props:{gutterBottom:!0,variant:"caption",paragraph:!0}},p:{component:M.a,props:{paragraph:!0}},a:{component:T.a,props:{target:"_blank"}},li:{component:Object(P.a)((function(e){return{listItem:{marginTop:e.spacing(1)}}}))((function(e){var t=e.classes,n=Object(z.a)(e,H);return Object(V.jsx)("li",{className:t.listItem,children:Object(V.jsx)(M.a,Object(E.a)({component:"span"},n))})}))}};function ue(e){function t(t){return e}return t.invert=t,t.domain=t.range=function(t){return arguments.length?e=t[0]:[e,e]},t.copy=function(){return ue(e)},t}function de(e){var t=document.activeElement,n=document.createElement("textarea"),a="rtl"==document.documentElement.getAttribute("dir");n.style.fontSize="12pt",n.style.border="0",n.style.padding="0",n.style.margin="0",n.style.position="absolute",n.style[a?"right":"left"]="-9999px",n.setAttribute("readonly","");var i=window.pageYOffset||document.documentElement.scrollTop;n.style.top=i+"px",n.value=e,t.appendChild(n),n.select(),n.setSelectionRange(0,n.value.length),document.execCommand("copy");t.addEventListener("click",(function e(a){document.activeElement.blur(),window.getSelection().removeAllRanges(),t.removeChild(n),t.removeEventListener("click",e)}))}function he(e){for(var t=e.lastIndexOf("."),n=e.substring(t+1),a=!0,i=0,r=n.length;i<r;i++)if("0"!==n[i]){a=!1;break}return a&&(e=e.substring(0,e.lastIndexOf("."))),e}function pe(e){var t=Object(_.a)().domain([0,255]).range([0,1]),n=e.colorScale,a=e.x.length,i=new Float32Array(4*a);function r(e){return e.r=t(e.r),e.g=t(e.g),e.b=t(e.b),e}if(e.continuous){for(var o=500,s=[],l=n.domain(),c=Object(_.a)().domain(l).range([0,499]),u=0;u<o;++u){var d=c.invert(u);s.push(r(Object(D.e)(n(d))))}for(var h=0,p=0;h<a;++h){var f=e.values[h],v=Math.ceil(c(f));v<0?v=0:v>=o&&(v=499);var b=s[v];i[p++]=b.r,i[p++]=b.g,i[p++]=b.b,i[p++]=1}}else{var m=n.domain(),g=new Map;m.forEach((function(e){g.set(e,r(Object(D.e)(n(e))))}));for(var j=0,O=0;j<a;++j){var x=g.get(e.values[j]);i[O++]=x.r,i[O++]=x.g,i[O++]=x.b,i[O++]=1}}return i}function fe(e){if(e.type===ne){for(var t=[],n=e.colorScale,a=function(e){return e.formatHex()},i=0,r=e.x.length;i<r;i++){var o=Object(D.e)(n(e.values[i]));t.push(a(o))}e.colors=t}else e.type===ae?e.colors=pe(e):e.type===ie&&function(){var t=e.colorScale,n=e.source,a=e.gallerySource,i=e.categoryToStats;if("__count"!==e.name){var r=function(e){var r=i[e],o=e.replaceAll(" ","_");n.querySelectorAll('[id="'+o+'"]').forEach((function(e){var n=void 0===r.value?"#f0f0f0":t(r.value);e.style.fill=n})),a.querySelectorAll('[id="'+o+'"]').forEach((function(e){var n=void 0===r.value?"#f0f0f0":t(r.value);e.style.fill=n}))};for(var o in i)r(o)}else{var s=function(e){var t=i[e],r=e.replaceAll(" ","_");n.querySelectorAll('[id="'+r+'"]').forEach((function(e){0===t.n?(void 0===e.dataset.fill&&(e.dataset.fill=e.style.fill),e.style.fill="#f0f0f0"):void 0!==e.dataset.fill&&(e.style.fill=e.dataset.fill)})),a.querySelectorAll('[id="'+r+'"]').forEach((function(e){0===t.n?(void 0===e.dataset.fill&&(e.dataset.fill=e.style.fill),e.style.fill="#f0f0f0"):void 0!==e.dataset.fill&&(e.style.fill=e.dataset.fill)}))};for(var l in i)s(l)}}()}function ve(e){for(var t=e.length,n=new Uint32Array(t),a=0;a<t;a++)n[e[a]]=a+1;return n}function be(e,t){for(var n=[],a=0,i=e.length;a<i;a++)n.push({value:e[a],position:a});return function(e,t){t?e.sort((function(e,t){return e.value<t.value||e.value===t.value&&e.position<t.position?-1:1})):e.sort((function(e,t){return e.value<t.value||e.value===t.value&&e.position<t.position?1:-1}));for(var n=new Uint32Array(e.length),a=0,i=e.length;a<i;a++)n[a]=e[a].position;return n}(n,t)}function me(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,a=e[t[0]],i=t.length;switch(n){case 1:ge(e,t,(2*a+i-1)/2);break;case 2:ge(e,t,a+i-1);break;case 3:ge(e,t,a);break;case 4:for(var r=Math.round(a),o=0,s=t.length;o<s;o++)e[t[o]]=r+o;break;default:throw new Error}}function ge(e,t,n){for(var a=0,i=t.length;a<i;a++)e[t[a]]=n}function je(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=new Uint32Array(e),a=0;a<e;a++,t++)n[a]=t;return Object(I.a)(n),n}function Oe(e){for(var t=e.length,n=be(e,!0),a=ve(n),i=n.length-1;i>0;i--){e[n[i]]===e[n[i-1]]&&(a[n[i-1]]=a[n[i]])}for(var r=new Float32Array(t),o=0;o<t;o++){var s=a[o],l=e[o];r[o]=l*t/s}for(var c=be(e,!1),u=0;u<c.length-1;u++){var d=c[u],h=c[u+1];r[h]=Math.min(r[h],r[d])}for(var p=0;p<t;p++)r[p]=Math.min(r[p],1);return r}function xe(e,t){for(var n=e.x,a=e.y,i=!1,r=0,o=t.length-1;r<t.length;o=r++){var s=t[r].x,l=t[r].y,c=t[o].x,u=t[o].y;l>a!=u>a&&n<(c-s)*(a-l)/(u-l)+s&&(i=!i)}return i}function ye(e){e.length>1&&(e=U()(e));for(var t="M "+e[0].x+" "+e[0].y,n=1;n<e.length;n++)t+=" L "+e[n].x+" "+e[n].y;return t+=" Z"}function Se(e){return e.startsWith("interpolate")||(e="interpolate"+e),e}function we(e){return N[Se(e)]}function Ce(e){var t=Object(R.a)(e.value).clamp(!0).unknown("#f0f0f0");if(e.reversed){var n=t.interpolator();t.interpolator((function(e){return n(1-e)}))}return t}function ke(e,t){var n=new Set(t);e.forEach((function(e){var a=e.features;a&&a.forEach((function(e){n.has(e)||(t.push(e),n.add(e))}))}))}function Ee(e,t){var n=[];if(t.length>0){var a=new Map;e.forEach((function(e){a.set(e.id,e)})),t.forEach((function(e){var t=Object(f.isString)(e)?e:e.value,i=a.get(t);null!=i&&n.push(i)}))}return n}function ze(e){var t=[],n=[],a=[],i=[],r=[];return e.forEach((function(e){e.type===Q?t.push(e.value):e.type===Z?n.push(e.value):e.type===Y?a.push(e.value):e.type===$?i.push(e.value):e.type===ee?r.push(e.value):console.log("Unknown type: "+e)})),{X:t,obs:n,obsCat:a,featureSets:i,modules:r,featureSetsAdd:[]}}var Te=function(){function e(t,n){Object(j.a)(this,e),this.name=t,this.values=n}return Object(C.a)(e,[{key:"getName",value:function(){return this.name}},{key:"size",value:function(){return this.values.length}},{key:"get",value:function(e){return this.values[e]}},{key:"asArray",value:function(){return this.values}},{key:"isSparse",value:function(){return!1}},{key:Symbol.iterator,value:function(){var e=this,t=0,n=this.values.length;return{next:function(){return t<n?{value:e.values[t++],done:!1}:{done:!0}}}}}]),e}();function Pe(e){var t=e.indexOf("/");if(-1===t)return{name:e,type:Q};var n=e.substring(0,t);return{name:e.substring(t+1),type:n}}function Me(e,t,n){var a={};return e.forEach((function(e){a[e.getName()]=function(e){for(var t=new Map,n=0,a=e.size();n<a;n++){var i=e.get(n),r=t.get(i)||0;t.set(i,r+1)}var o=Array.from(t.keys());o.sort(W);var s=o.map((function(e){return t.get(e)}));return{categories:o,counts:s}}(e)})),t.forEach((function(e){a[e.getName()]=Le(e)})),n.forEach((function(e){a[e.getName()]=Le(e)})),a}function Ae(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=[];return t.forEach((function(t){var i=e[t];if(null==i)throw new Error(t+" not found");var r=new Te(t,i);null!=n&&(r=new k(r,n)),a.push(r)})),a}function Ie(e,t){if(null!=e.embeddings&&e.embeddings.forEach((function(e){if(e.coordinates&&Object.keys(e.coordinates).length>0&&(t[e.name]=e.coordinates),e.values)for(var n in e.values)t[n+"_"+e.name]=e.values[n]})),e.values)for(var n in e.values)t[n]=e.values[n]}function De(e){for(var t={X:[],obs:[]},n=0;n<e.length;n++){var a=Pe(e[n]),i=a.name,r=a.type,o=t[r];void 0===o&&(o=[],t[r]=o),o.push(i)}return t}function _e(e){var t=new Set,n=new Set,a=[];if(e)for(var i=e.filters||[],r=0;r<i.length;r++){var o=i[r],s=o[0];if(Object(f.isObject)(s))a.push(s);else{var l=Pe(s),c=l.name,u=l.type;o[0]=c,"X"===u?t.add(c):n.add(c)}}return{basis:a,X:Array.from(t),obs:Array.from(n)}}function Re(e,t,n){if(t.stats){var a=t.stats.dimensions||[],i=De(t.stats.measures||[]);e.summary=Me(Ae(n,a),Ae(n,i.obs),Ae(n,i.X))}if(t.groupedStats){var r=t.groupedStats.dimensions||[],o=De(t.groupedStats.measures||[]);if(r.length>0){var s=Ne(Ae(n,r[0])),l={};for(var c in o){var u=o[c];u.length>0&&(l[c]=Fe(s,Ae(n,u)))}e.distribution=l}}if(t.selection){var d=t.selection.dimensions||[],h=De(t.selection.measures||[]);e.selection={},e.selection.indices=He(n,t.selection.filter);var p=Array.from(e.selection.indices);if(d.length>0){var f=Ne(Ae(n,d,p)),v={};for(var b in h){var m=h[b];m.length>0&&(v[b]=Fe(f,Ae(n,m,p)))}e.selection.distribution=v}e.selection.summary=Me(Ae(n,d,p),Ae(n,h.obs,e.selection.indices),Ae(n,h.X,p))}}function Ne(e){for(var t={},n=e.length,a=e[0].size(),i=[],r=0;r<a;r++){for(var o=0;o<n;o++)i[o]=e[o].get(r);var s=i.join(", "),l=t[s];void 0===l&&(l={key:i.slice(),indices:[]},t[s]=l),l.indices.push(r)}for(var c=Object.keys(t),u=[],d=0;d<n;d++)u[d]=e[d].getName();return{categories:c,keyToIndices:t,dimensionName:u.join("-"),dimensionNames:u}}function Fe(e,t){var n=[];return e.categories.forEach((function(a){var i=e.keyToIndices[a];t.forEach((function(t){var a=new k(t,i.indices),r=Le(a),o={dimension:e.dimensionName,dimensions:e.dimensionNames,categories:i.key,feature:t.getName(),mean:r.mean,n:a.size(),percentExpressed:r.numExpressed/a.size()*100,vector:a};n.push(o)}))})),n}function Le(e){if(0===e.size())return{min:Number.NaN,max:Number.NaN,sum:Number.NaN,mean:Number.NaN,numExpressed:Number.NaN,logSum:Number.NaN};for(var t=Number.MAX_VALUE,n=-Number.MAX_VALUE,a=0,i=0,r=0,o=0,s=e.size();o<s;o++){var l=e.get(o);t=l<t?l:t,n=l>n?l:n,a+=l,r+=Math.expm1(l),0!==l&&i++}return{min:t,max:n,sum:a,mean:a/e.size(),numExpressed:i,n:e.size(),logSum:r}}function Be(e,t,n){return"or"===n?new Set([].concat(Object(w.a)(e),Object(w.a)(t))):new Set(Object(w.a)(e).filter((function(e){return t.has(e)})))}function Ue(e,t){for(var n=new Set,a=0,i=e.length;a<i;a++)t(e[a])&&n.add(a);return n}function Ve(e){var t,n=e[1],a=e[2];if("in"===n)a=new Set(a),t=function(e){return a.has(e)};else if(">"===n)t=function(e){return e>a};else if("="===n)t=function(e){return e===a};else if("<"===n)t=function(e){return e<a};else if("!="===n)t=function(e){return e!==a};else if(">="===n)t=function(e){return e>=a};else{if("<="!==n)throw new Error("Unknown filter: "+n);t=function(e){return e<=a}}return t}function He(e,t){var n=null;if(t)for(var a=t.filters||[],i=t.combine||"and",r=0;r<a.length;r++){var o=a[r],s=o[0],l=o[2],c=null;if(Object(f.isObject)(s))if(l.indices)c=l.indices;else{for(var u=void 0,d=l.path,h=e[s.name],p=function(t){var n=d[t],a=Ue(e[h[0]],(function(e){return e>=n.x&&e<=n.x+n.width})),i=Ue(e[h[1]],(function(e){return e>=n.y&&e<=n.y+n.height}));if(u=Be(a,i,"and"),n.z){var r=Ue(e[h[2]],(function(e){return e>=n.z&&e<=n.z+n.depth}));u=Be(u,r,"and")}},v=0;v<d.length;v++)p(v);c=c?Be(u,c,i):u}else if("__index"===s)c=new Set(l);else{var b=Pe(s);c=Ue(e[b.name],Ve(o))}n=n?Be(n,c,i):c}return n}var We=function(){function e(){Object(j.a)(this,e)}return Object(C.a)(e,[{key:"init",value:function(e,t){return this.id=e,this.key2data={},this.format="json",this.schema=null,(t.endsWith(".jsonl")||t.endsWith(".jsonl.gz"))&&(this.format="jsonl"),"json"!==this.format||t.endsWith(".json")||t.endsWith(".json.gz")||(t+="schema.json"),this.url=t,this.baseUrl=this.url.substring(0,this.url.lastIndexOf("/")+1),Promise.resolve()}},{key:"getByteRange",value:function(e){var t=this.key2bytes[e];if(!t)throw new Error(e+" not found");return{headers:{Range:"bytes="+t[0]+"-"+t[1]}}}},{key:"_fetchJson",value:function(e){return fetch(this.baseUrl+e+".json").then((function(e){return e.json()}))}},{key:"_fetchJsonl",value:function(e){return fetch(this.url,this.getByteRange(e)).then((function(e){return e.json()})).then((function(t){return t[e]}))}},{key:"_fetch",value:function(e){return"json"===this.format?this._fetchJson(e):this._fetchJsonl(e)}},{key:"fetchData",value:function(e){var t=this,n=[];return e.forEach((function(e){if(null==t.key2data[e]&&"__count"!==e){var a=t._fetch(e).then((function(n){if(Object(f.isArray)(n))t.key2data[e]=n;else if(n.indices||n.index){for(var a=n.indices||n.index,i=n.values||n.value,r=new Float32Array(t.schema.shape[0]),o=0,s=i.length;o<s;o++)r[a[o]]=i[o];t.key2data[e]=r}else if(n.categories){for(var l=new Array(t.schema.shape[0]),c=0,u=n.values.length;c<u;c++)l[c]=n.categories[n.values[c]];t.key2data[e]=l}else n.value?t.key2data[e]=n.value:t.key2data[e]=n}));n.push(a)}})),new Promise((function(e){Promise.all(n).then((function(){return e()}))}))}},{key:"getSelectedIdsPromise",value:function(e){var t=this,n=e.filter,a=_e(n),i=a.basis,r=a.X,o=a.obs,s=[];return i.forEach((function(e){s.push(e.name)})),s.push("index"),s=s.concat(r).concat(o),new Promise((function(e){t.fetchData(s).then((function(){for(var a=Array.from(He(t.key2data,n)),i=t.getVector("index",a),r=[],o=0,s=i.size();o<s;o++)r.push(i.get(o));e({ids:r})}))}))}},{key:"getDataPromise",value:function(e,t){var n=this,a={},i=[],r=[],o=new Set;e.embedding&&e.embedding.forEach((function(e){var t=e.name;o.add(t),e.name=t})),["stats","groupedStats","selection","values"].forEach((function(t){if(t in e){var n=e[t];Object(f.isArray)(n)||(n=[n]),n.forEach((function(e){e.dimensions&&(Object(f.isArray)(e.dimensions)?e.dimensions.forEach((function(e){i=i.concat(e)})):i=i.concat(e.dimensions)),e.measures&&(r=r.concat(e.measures))}))}}));var s=De(r);if(e.selection){var l=_e(e.selection.filter),c=(l.basis,l.X),u=l.obs;i=i.concat(u),r=r.concat(c),(e.selection.embeddings||[]).forEach((function(e){var t=e.name;o.add(t)}))}return new Promise((function(r){n.fetchData(i.concat(s.obs).concat(s.X).concat(Array.from(o))).then((function(){if(e.embedding&&(a.embeddings=[],e.embedding.forEach((function(e){var t=e.name,i=n.getVector(t).asArray();a.embeddings.push({name:t,coordinates:i})}))),e.values){var i=e.values.dimensions||[],o=De(e.values.measures||[]),s={};i.concat(o.obs).concat(o.X).forEach((function(e){"__count"===e?(s[e]=new Int8Array(n.schema.shape[0]),s[e].fill(1)):s[e]=n.getVector(e).asArray()})),a.values=s}Ie(a,t),Re(a,e,t),r(a)}))}))}},{key:"getSchemaPromise",value:function(){if(null!=this.schema)return Promise.resolve(this.schema);var e=this.url,t=this;return"jsonl"===this.format?new Promise((function(n,a){fetch(e+".idx.json").then((function(e){return e.json()})).then((function(e){t.key2bytes=e.index})).then((function(){fetch(e,t.getByteRange("schema")).then((function(e){return e.json()})).then((function(e){t.schema=e.schema,n(t.schema)}))}))})):new Promise((function(n,a){fetch(e).then((function(e){return e.json()})).then((function(e){t.schema=e,n(e)}))}))}},{key:"getVector",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=this.key2data[e],a=new Te(e,n);return null!=t&&(a=new k(a,t)),a}},{key:"getFileUrl",value:function(e){return this.baseUrl+e}},{key:"getJob",value:function(e,t){return fetch(this.baseUrl+"uns/"+e+".json").then((function(e){return e.json()}))}},{key:"getJobs",value:function(){return Promise.resolve([])}},{key:"getVectors",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,a=[];return e.forEach((function(e){var i=t.getVector(e,n);a.push(i)})),a}}]),e}(),Ge=n(331),Je=n(153),Xe=n(16),qe=n(361),Ke=n(234),Ze=n(372),Ye=n(228),Qe=n(363),$e=n(210),et=n.n($e),tt=n(211),nt=n.n(tt),at=n(206),it=n.n(at),rt=n(209),ot=n.n(rt),st=n(204),lt=n.n(st),ct=n(208),ut=n.n(ct),dt=n(85),ht=n.n(dt),pt=n(214),ft=n.n(pt),vt=n(205),bt=n.n(vt),mt=n(207),gt=n.n(mt),jt=n(213),Ot=n.n(jt),xt=n(202),yt=n.n(xt),St=n(203),wt=n.n(St),Ct="cirro-active";function kt(e){var t=Object(a.useState)(null),n=Object(Xe.a)(t,2),i=n[0],r=n[1];function o(t){e.onDragMode(t)}function s(t){r(null),e.onSaveImage(t)}var l=e.dragmode,c=e.editSelection,u=e.showLabels,d=e.showAxis;return Object(V.jsxs)(V.Fragment,{children:[e.onZoomIn&&Object(V.jsx)(qe.a,{title:"Zoom In",children:Object(V.jsx)(Ze.a,{edge:!1,size:"small","aria-label":"Zoom In",onClick:e.onZoomIn,children:Object(V.jsx)(yt.a,{})})}),e.onZoomOut&&Object(V.jsx)(qe.a,{title:"Zoom Out",children:Object(V.jsx)(Ze.a,{edge:!1,size:"small","aria-label":"Zoom In",onClick:e.onZoomOut,children:Object(V.jsx)(wt.a,{})})}),e.onHome&&Object(V.jsx)(qe.a,{title:"Home",children:Object(V.jsx)(Ze.a,{edge:!1,size:"small","aria-label":"Home",onClick:e.onHome,children:Object(V.jsx)(lt.a,{})})}),e.onDragMode&&Object(V.jsx)(qe.a,{title:"Lasso Select",children:Object(V.jsx)(Ze.a,{edge:!1,size:"small",className:"lasso"===l?Ct:"","aria-label":"Lasso Select",onClick:function(){return o("lasso")},children:Object(V.jsx)(Ke.a,{width:"24",height:"21",viewBox:"0 0 1031 1000",children:Object(V.jsx)("path",{d:"m1018 538c-36 207-290 336-568 286-277-48-473-256-436-463 10-57 36-108 76-151-13-66 11-137 68-183 34-28 75-41 114-42l-55-70 0 0c-2-1-3-2-4-3-10-14-8-34 5-45 14-11 34-8 45 4 1 1 2 3 2 5l0 0 113 140c16 11 31 24 45 40 4 3 6 7 8 11 48-3 100 0 151 9 278 48 473 255 436 462z m-624-379c-80 14-149 48-197 96 42 42 109 47 156 9 33-26 47-66 41-105z m-187-74c-19 16-33 37-39 60 50-32 109-55 174-68-42-25-95-24-135 8z m360 75c-34-7-69-9-102-8 8 62-16 128-68 170-73 59-175 54-244-5-9 20-16 40-20 61-28 159 121 317 333 354s407-60 434-217c28-159-121-318-333-355z",transform:"matrix(1 0 0 -1 0 850)"})})})}),e.onDragMode&&Object(V.jsx)(qe.a,{title:"Box Select",children:Object(V.jsx)(Ze.a,{edge:!1,size:"small","aria-label":"Box Select",onClick:function(){return o("select")},children:Object(V.jsx)(bt.a,{className:"select"===l?Ct:""})})}),e.onEditSelection&&Object(V.jsx)(qe.a,{title:"Append to selection",children:Object(V.jsx)(Ze.a,{edge:!1,size:"small","aria-label":"Append to selection",onClick:function(){e.onEditSelection()},children:Object(V.jsx)(it.a,{className:c?Ct:""})})}),e.is3d&&Object(V.jsx)(qe.a,{title:e.animating?"Pause":"Animate",children:Object(V.jsxs)(Ze.a,{edge:!1,size:"small","aria-label":e.animating?"Pause":"Animate",onClick:e.toggleAnimation,children:[!e.animating&&Object(V.jsx)(gt.a,{}),e.animating&&Object(V.jsx)(ut.a,{})]})}),e.onDragMode&&Object(V.jsx)(qe.a,{title:"Pan",children:Object(V.jsx)(Ze.a,{edge:!1,size:"small",className:"pan"===l?Ct:"","aria-label":"Pan",onClick:function(){return o("pan")},children:Object(V.jsx)(Ke.a,{viewBox:"0 0 1000 1000",height:"16",width:"16",children:Object(V.jsx)("path",{d:"m1000 350l-187 188 0-125-250 0 0 250 125 0-188 187-187-187 125 0 0-250-250 0 0 125-188-188 186-187 0 125 252 0 0-250-125 0 187-188 188 188-125 0 0 250 250 0 0-126 187 188z",transform:"matrix(1 0 0 -1 0 850)"})})})}),e.onShowLabels&&Object(V.jsx)(qe.a,{title:"Show Categorical Labels",children:Object(V.jsx)(Ze.a,{edge:!1,size:"small",className:u?Ct:"","aria-label":"Show Labels",onClick:function(){e.onShowLabels()},children:Object(V.jsx)(ot.a,{})})}),e.is3d&&e.onShowAxis&&Object(V.jsx)(qe.a,{title:"Show Axis",children:Object(V.jsx)(Ze.a,{edge:!1,size:"small",className:d?Ct:"","aria-label":"Show Axis",onClick:function(){e.onShowAxis()},children:Object(V.jsx)(et.a,{})})}),e.is3d&&e.onShowFog&&Object(V.jsx)(qe.a,{title:"Show Fog",children:Object(V.jsx)(Ze.a,{edge:!1,size:"small",className:e.showFog?Ct:"","aria-label":"Show Fog",onClick:function(){e.onShowFog()},children:Object(V.jsx)(nt.a,{})})}),Object(V.jsx)(qe.a,{title:"Save Image",children:Object(V.jsx)(Ze.a,{"aria-controls":"save-image-menu","aria-haspopup":"true",edge:!1,size:"small","aria-label":"Save Image",onClick:function(e){r(e.currentTarget)},children:Object(V.jsx)(ht.a,{})})}),Object(V.jsxs)(Ye.a,{id:"save-image-menu",anchorEl:i,keepMounted:!0,open:Boolean(i),onClose:function(e){r(null)},children:[Object(V.jsx)(Qe.a,{onClick:function(e){return s("png")},children:"PNG"}),Object(V.jsx)(Qe.a,{onClick:function(e){return s("svg")},children:"SVG"})]}),e.onMoreOptions&&Object(V.jsx)(qe.a,{title:"More Options",children:Object(V.jsx)(Ze.a,{edge:!1,size:"small","aria-label":"More Options",onClick:function(){e.onMoreOptions()},children:Object(V.jsx)(Ot.a,{})})}),Object(V.jsx)(qe.a,{title:"Scroll To Gallery",children:Object(V.jsx)(Ze.a,{edge:!1,size:"small","aria-label":"Scroll To Gallery",onClick:function(){e.onGallery()},children:Object(V.jsx)(ft.a,{})})})]})}var Et=n(347),zt=Object(Et.a)(".1f"),Tt=Object(Et.a)(".2f"),Pt=Object(Et.a)(","),Mt=Object(Et.a)(".0f");function At(e,t){var n={},a=e.categoryToIndices,i=0===t.size;for(var r in a){for(var o=a[r],s={},l=0,c=0,u=0,d=o.length;u<d;u++){var h=o[u];if(i||t.has(h)){var p=e.values[h];e.continuous?l+=p:s[p]=(s[p]||0)+1,c++}}if(e.continuous){var f=l/c;n[r]={value:0===c?void 0:(f-e.mean)/e.stdev,n:c}}else{var v=0,b=void 0;for(var m in s){var g=s[m];g>v&&(v=g,b=m)}n[r]={value:b,n:c}}}return n}var It=function(e){Object(O.a)(n,e);var t=Object(x.a)(n);function n(e){var a;return Object(j.a)(this,n),(a=t.call(this,e)).onSaveImage=function(e){var t,n=null,i=a.props,r=i.chartSize,o=i.trace,s={width:r.width,height:r.height},l=o.name;if("__count"===l&&(l="count"),"svg"!==e){(n=document.createElement("canvas")).width=s.width*window.devicePixelRatio,n.height=s.height*window.devicePixelRatio,(t=n.getContext("2d")).scale(window.devicePixelRatio,window.devicePixelRatio),t.fillStyle="white",t.fillRect(0,0,s.width,s.height);var c=(new XMLSerializer).serializeToString(o.source),u="data:image/svg+xml;base64,"+btoa(c);t.fillStyle="black";var d=new Image;d.src=u,d.onload=function(){t.drawImage(d,0,0),n.toBlob((function(e){window.saveAs(e,l+".png",!0)}))}}else{var h=new Blob([(new XMLSerializer).serializeToString(o.source)],{type:"text/plain;charset=utf-8"});window.saveAs(h,l+".svg")}},a.updateSvg=function(){var e=a.containerElementRef.current;e.innerHTML="";var t,n=a.props.trace.source;n.setAttribute("width",a.props.chartSize.width),n.setAttribute("height",a.props.chartSize.height),e.append(n);var i=n.childNodes||n.children;if(i.length>0&&"g"===i[0].nodeName&&"true"===i[0].getAttribute("cirro-zoom")&&(t=i[0]),!t){var r=new Set(["defs","metadata","style"]);(t=document.createElementNS("http://www.w3.org/2000/svg","g")).setAttribute("cirro-zoom","true");var o=n.childNodes||n.children;if(o&&o.length>0)for(var s=o.length;s>0;s--)r.has(o[o.length-s].nodeName)||t.appendChild(o[o.length-s]);n.appendChild(t)}var l=Object(Je.a)().scaleExtent([.1,10]).on("zoom",(function(e){var n=e.transform;t.setAttribute("transform",n)}));a.d3Zoom=l,Object(Ge.a)(n).call(l)},a.onHome=function(){Object(Ge.a)(a.props.trace.source).call(a.d3Zoom.transform,Je.b.scale(1))},a.onZoomIn=function(){Object(Ge.a)(a.props.trace.source).call(a.d3Zoom.scaleBy,1.5)},a.onZoomOut=function(){Object(Ge.a)(a.props.trace.source).call(a.d3Zoom.scaleBy,.5)},a.containerElementRef=i.a.createRef(),a}return Object(C.a)(n,[{key:"componentDidMount",value:function(){var e=this;this.updateSvg();var t=this.containerElementRef.current;t.addEventListener("mousemove",(function(n){if(t.style.cursor=null,"path"===n.target.nodeName){var a=e.props.trace.categoryToStats,i=n.target.id,r=i=i.replaceAll("_"," ");if(a){t.style.cursor="pointer";var o=a[i];if(o){var s=e.props.trace.fullCategoryToStats[i],l=o!==s;"__count"!==e.props.trace.name&&(e.props.trace.continuous?r+=", z-score: "+he(Tt(o.value))+(l?" ("+he(Tt(s.value))+")":""):r+=", mode: "+o.value+(l?" ("+s.value+")":"")),r+=", # spots: "+Pt(o.n)+(l?" / "+Pt(s.n):"")}}e.props.setTooltip(r)}else e.props.setTooltip("")})),t.addEventListener("mouseleave",(function(t){e.props.setTooltip("")})),t.addEventListener("click",(function(t){if("path"===t.target.nodeName){var n=e.props.trace.categoryToIndices,a=t.target.id,i=n[a=a.replaceAll("_"," ")];i&&i.length>0?e.props.onSelected({name:Ma(e.props.trace.embedding),clear:!t.metaKey&&!t.ctrlKey,value:{basis:e.props.trace.embedding,indices:new Set(i),id:a}}):e.props.onSelected({name:Ma(e.props.trace.embedding)})}else e.props.onSelected({name:Ma(e.props.trace.embedding)})}))}},{key:"componentDidUpdate",value:function(e,t,n){if(this.props.setTooltip(""),this.props.trace.source!==e.trace.source)Object(Ge.a)(e.trace.source).on(".zoom",null),this.updateSvg();else if(this.props.chartSize.width!==e.chartSize.width||this.props.chartSize.height!==e.chartSize.height){var a=this.props.trace.source;a.setAttribute("width",this.props.chartSize.width),a.setAttribute("height",this.props.chartSize.height),Object(Ge.a)(a).call(this.d3Zoom.transform,Je.b.scale(1))}}},{key:"render",value:function(){return Object(V.jsxs)(V.Fragment,{children:[Object(V.jsx)("div",{className:this.props.classes.root,children:Object(V.jsx)(kt,{onGallery:this.props.onGallery,animating:!1,onZoomIn:this.onZoomIn,onZoomOut:this.onZoomOut,is3d:!1,onHome:this.onHome,onSaveImage:this.onSaveImage})}),Object(V.jsx)("div",{style:{display:"inline-block"},ref:this.containerElementRef})]})}}]),n}(i.a.PureComponent),Dt=Object(P.a)((function(e){return{root:{"& > *":{margin:e.spacing(.4)},"& > .MuiIconButton-root":{padding:0},position:"absolute",zIndex:1,top:0,left:0,display:"inline-block",verticalAlign:"top",whiteSpace:"nowrap",overflow:"hidden"}}}))(It);function _t(e){var t=[];return e.forEach((function(e){for(var n=e.categories,a=e.name,i=0;i<e.values.length;i++)t.push({dimension:a,name:n[i],feature:e.values[i].name,mean:e.values[i].mean,percentExpressed:e.values[i].percentExpressed})})),t}var Rt=function(){function e(){Object(j.a)(this,e)}return Object(C.a)(e,[{key:"init",value:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return this.id=e,this.local=n,Promise.resolve()}},{key:"getSelectedIdsPromise",value:function(e,t){return e.id=this.id,this.local?null==t.index?this.getDataPromise({values:{dimensions:["index"]}},t).then((function(){for(var n=Array.from(He(t,e.filter)),a=[],i=t.index,r=0,o=n.length;r<o;r++)a.push(i[n[r]]);return{ids:a}})):void 0:fetch(Cn+"/selected_ids",{body:JSON.stringify(e),method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+ui()}}).then((function(e){return e.json()}))}},{key:"getFileUrl",value:function(e){return Cn+"/file?id="+this.id+"&file="+e+"&access_token="+ui()}},{key:"getJob",value:function(e){return fetch(Cn+"/job?id="+e+"&ds_id="+this.id,{headers:{Authorization:"Bearer "+ui()}}).then((function(e){return e.json()}))}},{key:"getJobStatus",value:function(e){return fetch(Cn+"/job_status?id="+e+"&ds_id="+this.id,{headers:{Authorization:"Bearer "+ui()}}).then((function(e){return e.json()}))}},{key:"getJobs",value:function(e){return fetch(Cn+"/jobs?id="+e,{headers:{Authorization:"Bearer "+ui()}}).then((function(e){return e.json()}))}},{key:"deleteJob",value:function(e){return fetch(Cn+"/job",{body:JSON.stringify({id:e}),method:"DELETE",headers:{Authorization:"Bearer "+ui()}})}},{key:"getDataPromise",value:function(e,t){var n=this;e.id=this.id;var a=e,i=this.local;i&&(a={},(e.embedding||e.values)&&(a.id=this.id,a.embedding=e.embedding,a.values=e.values));var r=JSON.stringify(a);return("{}"!==r?fetch(Cn+"/data",{body:r,method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+ui()}}).then((function(e){return e.json()})).then((function(e){if(e.values)for(var a in e.values){var i=e.values[a];if(i.indices){for(var r=new Float32Array(n.schema.shape[0]),o=0,s=i.indices.length;o<s;o++)r[i.indices[o]]=i.values[o];e.values[a]=r}else if(i.categories){for(var l=new Array(n.schema.shape[0]),c=0,u=i.values.length;c<u;c++)l[c]=i.categories[i.values[c]];e.values[a]=l}}return Ie(e,t),e})):Promise.resolve({})).then((function(n){return i?Re(n,e,t):(n.distribution&&(n.distribution=_t(n.distribution)),n.selection&&n.selection.distribution&&(n.selection.distribution=_t(n.selection.distribution))),n}))}},{key:"getSchemaPromise",value:function(){var e=this;return null!=this.schema?Promise.resolve(this.schema):fetch(Cn+"/schema?id="+this.id,{headers:{Authorization:"Bearer "+ui()}}).then((function(e){return e.json()})).then((function(t){return e.schema=t,t}))}}]),e}(),Nt=function(){function e(){Object(j.a)(this,e)}return Object(C.a)(e,[{key:"getUserPromise",value:function(){return fetch(Cn+"/user",{headers:{Authorization:"Bearer "+ui(),"Content-Type":"application/json"}}).then((function(e){return e.json()}))}},{key:"getDatasetsPromise",value:function(){return fetch(Cn+"/datasets",{headers:{Authorization:"Bearer "+ui()}}).then((function(e){return e.json()}))}},{key:"deleteDatasetPromise",value:function(e){return fetch(Cn+"/dataset",{body:JSON.stringify({id:e}),method:"DELETE",headers:{Authorization:"Bearer "+ui()}})}},{key:"upsertDatasetPromise",value:function(e){var t=null!=e.id,n=new FormData;for(var a in e){var i=e[a];null!=i&&("readers"==a&&(i=JSON.stringify(i)),n.append(a,i))}var r=new XMLHttpRequest;return r.open(t?"PUT":"POST",Cn+"/dataset"),r.setRequestHeader("Authorization","Bearer "+ui()),r.send(n),r}},{key:"getDatasetPromise",value:function(e){return fetch(Cn+"/dataset?id="+e,{method:"GET",headers:{Authorization:"Bearer "+ui()}}).then((function(e){return e.json()}))}},{key:"getCategoryNamesPromise",value:function(e){return fetch(Cn+"/category_name?id="+e,{headers:{Authorization:"Bearer "+ui()}}).then((function(e){return e.json()}))}},{key:"setCategoryNamePromise",value:function(e){return fetch(Cn+"/category_name",{body:JSON.stringify(e),method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer "+ui()}})}},{key:"getViewsPromise",value:function(e){return fetch(Cn+"/views?id="+e,{headers:{Authorization:"Bearer "+ui()}}).then((function(e){return e.json()}))}},{key:"upsertViewPromise",value:function(e,t){return fetch(Cn+"/view",{body:JSON.stringify(e),method:t?"PUT":"POST",headers:{Authorization:"Bearer "+ui()}}).then((function(e){return e.json()}))}},{key:"deleteViewPromise",value:function(e,t){return fetch(Cn+"/view",{body:JSON.stringify({id:e,ds_id:t}),method:"DELETE",headers:{Authorization:"Bearer "+ui()}})}},{key:"getViewPromise",value:function(e){return fetch(Cn+"/view?id="+e,{headers:{Authorization:"Bearer "+ui()}}).then((function(e){return e.json()}))}},{key:"upsertFeatureSet",value:function(e,t){return fetch(Cn+"/feature_set",{body:JSON.stringify(e),method:t?"PUT":"POST",headers:{Authorization:"Bearer "+ui()}}).then((function(e){return e.json()}))}},{key:"deleteFeatureSet",value:function(e,t){return fetch(Cn+"/feature_set",{body:JSON.stringify({id:e,ds_id:t}),method:"DELETE",headers:{Authorization:"Bearer "+ui()}})}},{key:"exportDatasetFiltersPromise",value:function(e){return fetch(Cn+"/export_filters?id="+e,{headers:{Authorization:"Bearer "+ui()}}).then((function(e){return e.ok?e.text():null}))}},{key:"submitJob",value:function(e){return fetch(Cn+"/submit_job",{body:JSON.stringify(e),method:"POST",headers:{Authorization:"Bearer "+ui()}}).then((function(e){return e.json()}))}}]),e}(),Ft=function(){function e(){Object(j.a)(this,e)}return Object(C.a)(e,[{key:"getDatasetsPromise",value:function(){return fetch("/datasets.json").then((function(e){for(var t=e.json(),n=0;n<t.length;n++)t[n].access="direct";return t}))}},{key:"getCategoryNamesPromise",value:function(){return Promise.resolve([])}},{key:"getViewsPromise",value:function(){return Promise.resolve([])}}]),e}(),Lt=n(15);function Bt(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return e.needsUpdate=t,e.minFilter=Lt.g,e.generateMipmaps=!1,e.flipY=!1,e}function Ut(e){return Bt(new Lt.u(e))}var Vt,Ht="\n    \n    varying vec4 vColor;\n\n    ".concat(Lt.q.common,"\n    ").concat("\n    bool point_in_unit_circle(vec2 spriteCoord) {\n      vec2 centerToP = spriteCoord - vec2(0.5, 0.5);\n      return dot(centerToP, centerToP) < (0.5 * 0.5);\n    }\n\n    bool point_in_unit_equilateral_triangle(vec2 spriteCoord) {\n      vec3 v0 = vec3(0, 1, 0);\n      vec3 v1 = vec3(0.5, 0, 0);\n      vec3 v2 = vec3(1, 1, 0);\n      vec3 p = vec3(spriteCoord, 0);\n      float p_in_v0_v1 = cross(v1 - v0, p - v0).z;\n      float p_in_v1_v2 = cross(v2 - v1, p - v1).z;\n      return (p_in_v0_v1 > 0.0) && (p_in_v1_v2 > 0.0);\n    }\n\n    bool point_in_unit_square(vec2 spriteCoord) {\n      return true;\n    }\n  ","\n    uniform vec3 fogColor;\n    varying float fogDepth;\n\t\tuniform float fogNear;\n    uniform float fogFar;\n\n    void main() {\n      bool inside = point_in_unit_circle(gl_PointCoord);\n      if (!inside) {\n        discard;\n      }\n      gl_FragColor = vColor;\n      float fogFactor = smoothstep( fogNear, fogFar, fogDepth );\n      gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n    }"),Wt=function(){function e(t,n){Object(j.a)(this,e),this.styles=t,this.id="SPRITES",this.scene=void 0,this.fog=void 0,this.renderMaterial=void 0,this.points=void 0,this.worldSpacePointPositions=new Float32Array(0),this.renderColors=new Float32Array(0),this.standinTextureForPoints=void 0,this.zoomFactor=NaN,this.renderMaterial=this.createRenderMaterial(),this.standinTextureForPoints=Ut(document.createElement("canvas"))}return Object(C.a)(e,[{key:"createUniforms",value:function(){return{texture:{type:"t"},zoomFactor:{type:"f"},zoomFactorSpecified:{type:"bool"},fogColor:{type:"c"},fogNear:{type:"f"},fogFar:{type:"f"},isImage:{type:"bool"},sizeAttenuation:{type:"bool"},pointSize:{type:"f"}}}},{key:"createRenderMaterial",value:function(){var e=this.createUniforms();return new Lt.r({uniforms:e,vertexShader:"\n    // Index of the specific vertex (passed in as bufferAttribute), and the\n    // variable that will be used to pass it to the fragment shader.\n    attribute float spriteIndex;\n    attribute vec4 color;\n    attribute float scaleFactor;\n\n    varying vec4 vColor;\n\n    uniform bool sizeAttenuation;\n    uniform float pointSize;\n    uniform float zoomFactor;\n    uniform bool zoomFactorSpecified;\n    \n    varying float fogDepth;\n\n    void main() {\n      // Pass index and color values to fragment shader.\n      vColor = color;\n\n      // Transform current vertex by modelViewMatrix (model world position and\n      // camera world position matrix).\n      vec4 cameraSpacePos = modelViewMatrix * vec4(position, 1.0);\n\n      // Project vertex in camera-space to screen coordinates using the camera's\n      // projection matrix.\n      gl_Position = projectionMatrix * cameraSpacePos;\n\n      // Create size attenuation (if we're in 3D mode) by making the size of\n      // each point inversely proportional to its distance to the camera.\n      float outputPointSize = pointSize;\n      if (sizeAttenuation) {\n        outputPointSize = -pointSize / cameraSpacePos.z;\n        fogDepth = pointSize / outputPointSize * 1.2;\n      } else {  // Create size attenuation (if we're in 2D mode)\n        const float PI = 3.1415926535897932384626433832795;\n        const float minScale = 0.1;  // minimum scaling factor\n        const float outSpeed = 2.0;  // shrink speed when zooming out\n        const float outNorm = (1. - minScale) / atan(outSpeed);\n        const float maxScale = 15.0;  // maximum scaling factor\n        const float inSpeed = 0.02;  // enlarge speed when zooming in\n        const float zoomOffset = 0.3;  // offset zoom pivot\n        float m = projectionMatrix[0][0];\n        if (zoomFactorSpecified) {\n          m = zoomFactor;\n        } \n        float zoom = m + zoomOffset;  // zoom pivot\n        float scale = zoom < 1. ? 1. + outNorm * atan(outSpeed * (zoom - 1.)) :\n                      1. + 2. / PI * (maxScale - 1.) * atan(inSpeed * (zoom - 1.));\n        outputPointSize = pointSize * scale;\n      }\n      gl_PointSize = outputPointSize * scaleFactor;\n    }",fragmentShader:Ht,transparent:!0,fog:!0,depthTest:!0,depthWrite:!0,blending:Lt.j})}},{key:"calculatePointSize",value:function(e){var t=null!=this.worldSpacePointPositions?this.worldSpacePointPositions.length/3:1,n=200/Math.log(t)/Math.log(8);return e?n:n/1.5}},{key:"createPointSprites",value:function(e,t){var n=null!=t?t.length/3:0,a=this.createGeometry(n);this.fog=new Lt.f(16777215),this.points=new Lt.n(a,this.renderMaterial),this.points.frustumCulled=!1,e.add(this.points)}},{key:"createGeometry",value:function(e){var t=new Lt.c;return t.setAttribute("position",new Lt.b(new Float32Array([]),3)),t.setAttribute("color",new Lt.b(new Float32Array([]),4)),t.setAttribute("scaleFactor",new Lt.b(new Float32Array([]),1)),t.computeVertexNormals(),t}},{key:"setFogDistances",value:function(e,t,n){var a=this.styles.fog,i=a.threshold,r=a.enabled;if(e&&r){var o=this.worldSpacePointPositions.length/3;this.fog.near=t;var s=2-Math.min(o,i)/i;this.fog.far=n*s}else this.fog.near=1/0,this.fog.far=1/0}},{key:"dispose",value:function(){this.disposeGeometry(),this.disposeSpriteSheet()}},{key:"disposeGeometry",value:function(){null!=this.points&&(this.scene.remove(this.points),this.points.geometry.dispose(),this.points=null,this.worldSpacePointPositions=null)}},{key:"disposeSpriteSheet",value:function(){this.renderMaterial=null}},{key:"setScene",value:function(e){this.scene=e}},{key:"onPointPositionsChanged",value:function(e){null!=this.points&&this.worldSpacePointPositions.length!==e.length&&this.disposeGeometry(),this.worldSpacePointPositions=e,null==this.points&&this.createPointSprites(this.scene,e),this.renderMaterial=this.createRenderMaterial();var t=this.points.geometry.getAttribute("position");t.array=e,t.count=e.length/3,t.needsUpdate=!0}},{key:"onRender",value:function(e){var t=e.camera instanceof Lt.l;this.setFogDistances(t,e.nearestCameraSpacePointZ,e.farthestCameraSpacePointZ),this.scene.fog=this.fog,this.scene.fog.color=new Lt.d(e.backgroundColor),this.renderMaterial.uniforms.fogColor.value=this.scene.fog.color,this.renderMaterial.uniforms.fogNear.value=this.fog.near,this.renderMaterial.uniforms.fogFar.value=this.fog.far,this.renderMaterial.uniforms.texture.value=this.standinTextureForPoints,this.renderMaterial.uniforms.sizeAttenuation.value=t,this.renderMaterial.uniforms.zoomFactor.value=this.zoomFactor,this.renderMaterial.uniforms.zoomFactorSpecified.value=!isNaN(this.zoomFactor),this.renderMaterial.uniforms.pointSize.value=this.calculatePointSize(t),this.points.material=this.renderMaterial;var n=this.points.geometry.getAttribute("color");this.renderColors=e.pointColors,n.array=this.renderColors,n.count=this.renderColors.length/4,n.needsUpdate=!0;var a=this.points.geometry.getAttribute("scaleFactor");a.array=e.pointScaleFactors,a.count=e.pointScaleFactors.length/1,a.needsUpdate=!0}},{key:"onResize",value:function(e,t){}}]),e}(),Gt=n(215);!function(e){e[e.Perspective=0]="Perspective",e[e.Orthographic=1]="Orthographic"}(Vt||(Vt={}));var Jt,Xt,qt=function e(t,n,a,i,r,o,s,l,c,u,d,h,p,f){Object(j.a)(this,e),this.camera=t,this.cameraType=n,this.cameraTarget=a,this.screenWidth=i,this.screenHeight=r,this.nearestCameraSpacePointZ=o,this.farthestCameraSpacePointZ=s,this.backgroundColor=l,this.pointColors=c,this.pointScaleFactors=u,this.labels=d,this.polylineColors=h,this.polylineOpacities=p,this.polylineWidths=f};!function(e){e.PAN="PAN",e.SELECT="SELECT"}(Jt||(Jt={})),function(e){e.BOX="BOX",e.LASSO="LASSO"}(Xt||(Xt={}));var Kt=function(){function e(t,n,a,i){var r=this;Object(j.a)(this,e),this.svgElement=void 0,this.rectElement=void 0,this.lassoElement=void 0,this.isMouseDown=void 0,this.appendToSelection=void 0,this.startCoordinates=[0,0],this.lastBoundingBox=void 0,this.lassoPath=[],this.selectionMode=Xt.BOX,this.selectionCallback=void 0,this.lassoCallback=void 0,this.svgElement=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.svgElement.style.display="none",this.svgElement.style.height="100%",this.svgElement.style.width="100%",this.svgElement.style.position="absolute",this.svgElement.dataset.testid="svg-selection",t.insertAdjacentElement("afterbegin",this.svgElement),this.rectElement=document.createElementNS("http://www.w3.org/2000/svg","rect"),this.lassoElement=document.createElementNS("http://www.w3.org/2000/svg","path"),[this.rectElement,this.lassoElement].forEach((function(e){e.style.pointerEvents="none",e.style.stroke=i.select.stroke,e.style.strokeDasharray=i.select.strokeDashArray,e.style.strokeWidth="".concat(i.select.strokeWidth),e.style.fill=i.select.fill,e.style.fillOpacity="".concat(i.select.fillOpacity),r.svgElement.appendChild(e)})),this.selectionCallback=n,this.lassoCallback=a,this.isMouseDown=!1,this.appendToSelection=!1}return Object(C.a)(e,[{key:"setSelectionMode",value:function(e){this.selectionMode=e}},{key:"onMouseDown",value:function(e,t,n){this.isMouseDown=!0,this.appendToSelection=n,this.selectionMode===Xt.BOX?this.rectElement.style.display="block":this.lassoElement.style.display="block",this.svgElement.style.display="block",this.selectionMode===Xt.BOX?(this.startCoordinates=[e,t],this.lastBoundingBox={x:this.startCoordinates[0],y:this.startCoordinates[1],width:1,height:1}):this.lassoPath=[{x:e,y:t}]}},{key:"onMouseMove",value:function(e,t){if(this.isMouseDown)if(this.selectionMode===Xt.BOX)this.lastBoundingBox.x=Math.min(e,this.startCoordinates[0]),this.lastBoundingBox.y=Math.max(t,this.startCoordinates[1]),this.lastBoundingBox.width=Math.max(e,this.startCoordinates[0])-this.lastBoundingBox.x,this.lastBoundingBox.height=this.lastBoundingBox.y-Math.min(t,this.startCoordinates[1]),this.rectElement.setAttribute("x",""+this.lastBoundingBox.x),this.rectElement.setAttribute("y",""+(this.lastBoundingBox.y-this.lastBoundingBox.height)),this.rectElement.setAttribute("width",""+this.lastBoundingBox.width),this.rectElement.setAttribute("height",""+this.lastBoundingBox.height);else{this.lassoPath.push({x:e,y:t});for(var n=this.lassoPath.length>3?U()(this.lassoPath,.1):this.lassoPath,a=["M",n[0].x,n[0].y],i=1;i<n.length;i++)a.push("L"),a.push(n[i].x),a.push(n[i].y);a.push("Z"),this.lassoElement.setAttribute("d",a.join(" "))}}},{key:"onMouseUp",value:function(){this.isMouseDown=!1,this.svgElement.style.display="none",this.rectElement.style.display="none",this.lassoElement.style.display="none";var e={x:this.rectElement.x.baseVal.value,y:this.rectElement.y.baseVal.value,width:this.rectElement.width.baseVal.value,height:this.rectElement.height.baseVal.value};if(this.lassoElement.setAttribute("d",""),this.rectElement.setAttribute("width","0"),this.rectElement.setAttribute("height","0"),this.selectionMode===Xt.BOX)this.selectionCallback(e,this.appendToSelection);else{var t=this.lassoPath.length>3?U()(this.lassoPath,.1):this.lassoPath;this.lassoCallback(t,this.appendToSelection),this.lassoPath=[]}}}]),e}(),Zt=1.2,Yt=new Lt.w(.45,.9,1.6),Qt=new Lt.w(0,0,0),$t=new Lt.w(0,0,4),en=new Lt.w(0,0,0),tn=function(){function e(t,n){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];Object(j.a)(this,e),this.container=void 0,this.styles=void 0,this.interactive=!0,this.hoverPoint={x:0,y:0},this.hoverCallback=function(){},this.clickCallback=function(){},this.boxCallback=function(){},this.lassoCallback=function(){},this.cameraCallback=function(){},this.visualizers=[],this.height=0,this.width=0,this.dimensions=3,this.interactionMode=Jt.PAN,this.renderer=void 0,this.scene=void 0,this.light=void 0,this.camera=void 0,this.orbitAnimationOnNextCameraCreation=!1,this.orbitCameraControls=void 0,this.orbitAnimationId=null,this.worldSpacePointPositions=new Float32Array(0),this.pointColors=new Float32Array(0),this.pointScaleFactors=new Float32Array(0),this.labels=void 0,this.polylineColors={},this.polylineOpacities=new Float32Array(0),this.polylineWidths=new Float32Array(0),this.selecting=!1,this.mouseIsDown=!1,this.isDragSequence=!1,this.rectangleSelector=void 0,this.container=t,this.styles=n.styles,this.interactive=n.interactive||!1,this.computeLayoutValues(),this.scene=new Lt.p,this.renderer=new Lt.y({alpha:!0,premultipliedAlpha:a,antialias:!1}),this.renderer.setClearColor(this.styles.backgroundColor,1),this.container.appendChild(this.renderer.domElement),this.light=new Lt.m(16772287,1,0),this.scene.add(this.light),n.interactive&&(this.rectangleSelector=new Kt(this.container,this.selectBoundingBox.bind(this),this.selectLasso.bind(this),this.styles),this.addInteractionListeners()),this.setDimensions(3),this.makeCamera(n.camera),this.resize()}return Object(C.a)(e,[{key:"addInteractionListeners",value:function(){this.container.addEventListener("pointerout",this.onPointerOut.bind(this)),this.container.addEventListener("pointerenter",this.onPointerOut.bind(this)),this.container.addEventListener("pointermove",this.onPointerMove.bind(this)),this.container.addEventListener("pointerdown",this.onPointerDown.bind(this)),this.container.addEventListener("pointerup",this.onPointerUp.bind(this)),window.addEventListener("keydown",this.onKeyDown.bind(this),!1),window.addEventListener("keyup",this.onKeyUp.bind(this),!1)}},{key:"addCameraControlsEventListeners",value:function(e){var t=this;this.interactive&&(e.addEventListener("start",(function(){t.stopOrbitAnimation(),t.cameraCallback("start",t.camera.position,e.target)})),e.addEventListener("change",(function(){t.render(),t.cameraCallback("change",t.camera.position,e.target)})),e.addEventListener("end",(function(){t.cameraCallback("end",t.camera.position,e.target)})))}},{key:"makeOrbitControls",value:function(e,t){null!=this.orbitCameraControls&&this.orbitCameraControls.dispose();var n=new Gt.a(e,this.renderer.domElement);n.zoomSpeed=1.125,n.enableRotate=t,n.autoRotate=!1,n.enableKeys=!1,n.rotateSpeed=1,t?(n.mouseButtons.LEFT=Lt.h.LEFT,n.mouseButtons.RIGHT=Lt.h.RIGHT):(n.mouseButtons.LEFT=Lt.h.RIGHT,n.mouseButtons.RIGHT=Lt.h.LEFT),n.reset(),this.camera=e,this.orbitCameraControls=n,this.addCameraControlsEventListeners(this.orbitCameraControls)}},{key:"makeCamera",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this.makeDefaultCameraDef(this.dimensions,e);this.recreateCamera(t),3===this.dimensions&&this.styles.axesVisible?this.add3dAxes():this.remove3dAxesFromScene()}},{key:"makeCamera3D",value:function(e,t,n){var a,i=t/n;(a=new Lt.l(70,i,.01,100)).position.set(e.position[0],e.position[1],e.position[2]);var r=new Lt.w(e.target[0],e.target[1],e.target[2]);a.lookAt(r),a.zoom=e.zoom,a.updateProjectionMatrix(),this.camera=a,this.makeOrbitControls(a,!0)}},{key:"makeCamera2D",value:function(e,t,n){var a,i=new Lt.w(e.target[0],e.target[1],e.target[2]),r=t/n,o=-1.2,s=Zt,l=-1.2,c=Zt;r>1?(o*=r,s*=r):(c/=r,l/=r),(a=new Lt.k(o,s,c,l,-1e3,1e3)).position.set(e.position[0],e.position[1],e.position[2]),a.up=new Lt.w(0,0,1),a.lookAt(i),a.zoom=e.zoom,a.updateProjectionMatrix(),this.camera=a,this.makeOrbitControls(a,!1)}},{key:"makeDefaultCameraDef",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=2===e,a=n?$t:Yt,i=n?en:Qt,r={orthographic:n,zoom:1,position:[a.x,a.y,a.z],target:[i.x,i.y,i.z]};return t.zoom&&(r.zoom=t.zoom),t.position&&(r.position=t.position),t.target&&(r.target=t.target),r}},{key:"recreateCamera",value:function(e){e.orthographic?this.makeCamera2D(e,this.width,this.height):this.makeCamera3D(e,this.width,this.height),this.interactive&&(this.orbitCameraControls.minDistance=.05,this.orbitCameraControls.maxDistance=10,this.orbitCameraControls.update(),this.orbitAnimationOnNextCameraCreation&&this.startOrbitAnimation())}},{key:"setInteractionMode",value:function(e){this.interactionMode=e,e===Jt.SELECT?(this.selecting=!0,this.container.style.cursor="crosshair"):(this.selecting=!1,this.container.style.cursor="default"),this.orbitCameraControls.enabled=!this.selecting}},{key:"onPointerDown",value:function(e){this.isDragSequence=!1,this.mouseIsDown=!0,this.selecting?(this.orbitCameraControls.enabled=!1,this.rectangleSelector.onMouseDown(e.offsetX,e.offsetY,e.ctrlKey||e.metaKey)):!e.ctrlKey&&this.sceneIs3D()&&this.orbitCameraControls.mouseButtons.ORBIT===Lt.h.RIGHT?(this.orbitCameraControls.mouseButtons.ORBIT=Lt.h.LEFT,this.orbitCameraControls.mouseButtons.PAN=Lt.h.RIGHT):e.ctrlKey&&this.sceneIs3D()&&this.orbitCameraControls.mouseButtons.ORBIT===Lt.h.LEFT&&(this.orbitCameraControls.mouseButtons.ORBIT=Lt.h.RIGHT,this.orbitCameraControls.mouseButtons.PAN=Lt.h.LEFT)}},{key:"onPointerUp",value:function(e){this.selecting?this.rectangleSelector.onMouseUp():(this.hoverPoint.x=e.offsetX,this.hoverPoint.y=e.offsetY,this.clickCallback(this.hoverPoint,e.metaKey||e.ctrlKey)),this.mouseIsDown=!1}},{key:"onPointerMove",value:function(e){this.isDragSequence=this.mouseIsDown,this.selecting&&this.mouseIsDown?this.rectangleSelector.onMouseMove(e.offsetX,e.offsetY):this.mouseIsDown||(this.hoverPoint.x=e.offsetX,this.hoverPoint.y=e.offsetY,this.hoverCallback(this.hoverPoint))}},{key:"onPointerOut",value:function(e){this.selecting||this.hoverCallback(null)}},{key:"onKeyDown",value:function(e){this.sceneIs3D()&&e.shiftKey&&(this.orbitCameraControls.mouseButtons.ORBIT=Lt.h.RIGHT,this.orbitCameraControls.mouseButtons.PAN=Lt.h.LEFT)}},{key:"onKeyUp",value:function(e){this.sceneIs3D()&&e.shiftKey&&(this.orbitCameraControls.mouseButtons.ORBIT=Lt.h.LEFT,this.orbitCameraControls.mouseButtons.PAN=Lt.h.RIGHT)}},{key:"selectBoundingBox",value:function(e,t){this.boxCallback(e,t)}},{key:"selectLasso",value:function(e,t){this.lassoCallback(e,t)}},{key:"computeLayoutValues",value:function(){return this.width=this.container.offsetWidth,this.height=Math.max(1,this.container.offsetHeight),[this.width,this.height]}},{key:"sceneIs3D",value:function(){return 3===this.dimensions}},{key:"remove3dAxesFromScene",value:function(){var e=this.scene.getObjectByName("axes");return null!=e&&this.scene.remove(e),e}},{key:"add3dAxes",value:function(){var e=new Lt.a;e.name="axes",this.scene.add(e)}},{key:"setDimensions",value:function(e){if(2!==e&&3!==e)throw new RangeError("dimensions must be 2 or 3");this.dimensions!==e&&(this.dimensions=e,this.makeCamera())}},{key:"getCameraPosition",value:function(){var e=this.camera.position;return[e.x,e.y,e.z]}},{key:"getCameraTarget",value:function(){var e=this.orbitCameraControls.target;return[e.x,e.y,e.z]}},{key:"setCameraPositionAndTarget",value:function(e,t){this.stopOrbitAnimation(),this.camera.position.set(e[0],e[1],e[2]),this.orbitCameraControls.target.set(t[0],t[1],t[2]),this.orbitCameraControls.update(),this.render()}},{key:"startOrbitAnimation",value:function(){this.sceneIs3D()&&(null!=this.orbitAnimationId&&this.stopOrbitAnimation(),this.orbitCameraControls.autoRotate=!0,this.orbitCameraControls.rotateSpeed=7,this.updateOrbitAnimation())}},{key:"orbitIsAnimating",value:function(){return null!=this.orbitAnimationId}},{key:"updateOrbitAnimation",value:function(){var e=this;this.orbitCameraControls.update(),this.orbitAnimationId=requestAnimationFrame((function(){return e.updateOrbitAnimation()}))}},{key:"stopOrbitAnimation",value:function(){this.orbitCameraControls.autoRotate=!1,this.orbitCameraControls.rotateSpeed=1,null!=this.orbitAnimationId&&(cancelAnimationFrame(this.orbitAnimationId),this.orbitAnimationId=null)}},{key:"getActiveVisualizers",value:function(){return this.visualizers}},{key:"setActiveVisualizers",value:function(e){var t=this;this.visualizers.forEach((function(t){-1===e.indexOf(t)&&t.dispose()})),this.visualizers=e,this.visualizers.forEach((function(e){e.setScene(t.scene),e.onResize(t.width,t.height),t.worldSpacePointPositions&&e.onPointPositionsChanged(t.worldSpacePointPositions)}))}},{key:"dispose",value:function(){this.visualizers.forEach((function(e){return e.dispose()})),this.visualizers=[]}},{key:"setPointPositions",value:function(e){this.worldSpacePointPositions=e,this.visualizers.forEach((function(t){return t.onPointPositionsChanged(e)}))}},{key:"render",value:function(){var e=this.camera.position.clone();e.x+=1,e.y+=1,this.light.position.set(e.x,e.y,e.z);var t=this.camera instanceof Lt.l?Vt.Perspective:Vt.Orthographic,n=[0,0];null!=this.worldSpacePointPositions&&(n=function(e,t,n){for(var a=1/0,i=0,r=(new Lt.w).copy(n).sub(t),o=(new Lt.w).copy(r).normalize(),s=e.length/3,l=0,c=new Lt.w,u=new Lt.w,d=0;d<s;d++){c.x=e[l],c.y=e[l+1],c.z=e[l+2],l+=3,u.copy(c).sub(t);var h=o.dot(u);h<0||(i=h>i?h:i,a=h<a?h:a)}return[a,i]}(this.worldSpacePointPositions,this.camera.position,this.orbitCameraControls.target));var a=new qt(this.camera,t,this.orbitCameraControls.target,this.width,this.height,n[0],n[1],this.styles.backgroundColor,this.pointColors,this.pointScaleFactors,this.labels,this.polylineColors,this.polylineOpacities,this.polylineWidths);this.visualizers.forEach((function(e){return e.onRender(a)})),this.renderer.setRenderTarget(null),this.renderer.render(this.scene,this.camera)}},{key:"setPointColors",value:function(e){this.pointColors=e}},{key:"setPointScaleFactors",value:function(e){this.pointScaleFactors=e}},{key:"setLabels",value:function(e){this.labels=e}},{key:"setPolylineColors",value:function(e){this.polylineColors=e}},{key:"setPolylineOpacities",value:function(e){this.polylineOpacities=e}},{key:"setPolylineWidths",value:function(e){this.polylineWidths=e}},{key:"resetZoom",value:function(){this.recreateCamera(this.makeDefaultCameraDef(this.dimensions)),this.render()}},{key:"setDayNightMode",value:function(e){for(var t=this.container.querySelectorAll("canvas"),n=e?"invert(100%)":"",a=0;a<t.length;a++)t[a].style.filter=n}},{key:"resize",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=[this.width,this.height],n=t[0],a=t[1],i=this.computeLayoutValues(),r=Object(Xe.a)(i,2),o=r[0],s=r[1];if(3===this.dimensions){var l=this.camera;l.aspect=o/s,l.updateProjectionMatrix()}else{var c=this.camera,u=o/n,d=s/a,h=(c.right-c.left)*u/2,p=(c.top-c.bottom)*d/2;c.top=p,c.bottom=-p,c.left=-h,c.right=h,c.updateProjectionMatrix()}var f=window.devicePixelRatio||1;this.renderer.setPixelRatio(f),this.renderer.setSize(o,s),this.visualizers.forEach((function(e){return e.onResize(o,s)})),e&&this.render()}},{key:"updateFromCameraDef",value:function(e){if(e.position&&this.camera.position.set(e.position[0],e.position[1],e.position[2]),e.target){var t=new Lt.w(e.target[0],e.target[1],e.target[2]);this.camera.lookAt(t)}null!=e.zoom&&(this.camera.zoom=e.zoom),this.camera.updateProjectionMatrix()}},{key:"getCameraDef",value:function(){var e={},t=this.camera.position,n=this.orbitCameraControls.target;return e.position=[t.x,t.y,t.z],e.target=[n.x,n.y,n.z],e.zoom=this.camera.zoom,e}}]),e}();function nn(e){var t={backgroundColor:"#ffffff",axesVisible:!0,fog:{color:"#ffffff",enabled:!0,threshold:5e3},label:{fontSize:10,scaleDefault:1,scaleLarge:2,fillColorSelected:"#000000",fillColorHover:"#000000",strokeColorSelected:"#ffffff",strokeColorHover:"#ffffff",strokeWidth:3,fillWidth:6},label3D:{fontSize:80,scale:2.2,color:"black",backgroundColor:"#ffffff",colorUnselected:"#ffffff",colorNoSelection:"#ffffff"},point:{colorUnselected:"rgba(227, 227, 227, 0.7)",colorNoSelection:"rgba(117, 117, 217, 0.7)",colorSelected:"rgba(250, 102, 102, 0.7)",colorHover:"rgba(118, 11, 79, 0.7)",scaleDefault:1,scaleSelected:1.2,scaleHover:1.2},polyline:{startHue:60,endHue:360,saturation:1,lightness:.3,defaultOpacity:.2,defaultLineWidth:2,selectedOpacity:.9,selectedLineWidth:3,deselectedOpacity:.05},select:{fill:"#dddddd",fillOpacity:.2,stroke:"#aaaaaa",strokeWidth:2,strokeDashArray:"10 5"},sprites:{minPointSize:5,imageSize:30,colorUnselected:"#ffffff",colorNoSelection:"#ffffff"}};if(void 0===e)return t;for(var n in t){var a=n;"object"===typeof t[a]&&"object"===typeof e[a]?t[a]=Object.assign(t[a],e[a]):void 0!==e[a]&&(t[a]=e[a])}return t}var an=function(){function e(t,n){Object(j.a)(this,e),this.styles=n,this.id="SVG_LABELS",this.worldSpacePointPositions=new Float32Array(0),this.labelsActive=!0,this.labelStrings=[],this.fillStyle="black",this.shadowColor="white",this.shadowStroke=4,this.font="bold 14px Roboto Condensed",this.svgElement=void 0,this.svgElement=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.svgElement.style.height="100%",this.svgElement.style.width="100%",this.svgElement.style.position="absolute",this.svgElement.style.pointerEvents="none",t.insertAdjacentElement("afterbegin",this.svgElement)}return Object(C.a)(e,[{key:"clear",value:function(){this.svgElement.innerHTML=""}},{key:"setLabels",value:function(e,t){this.labelStrings=e,this.worldSpacePointPositions=t}},{key:"createLabel",value:function(e,t){var n=document.createElementNS("http://www.w3.org/2000/svg","text");return n.setAttribute("dominant-baseline","middle"),n.setAttribute("text-anchor","middle"),n.setAttribute("x",""+e.x),n.setAttribute("y",""+e.y),n.innerHTML=t,n}},{key:"draw",value:function(e){var t=e.camera,n=this.worldSpacePointPositions,a=new Lt.w,i=this.labelStrings,r=this.svgElement.parentElement.clientWidth/2,o=this.svgElement.parentElement.clientHeight/2;this.svgElement.style.font=this.font;this.shadowColor,this.shadowColor,this.shadowColor,this.shadowColor;for(var s=0,l=0;s<i.length;s++,l+=3){a.x=n[l],a.y=n[l+1],a.z=n[l+2],a.project(t),a.x=a.x*r+r,a.y=-a.y*o+o;var c=this.createLabel(a,i[s]);c.style.fill="none",c.style.stroke=this.shadowColor,c.style.strokeWidth=this.shadowStroke+"px",this.svgElement.appendChild(c);var u=this.createLabel(a,i[s]);u.style.fill=this.fillStyle,this.svgElement.appendChild(u)}}},{key:"onResize",value:function(e,t){}},{key:"onRender",value:function(e){this.clear(),this.labelsActive&&this.draw(e)}},{key:"dispose",value:function(){}},{key:"onPointPositionsChanged",value:function(e){}},{key:"setScene",value:function(e){}},{key:"onPickingRender",value:function(e){}}]),e}(),rn=n(216),on=n.n(rn);function sn(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"black",a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:150,r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:12,o=t.domain();if(o[0]!==o[1]){for(var s=10,l=e.createLinearGradient(0,0,i,r),c=Object(_.a)().range([0,1]).domain(o).clamp(!0),u=o[0],d=(o[1]-o[0])/s,h=0;h<s;h++){h===s-1&&(u=o[1]);var p=c(u);if(!isNaN(p)){var f=t(u);l.addColorStop(p,f)}u+=d}e.fillStyle=l,e.fillRect(0,0,i,r),e.strokeStyle="LightGrey",e.strokeRect(0,0,i,r),a&&(e.textBaseline="top",e.fillStyle=n,e.textAlign="left",e.fillText(zt(o[0]),0,r+2),e.textAlign="right",e.fillText(zt(o[1]),i,r+2))}}var ln=function(e){Object(O.a)(n,e);var t=Object(x.a)(n);function n(e){var a;return Object(j.a)(this,n),(a=t.call(this,e)).ref=i.a.createRef(),a.backingScale=1,a}return Object(C.a)(n,[{key:"redraw",value:function(){var e=this.backingScale,t=this.ref.current.getContext("2d"),n=this.props.height,a=this.props.width,i=this.props.textColor||"black";t.clearRect(0,0,a*e,n*e),t.scale(e,e);var r=this.props.scale;null!=r&&(t.font=cn,sn(t,r,i,this.props.label,a,n),t.setTransform(1,0,0,1,0,0))}},{key:"componentDidMount",value:function(){this.redraw()}},{key:"componentDidUpdate",value:function(e,t,n){this.redraw()}},{key:"render",value:function(){"undefined"!==typeof window&&"devicePixelRatio"in window&&(this.backingScale=window.devicePixelRatio);var e=this.props.height,t=this.props.width,n={width:t,height:e};return this.props.style&&(n=Object.assign({},n,this.props.style)),Object(V.jsx)("canvas",{width:t*this.backingScale,height:e*this.backingScale,ref:this.ref,style:n})}}]),n}(i.a.PureComponent);var cn="12px Roboto Condensed,Helvetica,Arial,sans-serif",un="12px Helvetica,Arial,sans-serif";function dn(e,t,n,a){var i,r=null,o={width:t.width,height:t.height},s=e.name;if("__count"===s&&(s="count"),"svg"!==a?((r=document.createElement("canvas")).width=100,r.height=100,i=r.getContext("2d")):i=new on.a(100,100),e.continuous)o.height+=150;else{var l=function(e,t,n){e.font="14px Helvetica";var a=e.measureText(t).width;return n.forEach((function(t){return a=Math.max(a,e.measureText(t).width)})),{width:a+14,height:12*n.length+4}}(i,s,e.colorScale.domain());o.width+=l.width,o.height=Math.max(l.height,t.height)}if("svg"===a?i=new window.C2S(o.width,o.height):(r.width=o.width*window.devicePixelRatio,r.height=o.height*window.devicePixelRatio,(i=r.getContext("2d")).scale(window.devicePixelRatio,window.devicePixelRatio),i.fillStyle="white",i.fillRect(0,0,o.width,o.height)),n(i,t,a),e.continuous?(i.translate(t.width/2-75,t.height+2),sn(i,e.colorScale)):(i.translate(t.width,2),function(e,t,n,a){e.font="14px Helvetica",e.textAlign="left",e.textBaseline="bottom";for(var i=0;i<a.length;i++){var r=a[i];e.fillStyle=t(r),e.fillRect(0,12*i,10,10),e.fillStyle="black",e.fillText(""+r,12,12*i+12)}}(i,e.colorScale,0,e.colorScale.domain())),"svg"===a){var c=i.getSerializedSvg(),u=new Blob([c],{type:"text/plain;charset=utf-8"});window.saveAs(u,s+".svg")}else r.toBlob((function(e){window.saveAs(e,s+".png",!0)}))}function hn(e,t,n){var a=function(e,t,n){return Math.min(Math.max(e,t),n)}((n-e)/(t-e),0,1);return a*a*(3-2*a)}function pn(e,t,n){return e*(1-n)+t*n}function fn(e,t,n,a,i,r){var o=new Lt.w;e.fillStyle=a.darkMode?"white":"black",e.strokeStyle=a.darkMode?"rgba(0,0,0,0.9)":"rgba(255,255,255,0.9)",e.lineWidth=a.labelStrokeWidth,e.textAlign="center",e.textBaseline="middle";for(var s=i.width/2,l=i.height/2,c=0,u=0;c<t.length;c++,u+=3)o.x=n[u],o.y=n[u+1],o.z=n[u+2],o.project(r),o.x=o.x*s+s,o.y=-o.y*l+l,e.strokeText(t[c],o.x,o.y),e.fillText(t[c],o.x,o.y)}function vn(e,t){for(var n=0;n<e.visualizers.length;n++)if(e.visualizers[n].id===t)return e.visualizers[n]}function bn(e,t){var n=e.scene.getObjectByName("axes");n&&n.setColors(t?new Lt.d("rgb(255, 255, 255)"):new Lt.d("rgb(0, 0, 0)"))}var mn=Object(P.a)((function(e){return{root:{"& > *":{margin:e.spacing(.4)},"& > .MuiIconButton-root":{padding:0},"& > .cirro-active":{fill:"rgb(220, 0, 78)",color:"rgb(220, 0, 78)"},"& > .cirro-inactive":{fill:"rgba(0, 0, 0, 0.26)",color:"rgba(0, 0, 0, 0.26)"},position:"absolute",top:0,left:0,display:"inline-block",verticalAlign:"top",whiteSpace:"nowrap",overflow:"hidden"}}}))((function(e){var t=Object(a.useRef)(),n=Object(a.useRef)(),i=Object(a.useRef)(),r=Object(a.useState)(!1),o=Object(Xe.a)(r,2),s=o[0],l=o[1],c=Object(a.useRef)();function u(t){var a=e.trace,r=a.positions,o=n.current.camera,s=e.chartSize.width/2,l=e.chartSize.height/2,c=new Lt.w,u=-1;if(-1!==i.current&&(c.x=r[3*i.current],c.y=r[3*i.current+1],c.z=r[3*i.current+2],c.project(o),c.x=c.x*s+s,c.y=-c.y*l+l,Math.abs(c.x-t.x)<=2&&Math.abs(c.y-t.y)<=2&&(u=i.current)),-1===u)for(var d=0,h=0,p=a.x.length;d<p;d++,h+=3)if(c.x=r[h],c.y=r[h+1],c.z=r[h+2],c.project(o),c.x=c.x*s+s,c.y=-c.y*l+l,Math.abs(c.x-t.x)<=2&&Math.abs(c.y-t.y)<=2){u=d;break}return i.current=u,u}function d(t,a,i){var r=e.obsCat,o=e.cachedData,s=e.trace,l=e.markerOpacity,c=e.unselectedMarkerOpacity,u=e.selection,d=e.categoricalNames,h=e.chartOptions,p=n.current,f=function(e){var t=e.x.length,n=200/Math.log(t)/Math.log(8);return 3===e.dimensions?n:n/1.5}(s),v=e.pointSize,b=2*Math.PI,m=s.colors,g=s.positions,j=p.camera,O=a.width,x=a.height;h.darkMode&&(t.fillStyle="black",t.fillRect(0,0,O,x));var y,S=O/2,w=x/2,C=Object(_.a)().domain([0,1]).range([0,255]),k=s.x.length,E=3===s.dimensions,z=p.scene.fog,T=vn(p,gn);if(!E){var P=.9/Math.atan(2),M=j.projectionMatrix.elements[0]+.3;y=f*(M<1?1+P*Math.atan(2*(M-1)):1+8.91267681314614*Math.atan(.02*(M-1)))}var A=y*v;A/=2;var I=new Lt.w,D=new Lt.x,R=T.points,N=R.modelViewMatrix.clone();N.multiplyMatrices(j.matrixWorldInverse,R.matrixWorld);var F,L=h.showFog,B=0===u.size;if(E){F=new Uint32Array(k);for(var U=0;U<k;U++)F[U]=U}else{for(var V=new Float32Array(k),H=0;H<k;H++)V[H]=g[3*H+2];F=be(V,!0)}for(var W=0;W<k;W++){var G=F[W],J=3*G,X=4*G,q=B||u.has(G);I.x=g[J],I.y=g[J+1],I.z=g[J+2],I.project(j);var K=m[X],Z=m[X+1],Y=m[X+2],Q=q?l:c;if(E&&(D.x=g[J],D.y=g[J+1],D.z=g[J+2],D.w=1,D.applyMatrix4(N),A=(y=-f/D.z)*v/4,L)){var $=f/y*1.2,ee=hn(z.near,z.far,$);K=pn(K,z.color.r,ee),Z=pn(Z,z.color.g,ee),Y=pn(Y,z.color.b,ee)}I.x=I.x*S+S,I.y=-I.y*w+w,K=Math.round(C(K)),Z=Math.round(C(Z)),Y=Math.round(C(Y)),t.fillStyle="rgba("+K+","+Z+","+Y+","+Q+")",t.beginPath(),t.arc(I.x,I.y,A,0,b),t.closePath(),t.fill()}if(r.length>0){var te=yn(s.embedding,r,o),ne="svg"===i?"serif":"Roboto Condensed";t.font="bold "+h.labelFontSize+"px "+ne,fn(t,wn(r,te.labels,d),te.positions,h,a,j)}}return Object(a.useEffect)((function(){!function(){if(null==n.current){n.current=xn(t.current,window.ApplePaySession,!0),"pan"===e.chartOptions.dragmode?n.current.setInteractionMode("PAN"):"select"===e.chartOptions.dragmode?(n.current.setInteractionMode("SELECT"),n.current.rectangleSelector.setSelectionMode("BOX")):"lasso"===e.chartOptions.dragmode&&(n.current.setInteractionMode("SELECT"),n.current.rectangleSelector.setSelectionMode("LASSO"));var a=n.current.scene.getObjectByName("axes");a&&(a.visible=e.chartOptions.showAxis,a.setColors(e.chartOptions.darkMode?new Lt.d("rgb(255, 255, 255)"):new Lt.d("rgb(0, 0, 0)"))),vn(n.current,gn).styles.fog.enabled=e.chartOptions.showFog;var i=t.current.querySelector("canvas");i.style.outline="0px";var r=function(e){console.log("lost webgl context"),e.preventDefault(),n.current=null},o=function(e){console.log("restored webgl context"),e.preventDefault(),l(!s)};return i.addEventListener("webglcontextlost",r),i.addEventListener("webglcontextrestored",o),!0}}(),c.current!==e.chartSize&&n.current.resize(),function(){var t=e.obsCat,a=e.cachedData,i=e.trace,r=e.markerOpacity,o=e.unselectedMarkerOpacity,s=e.selection,l=e.pointSize,c=e.chartOptions,u=e.categoricalNames,d=e.unselectedPointSize;Sn(n.current,i,s,r,o,l,d,u,c,t,a)}(),bn(n.current,e.chartOptions.darkMode),e.chartOptions.scatterPlot=n.current,e.chartOptions.camera&&(n.current.updateFromCameraDef(e.chartOptions.camera),e.chartOptions.camera=null),c.current=e.chartSize,n.current.clickCallback=function(t,n){if(!e.trace.continuous){var a=u(t);-1!==a&&e.handleClick({name:e.trace.name,value:e.trace.values[a],shiftKey:!1,metaKey:n}),i.current=a}},n.current.hoverCallback=function(t){if(null==t)e.setTooltip("");else{var n=u(t);if(-1!==n){var a=e.trace,i=a.values[n],r=(e.categoricalNames[a.name]||{})[i];null!=r&&null!=r.newValue&&(i=r.newValue),"number"===typeof i&&(i=Tt(i)).endsWith(".00")&&(i=i.substring(0,i.lastIndexOf("."))),e.setTooltip(""+i)}else e.setTooltip("")}},n.current.lassoCallback=function(t,a){for(var i=e.trace,r=i.positions,o=n.current.camera,s=e.chartSize.width/2,l=e.chartSize.height/2,c=new Lt.w,u=new Set,d=0,h=0,p=i.x.length;d<p;d++,h+=3)c.x=r[h],c.y=r[h+1],c.z=r[h+2],c.project(o),c.x=c.x*s+s,c.y=-c.y*l+l,xe(c,t)&&u.add(d);0===u.size?e.onSelected({name:Ma(i.embedding)}):e.onSelected({name:Ma(i.embedding),clear:!a,value:{basis:i.embedding,indices:u}})},n.current.boxCallback=function(t,a){if("PAN"!==n.current.interactionMode){for(var i=e.trace,r=i.positions,o=n.current.camera,s=e.chartSize.width/2,l=e.chartSize.height/2,c=new Lt.w,u=new Set,d=0,h=0,p=i.x.length;d<p;d++,h+=3)c.x=r[h],c.y=r[h+1],c.z=r[h+2],c.project(o),c.x=c.x*s+s,c.y=-c.y*l+l,c.x>=t.x&&c.x<=t.x+t.width&&c.y>=t.y&&c.y<=t.y+t.height&&u.add(d);0===u.size?e.onSelected({name:Ma(i.embedding)}):e.onSelected({name:Ma(i.embedding),clear:!a,value:{basis:i.embedding,indices:u}})}},n.current.cameraCallback=function(t){"PAN"===n.current.interactionMode&&3===e.trace.dimensions&&"end"===t&&function(t){e.onCamera(t,n.current.getCameraDef())}(t)}})),Object(a.useEffect)((function(){return function(){n.current.dispose()}}),[]),Object(V.jsxs)(V.Fragment,{children:[Object(V.jsx)("div",{className:e.classes.root,children:Object(V.jsx)(kt,{dragmode:e.chartOptions.dragmode,onGallery:e.onGallery,animating:e.chartOptions.animating,showFog:e.chartOptions.showFog,onShowFog:function(){var t=n.current;e.chartOptions.showFog=!e.chartOptions.showFog,vn(t,gn).styles.fog.enabled=e.chartOptions.showFog,e.setChartOptions(e.chartOptions)},is3d:e.trace&&null!=e.trace.z,toggleAnimation:function(){var t=n.current;t.orbitIsAnimating()?(t.stopOrbitAnimation(),e.chartOptions.animating=!1):(t.startOrbitAnimation(),e.chartOptions.animating=!0),e.setChartOptions(e.chartOptions)},onSaveImage:function(t){dn(e.trace,e.chartSize,d,t)},onDragMode:function(t){var a=n.current;"pan"===t?a.setInteractionMode("PAN"):"select"===t?(a.setInteractionMode("SELECT"),a.rectangleSelector.setSelectionMode("BOX")):"lasso"===t&&(a.rectangleSelector.setSelectionMode("LASSO"),a.setInteractionMode("SELECT")),e.chartOptions.dragmode=t,e.setChartOptions(e.chartOptions)},onShowAxis:function(){var t=n.current.scene.getObjectByName("axes");e.chartOptions.showAxis=!e.chartOptions.showAxis,t&&(t.visible=e.chartOptions.showAxis),e.setChartOptions(e.chartOptions)},onHome:function(){var t=n.current;t.resetZoom(),"PAN"===t.interactionMode&&3===e.trace.dimensions&&e.onCamera("change",t.getCameraDef())},showAxis:e.chartOptions.showAxis})}),Object(V.jsx)("div",{"data-testid":"scatter-chart-three",style:{display:"inline-block",width:e.chartSize.width,height:e.chartSize.height},ref:t})]})})),gn="SPRITES",jn="SVG_LABELS";function On(e,t,n){var a=t[1]-t[0],i=n[1]-n[0];return(e-t[0])/a*i+n[0]}function xn(e,t,n){var a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=nn();i.label3D.fontSize=40;var r=new tn(e,{camera:{},selectEnabled:!1,styles:i,interactive:a},t),o=[new Wt(i)];return n&&o.push(new an(e,i)),r.setActiveVisualizers(o),r}function yn(e,t,n){var a=[];t.forEach((function(e){var t=n[e];a.push(t)}));var i=Ma(e),r=n[i];if(null==r)throw new Error("Coordinates not found for "+e.name);for(var o,s,l,c,u,d,h=r[e.name+"_1"],p=r[e.name+"_2"],f=r[e.name+"_3"],v=null!=f,b={},m=0,g=null!=e.spatial,j=h.length,O=t.length,x=0;x<j;x++){for(var y=[],S=0;S<O;S++)y.push(a[S][x]);var w=y.join(","),C=b[w];void 0===C&&(C={x:[],y:[],z:[],array:y},b[w]=C,m++),C.count++,C.x.push(h[x]),C.y.push(p[x]),v&&C.z.push(f[x])}if(!g){var k=function(e){return Math.abs(e[1]-e[0])};c=[1/0,-1/0],u=[1/0,-1/0],d=v?[1/0,-1/0]:[0,1];for(var E=0;E<j;E++){var z=h[E];z<c[0]&&(c[0]=z),z>c[1]&&(c[1]=z),(z=p[E])<u[0]&&(u[0]=z),z>u[1]&&(u[1]=z),v&&((z=f[E])<d[0]&&(d[0]=z),z>d[1]&&(d[1]=z))}var T=k(c),P=k(u),M=k(d),A=Math.max(T,P,M),I=function(e,t){return[e/A*-t,t*(e/A)]};o=I(T,1),s=I(P,1),l=I(M,1)}var D=[],_=new Float32Array(3*m),R=0;for(var N in b){var F=b[N];D.push(F.array),F.x.sort((function(e,t){return e-t})),F.y.sort((function(e,t){return e-t})),F.z.sort((function(e,t){return e-t}));var L=F.x.length/2,B=L%1?F.x[L-.5]:(F.x[L-1]+F.x[L])/2,U=L%1?F.y[L-.5]:(F.y[L-1]+F.y[L])/2,V=L%1?F.z[L-.5]:(F.z[L-1]+F.z[L])/2;g||(B=On(B,c,o),U=On(U,u,s),V=On(V,d,l)),_[R]=B,_[R+1]=U,_[R+2]=v?V:0,R+=3}return{labels:D,positions:_}}function Sn(e,t,n,a,i,r,o){var s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:{},l=arguments.length>8?arguments[8]:void 0,c=arguments.length>9?arguments[9]:void 0,u=arguments.length>10?arguments[10]:void 0,d=arguments.length>11?arguments[11]:void 0,h=null!=t.z,p=t.colors,f=t.positions,v=t.x.length,b=0===n.size,m=!b&&!h;m&&(f=f.slice());var g=new Float32Array(t.x.length);g.fill(r);for(var j=0,O=3,x=2;j<v;j++,O+=4,x+=3){var y=b||n.has(j);p[O]=y?a:i,y||(g[j]=o),m&&!y&&(f[x]=-1)}e.scene.background=l.darkMode?new Lt.d("rgb(0, 0, 0)"):null,e.setDimensions(t.dimensions),d&&e.updateFromCameraDef(d);var S=vn(e,gn);S.styles.fog.enabled=l.showFog;var w=e.scene.getObjectByName("axes");w&&(bn(e,l.darkMode),w.visible=l.showAxis),e.setPointColors(p),e.setPointPositions(f),e.setPointScaleFactors(g);var C=c.length>0,k=vn(e,jn);if(k&&(k.labelsActive=C,C)){var E=Ma(t.embedding)+"_"+c.join(","),z=u[E];null==z&&(z=yn(t.embedding,c,u),u[E]=z),k.fillStyle=l.darkMode?"white":"black",k.shadowColor=l.darkMode?"rgba(0,0,0,0.9)":"rgba(255,255,255,0.9)",k.shadowStroke=l.labelStrokeWidth,k.font="bold "+l.labelFontSize+"px Roboto Condensed";var T=wn(c,z.labels,s);k.setLabels(T,z.positions)}e.render()}function wn(e,t,n){var a=[],i=[];e.forEach((function(e){return i.push(n[e]||{})}));for(var r=0;r<t.length;r++){for(var o=t[r],s=[],l=0;l<o.length;l++){var c=i[l][o[l]];s.push(null!=c&&null!=c.newValue?c:o[l])}a.push(s.join(","))}return a}var Cn=Object({NODE_ENV:"production",PUBLIC_URL:".",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_VERSION:"1.1.2-2.post2"}).REACT_APP_API_URL||"api",kn=["email"],En=.1,zn="Viridis",Tn="Reds",Pn=!!window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,Mn="SET_EMBEDDING_LABELS",An="SET_DISTRIBUTION_PLOT_INTERPOLATOR",In="SET_CHART_OPTIONS",Dn="SET_COMBINE_DATASET_FILTERS",_n="SET_DATASET_FILTERS",Rn="SET_DATASET_VIEWS",Nn="SET_LEGEND_SCROLL_POSITION",Fn="SET_ACTIVE_FEATURE",Ln="SET_CHART_SIZE",Bn="SET_PRIMARY_CHART_SIZE",Un="SET_SERVER_INFO",Vn="SET_DATASET_FILTER",Hn="ADD_DATASET",Wn="DELETE_DATASET",Gn="UPDATE_DATASET",Jn="SET_GLOBAL_FEATURE_SUMMARY",Xn="SET_SAVED_DATASET_STATE",qn="SET_DOMAIN",Kn="UPDATE_CATEGORICAL_COLOR",Zn="SET_CATEGORICAL_NAME",Yn="UPDATE_CATEGORICAL_NAME",Qn="SET_MARKER_OPACITY",$n="SET_UNSELECTED_MARKER_OPACITY",ea="SET_SELECTION",ta="SET_FEATURE_SUMMARY",na="SET_SEARCH_TOKENS",aa="SET_SELECTED_EMBEDDING",ia="SET_MESSAGE",ra="SET_INTERPOLATOR",oa="SET_POINT_SIZE",sa="SET_UNSELECTED_POINT_SIZE",la="SET_EMAIL",ca="SET_USER",ua="SET_DATASET",da="SET_MARKERS",ha="SET_DIALOG",pa="OPEN_DATASET_DIALOG",fa="EDIT_DATASET_DIALOG",va="IMPORT_DATASET_DIALOG",ba="SAVE_DATASET_FILTER_DIALOG",ma="SAVE_FEATURE_SET_DIALOG",ga="HELP_DIALOG",ja="DELETE_DATASET_DIALOG",Oa="SET_DATASET_CHOICES",xa="RESTORE_VIEW",ya="SET_DISTRIBUTION_DATA",Sa="SET_SELECTED_DISTRIBUTION_DATA",wa="SET_DISTRIBUTION_PLOT_OPTIONS",Ca="SET_EMBEDDING_DATA",ka="SET_LOADING",Ea="SET_TAB",za="LOADING_APP",Ta="SET_JOB_RESULTS",Pa="SET_JOB_RESULT";function Ma(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=e.name;return null!=e.mode&&t&&(n+="_"+e.mode),n}function Aa(e){return e.name+"_"+Ma(e.embedding)}function Ia(){return function(e,t){window.gapi.auth2.getAuthInstance().signOut().then((function(){e({type:la,payload:null}),e(xi(null))}))}}function Da(e){return function(t,n){t(gi(!0)),n().serverInfo.api.getViewPromise(e).then((function(e){var n=Object(f.isString)(e.value)?JSON.parse(e.value):e.value;n.dataset=e.dataset_id,t(si(n))})).finally((function(){t(gi(!1))})).catch((function(e){Li(t,e,"Unable to retrieve link. Please try again.")}))}}function _a(e){return function(t,n){t(gi(!0)),n().serverInfo.api.deleteViewPromise(e,n().dataset.id).then((function(){for(var a,i=n().datasetViews,r=0;r<i.length;r++)if(i[r].id===e){i.splice(r,1);break}t((a=i.slice(),{type:_n,payload:a})),t(pi("Link deleted"))})).finally((function(){t(gi(!1)),t(vi(null))})).catch((function(e){Li(t,e,"Unable to delete link. Please try again.")}))}}function Ra(e){return function(t,n){var a;function i(){n().dataset.api.getJobStatus(a).then((function(r){var o=Object(f.find)(n().jobResults,(function(e){return e.id===a})),s=o.status!==r.status;o.status=r.status;var l=!0;"complete"===r.status?(t(pi(e.name+": complete")),t(yi(n().jobResults.slice())),l=!1):"error"===r.status?(Li(t,new S("Unable to complete job. Please try again.")),l=!1):s&&(t(pi(e.name+": "+r.status)),t(yi(n().jobResults.slice()))),l&&window.setTimeout(i,5e3)})).catch((function(e){Li(t,e,"Unable to get job. Please try again.")}))}e.id=n().dataset.id,null==e.params.filter&&(e.params.filter=Ba(n())),n().serverInfo.api.submitJob(e).then((function(r){t(pi("Job submitted")),a=r.id,e.email=n().email,e.id=a,n().jobResults.push(e),t(yi(n().jobResults.slice())),window.setTimeout(i,5e3)})).finally((function(){})).catch((function(e){Li(t,e,"Unable to submit job. Please try again.")}))}}function Na(e){return function(t,n){t(gi(!0)),n().serverInfo.api.deleteFeatureSet(e,n().dataset.id).then((function(a){for(var i=n().markers,r=!1,o=0;o<i.length;o++)if(i[o].id===e){i.splice(o,1),r=!0;break}r||console.log("Unable to find feature set id "+e),t(bi(i.slice())),t(pi("Set deleted"))})).finally((function(){t(gi(!1))})).catch((function(e){Li(t,e,"Unable to delete set. Please try again.")}))}}function Fa(e){return function(t,n){if(null==e)t(qa({}));else{var a=n().datasetFilter;if("selection"===e)for(var i in a)Array.isArray(a[i])&&delete a[i];else delete a[e];t(qa(Object.assign({},a)))}t(Ya())}}function La(e){var t=new Set,n=new Set;for(var a in e){var i=e[a];Array.isArray(i)||("in"===i.operation?t.add(a):""===i.operation||isNaN(i.value)||null==i.value||t.add(a))}return{features:t,basis:n}}function Ba(e){return Ua(e.dataset,e.datasetFilter,e.combineDatasetFilters)}function Ua(e,t,n){var a=function(e){var t=[],n=new Set;for(var a in e){var i=e[a];Array.isArray(i)&&i.forEach((function(e){e.indices.forEach((function(e){return n.add(e)}))}))}for(var r in n.size>0&&t.push(["__index","in",n]),e){var o=e[r],s=null;Array.isArray(o)||("in"===o.operation?s=[r,o.operation,o.value]:null==o.operation||""===o.operation||isNaN(o.value)||null==o.value||(s=[r,o.operation,o.value]),null!=s&&t.push(s))}return t}(t);if(a.length>0){for(var i=e.obs,r=e.obsCat,o=0;o<a.length;o++){var s=a[o];"__index"===s[0]?s[2]=Array.from(s[2]):-1===r.indexOf(s[0])&&-1===i.indexOf(s[0])||(s[0]="obs/"+s[0])}return{filters:a,combine:n}}}function Va(e){return{type:wa,payload:e}}function Ha(e){return{type:In,payload:e}}function Wa(e){return function(t,n){t(function(e){return{type:Dn,payload:e}}(e)),t(Ya())}}function Ga(e){return{type:Bn,payload:e}}function Ja(e){return{type:Fn,payload:e}}function Xa(e){return{type:Jn,payload:e}}function qa(e){return{type:Vn,payload:e}}function Ka(e){return{type:ea,payload:e}}function Za(e){return{type:ta,payload:e}}function Ya(){return function(e,t){e(gi(!0));var n=t(),a=ze(n.searchTokens),i=Ba(n);ke(Ee(n.markers,a.featureSets),a.X);var r={selection:{measures:a.X.concat(a.obs.map((function(e){return"obs/"+e}))),dimensions:a.obsCat}};if(i&&(r.selection.filter=i),null==i)return 0!==n.selection.size&&e(Ka(new Set)),e(ki([])),e(Za({})),void e(gi(!1));var o=n.cachedData;t().dataset.api.getDataPromise(r,o).then((function(t){e(Ii(t.selection,!0))})).catch((function(t){Li(e,t)})).finally((function(){return e(gi(!1))}))}}function Qa(e){return{type:qn,payload:e}}function $a(e){return{type:Zn,payload:e}}function ei(e){return{type:Yn,payload:e}}function ti(e){return{type:Kn,payload:e}}function ni(e){return{type:ca,payload:e}}function ai(e){return{type:Un,payload:e}}function ii(e){var t=e.embeddings.map((function(e){return e.name})),n=null,a=null;if(t.length>0){for(var i=["tissue_hires","fle","umap","tsne"],r=null,o=0;o<i.length&&null==r;o++)for(var s=0;s<t.length;s++)if(-1!==t[s].toLowerCase().indexOf(i[o])){r=t[s];break}null==r&&(r=t[0]),n=e.embeddings[e.embeddings.map((function(e){return e.name})).indexOf(r)]}if(null!=e.markers_read_only&&e.markers_read_only.length>0){var l=e.markers_read_only[0].category,c=" (rank_genes_groups)";l.endsWith(c)&&(l=l.substring(0,l.length-c.length)),-1!==e.obsCat.indexOf(l)&&(a=l)}if(null==a)for(var u=["anno","cell_type","celltype","leiden","louvain","seurat_cluster","cluster"],d=0;d<u.length&&null==a;d++)for(var h=0;h<e.obsCat.length;h++)if(-1!==e.obsCat[h].toLowerCase().indexOf(u[d])){a=e.obsCat[h];break}return{selectedEmbedding:n,obsCat:a}}function ri(){return function(e,t){var n=ii(t().dataset),a=n.selectedEmbedding,i=n.obsCat;null!=i&&e(Ti([{value:i,type:Y}])),null!=a&&e(Pi([a]))}}function oi(){return function(e,t){null==t().dataset&&1===t().datasetChoices.length?e(Ai(t().datasetChoices[0].id)):t().datasetChoices.length>0&&e(vi(pa))}}function si(e){return function(t,n){if(null!=e.colorScheme&&(e.colorScheme.value=we(e.colorScheme.name)),null==e.datasetFilter)e.datasetFilter={};else for(var a in e.datasetFilter){var i=e.datasetFilter[a];i.operation&&(i.uiValue=i.value)}t(gi(!0)),(null!=e.dataset?t(Ai(e.dataset,!1,!1)):Promise.resolve()).then((function(){var t=n().dataset;if(e.embeddings&&e.embeddings.length>0){var a=t.embeddings.map((function(e){return Ma(e)})),i=[];e.embeddings.forEach((function(e){var n=a.indexOf(Ma(e));-1!==n&&i.push(t.embeddings[n])})),e.embeddings=i,null!=e.camera&&(null==e.chartOptions&&(e.chartOptions={}),e.chartOptions.camera=e.camera)}else{var r=ii(t),o=r.selectedEmbedding,s=r.obsCat;o&&(e.embeddings=[o],null!=s&&(e.q=[{value:s,type:"obsCat"}],e.activeFeature={name:s,type:"obsCat",embeddingKey:s+"_"+Ma(o)}))}})).then((function(){return t(qa(e.datasetFilter))})).then((function(){return t({type:xa,payload:e})})).then((function(){return t(_i())})).then((function(){return t(Ya())})).then((function(){null!=e.distributionPlotOptions&&t(Va(e.distributionPlotOptions));var a=e.activeFeature;null==a&&e.embeddings&&e.embeddings.length>0&&null!=e.q&&e.q.length>0&&(a={name:e.q[0],type:Ni(n().dataset,e.q[0]),embeddingKey:e.q[0]+"_"+Ma(e.embeddings[0])}),null!=a&&t(Ja(a))})).finally((function(){return t(gi(!1))})).catch((function(e){console.log(e),t(pi("Unable to restore saved view.")),t(oi())}))}}function li(){return function(e,t){var n={dataset:null},a=window.location.hash.substring(3);if(a.length>0)try{n=JSON.parse(window.decodeURIComponent(a))}catch(i){return e(pi("Unable to restore view."))}null!=n.link?e(Da(n.link,!0)):null!=n.dataset?e(si(n)):e(oi())}}function ci(e){return function(t,n){if(window.gapi.auth2.getAuthInstance().isSignedIn.get()){var a=window.gapi.auth2.getAuthInstance().currentUser.get().getBasicProfile().getEmail();t(Ei(a)),t((function(e,t){t().serverInfo.api.getUserPromise().then((function(t){return e(ni(t))}))})),t(Bi()).then((function(){e&&t(li())}))}}}function ui(){return"undefined"!==typeof window.gapi?window.gapi.auth2.getAuthInstance().currentUser.get().getAuthResponse().id_token:""}function di(e){return function(t,n){var a=e.readers,i=e.dataset,r=null!=i,o={};if(null!=i){var s=new Set(i.readers),l=s.size===a.length;if(l)for(var c=0;c<a.length;c++)if(!s.has(a[c])){l=!1;break}l||(o.readers=a)}null==i&&(i={});var u=new Set(["readers","dataset"]);for(var d in e)if(!u.has(d)){var h=e[d];null!=h&&h!==i[d]&&(o[d]=h)}if(0!==Object.keys(o).length){r&&(o.id=e.dataset.id),t(gi(!0));var p=n().serverInfo.api.upsertDatasetPromise(o);p.upload.addEventListener("progress",(function(e){if(null!=o.file){var n=e.loaded/e.total*100;t(pi("Percent "+n))}})),p.addEventListener("load",(function(e){if(t(gi(!1)),t(vi(null)),200!=p.status)return t(pi("Unable to save dataset. Please try again."));var n=JSON.parse(p.response);delete o.file,(i=Object.assign({},i,o,n)).owner=!0,r?(t(function(e){return{type:Gn,payload:e}}(i)),t(pi("Dataset updated"))):(t(function(e){return{type:Hn,payload:e}}(i)),t(pi("Dataset added")))}))}}}function hi(e){return function(t,n){t(gi(!0)),n().serverInfo.api.deleteDatasetPromise(e.dataset.id).then((function(){t(xi(null)),t(function(e){return{type:Wn,payload:e}}({id:e.dataset.id})),t(vi(null)),t(pi("Dataset deleted"))})).finally((function(){t(gi(!1)),t(vi(null))})).catch((function(e){Li(t,e,"Unable to delete dataset. Please try again.")}))}}function pi(e){return{type:ia,payload:e}}function fi(e){return{type:Ca,payload:e}}function vi(e){return{type:ha,payload:e}}function bi(e){return{type:da,payload:e}}function mi(e){return{type:Oa,payload:e}}function gi(e){return{type:ka,payload:e}}function ji(e){return{type:Ea,payload:e}}function Oi(e){return{type:za,payload:e}}function xi(e){return{type:ua,payload:e}}function yi(e){return{type:Ta,payload:e}}function Si(e){return{type:Pa,payload:e}}function wi(e){return function(t,n){var a=n().embeddingLabels,i=a.indexOf(e);return-1===i?a.push(e):a.splice(i,1),t({type:Mn,payload:a.slice()})}}function Ci(e){return{type:ya,payload:e}}function ki(e){return{type:Sa,payload:e}}function Ei(e){return{type:la,payload:e}}function zi(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return function(i,r){var o=r(),s=o.searchTokens,l=[t];t===Z&&l.push(Y),a&&(s=s.filter((function(e){return-1===l.indexOf(e.type)})));var c=new Set;if(s.forEach((function(e){return c.add(e.value)})),t===Z){var u=o.dataset.obsCat;e.forEach((function(e){var t=-1!==u.indexOf(e)?Y:Z;c.has(e)||(c.add(e),s.push({value:e,type:t}))}))}else e.forEach((function(e){c.has(e)||(c.add(e),s.push({value:e,type:t}))}));i({type:na,payload:s.slice()}),i(_i(null,n))}}function Ti(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return function(n,a){n({type:na,payload:e}),n(_i(null,t))}}function Pi(e){return function(t,n){var a=n().embeddings;t({type:aa,payload:e}),t(_i((function(e){t({type:aa,payload:a})})))}}function Mi(e){return{type:Rn,payload:e}}function Ai(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return function(a,i){n&&a(gi(!0));for(var r=i().savedDatasetState[e],o=i().datasetChoices,s=null,l=0;l<o.length;l++)if(o[l].id===e){s=o[l];break}if(null==s)for(var c=0;c<o.length;c++)if(o[c].name===e){s=o[c];break}if(null==s)return a(gi(!1)),a(pi("Unable to find dataset")),Promise.reject("Unable to find dataset");var u,d=Object.assign({},s);d.id=e,d.embeddings=[],d.features=[],d.obs=[],d.obsCat=[];var h,p=[],f=[];var v="direct"===d.access||"true"===Object({NODE_ENV:"production",PUBLIC_URL:".",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_VERSION:"1.1.2-2.post2"}).REACT_APP_STATIC;d.api=v?new We:new Rt;var b=[d.api.init(e,d.url)];b.push(d.api.getJobs(e).then((function(e){f=e})));var m=d.api.getSchemaPromise().then((function(e){h=e}));if(b.push(m),!v){var g=i().serverInfo.api.getCategoryNamesPromise(d.id).then((function(e){u=e})),j=i().serverInfo.api.getViewsPromise(d.id).then((function(e){p=e}));b.push(g),b.push(j)}return Promise.all(b).then((function(){return(h=Object.assign({},d,h)).api=d.api,h.features=h.var,h.features.sort((function(e,t){return e=e.toLowerCase(),t=t.toLowerCase(),e[0]>="0"&&e[0]<="9"&&(e="zzzzzz"+e),t[0]>="0"&&t[0]<="9"&&(t="zzzzzz"+t),e<t?-1:e===t?0:1})),h.id=e,a(xi(h)),h.results&&h.results.length>0&&(f=f.concat(h.results)),a(yi(f)),null!=u&&a($a(u)),a(Mi(p)),void(r?a(si(r)):t&&a(ri()))})).finally((function(){n&&a(gi(!1))})).catch((function(e){Li(a,e,"Unable to retrieve dataset. Please try again.")}))}}function Ii(e,t){return function(n,a){var i=a();if(e){if(n(Ka(e.indices)),e.summary)n(Za(t?e.summary:Object.assign({},a().featureSummary,e.summary)));if(e.distribution){var r=i.selectedDistributionData;t&&(r=[]);var o=ze(i.searchTokens);ke(Ee(i.markers,o.featureSets),o.X),n(ki(r=Di(e.distribution,r,o)))}}}}function Di(e,t,n){var a=new Set(Object.keys(t));if(e)for(var i in e)a.add(i);return a.forEach((function(a){t[a]=function(e,t,n){var a=[n.obsCat.join("-")],i=t.filter((function(e){return-1!==a.indexOf(e.dimension)&&(-1!==n.X.indexOf(e.feature)||-1!==n.obs.indexOf(e.feature)||-1!==n.modules.indexOf(e.feature))}));e&&(e.forEach((function(e){for(var t=0;t<i.length;t++)if(i[t].dimension===e.dimension&&i[t].feature===e.feature){i.splice(t,1);break}})),i=i.concat(e));var r={};return n.X.concat(n.obs).concat(n.modules).forEach((function(e,t){r[e]=t})),i.sort((function(e,t){return(e=r[e.feature])-(t=r[t.feature])})),i}(e?e[a]:null,t[a]||[],n)})),t}function _i(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return function(n,a){var i=a();if(null!=i.dataset){n(gi(!0));var r=ze(i.searchTokens);ke(Ee(i.markers,r.featureSets),r.X);var o=(r.X.length>0||r.modules.length>0||r.obs.length>0||r.featureSets.length>0)&&r.obsCat.length>0,s=i.embeddings,l=i.distributionData,u=i.selectedDistributionData,d=i.embeddingData,h=i.globalFeatureSummary,p=i.cachedData,v=[],b=new Set,m=new Set,g=new Set,j=Ba(i);r.X.concat(r.obs).concat(r.obsCat).concat(r.modules).forEach((function(e){g.add(e)}));var O=[];s.forEach((function(e){var t=Ma(e);m.add(t),null==p[t]&&(e.dimensions>0?v.push(e):(null==p[e.attrs.group]&&b.add(e.attrs.group),e.attrs.selection.forEach((function(e){null==p[e[0]]&&b.add(e[0])})),O.push(e)))}));var x=[];if(O.forEach((function(e){var t=Ma(e);if(null==p[t]){var n=i.dataset.api.getFileUrl(e.image),a=new Promise((function(e,a){fetch(n).then((function(e){return e.text()})).then((function(e){return document.createRange().createContextualFragment(e).firstElementChild})).then((function(n){if(n.querySelector("style")){var a=document.createElement("div");a.style.display="none",a.appendChild(n),document.body.appendChild(a);for(var i=n.querySelector("style"),r=i.sheet.rules,o=0;o<r.length;o++)for(var s=r[o],l=n.querySelectorAll(s.selectorText),u=s.styleMap,d=0;d<l.length;d++){var h,f=l[d],v=Object(c.a)(u.keys());try{for(v.s();!(h=v.n()).done;){var b=h.value;f.style[b]=u.get(b).toString()}}catch(m){v.e(m)}finally{v.f()}}a.remove(),i.remove()}p[t]=n,e()}))}));x.push(a)}})),null!=j)La(i.datasetFilter).features.forEach((function(e){null==p[e]&&b.add(e)}));g.forEach((function(e){null==p[e]&&b.add(e)})),d.forEach((function(e){var t=Ma(e.embedding),n=m.has(t)&&(g.has(e.name)||0===g.size&&"__count"===e.name);n&&(e.date=new Date),e.active=n}));var y=r.obsCat.slice(),S=[y.join("-")],w=new Set;o&&function(){var e={};for(var t in l)l[t].forEach((function(t){e[t.name+"-"+t.feature]=!0}));S.forEach((function(t){r.X.forEach((function(n){null==e[t+"-"+n]&&w.add(n)})),r.obs.forEach((function(n){null==e[t+"-"+n]&&w.add("obs/"+n)})),r.modules.forEach((function(n){null==e[t+"-"+n]&&w.add("modules/"+n)}))}))}();var C={};if(v.length>0&&(C.embedding=[],v.forEach((function(e){if(null!=e.mode){var t=Ma(e,!1);if(-1!==Object(f.indexOf)(v,(function(e){return Ma(e)===t}))){var n=Object(f.indexOf)(i.dataset.embeddings,(function(e){return Ma(e,!1)===t}));if(-1===n)throw new Error(t+" not found in "+i.dataset.embeddings);v.push(i.dataset.embeddings[n])}}})),v.forEach((function(e){C.embedding.push(e)}))),b.size>0){var k=i.dataset;C.values={measures:[],dimensions:[]},b.forEach((function(e){-1!==k.obsCat.indexOf(e)?C.values.dimensions.push(e):-1!==k.obs.indexOf(e)?C.values.measures.push("obs/"+e):-1!==r.modules.indexOf(e)?C.values.measures.push("module/"+e):C.values.measures.push(e)}))}var E=[],z=[],T=[];r.X.forEach((function(e){null==h[e]&&E.push(e)})),r.obs.forEach((function(e){null==h[e]&&z.push("obs/"+e)})),r.obsCat.forEach((function(e){null==h[e]&&T.push(e)})),(E.length>0||z.length>0||T.length>0)&&(C.stats={measures:E.concat(z),dimensions:T}),y.length>0&&w.size>0&&(C.groupedStats={measures:Array.from(w),dimensions:[y]}),null!=j&&(E.length>0||T.length>0)&&(C.selection={filter:j,measures:T.length>0?r.X:E,dimensions:r.obsCat});var P=[Object.keys(C).length>0?i.dataset.api.getDataPromise(C,p):Promise.resolve({})].concat(x);return Promise.all(P).then((function(e){var a=e[0],o=a.summary||{};for(var s in o)h[s]=o[s];n(Xa(h));var c=Fi(i,g);d=d.concat(c),n(Ci(Di(a.distribution,l,r))),n(fi(d)),t&&n(Ja(Ri(d))),a.selection?n(Ii(a.selection,!1)):n(ki(Di(null,u,r)))})).finally((function(){n(gi(!1))})).catch((function(t){Li(n,t,"Unable to retrieve data. Please try again."),e&&e(t)}))}}}function Ri(e){var t=e.filter((function(e){return e.active}));if(0===t.length)return null;var n=t[t.length-1],a=Aa(n);return{name:n.name,type:n.featureType,embeddingKey:a}}function Ni(e,t){return"__count"===t?te:-1!==e.obsCat.indexOf(t)?Y:-1!==e.obs.indexOf(t)?Z:Q}function Fi(e,t){var n=e.embeddings,a=e.embeddingData,i=[],r=e.globalFeatureSummary,o=e.interpolator,s=e.dataset,l=e.cachedData,p=e.selection,v=e.categoricalNames,m=new Set;return a.forEach((function(e){var t=Ma(e.embedding),n=e.name+"_"+t;m.add(n)})),0===t.size&&t.add("__count"),n.forEach((function(n){var a=Ma(n),j=null!=n.spatial?n.spatial.type:n.type?n.type:ae,O=j!==ie?l[a]:null;if(null==O&&null!=n.mode){var x=l[Ma(n,!1)],y=function(e,t){for(var n=e.length>18367?14*Math.floor(Math.sqrt(e.length/1e3)):60,a=Object(_.a)().domain(Object(A.a)(e)).range([0,n-1]),i=Object(_.a)().domain(Object(A.a)(t)).range([0,n-1]),r=new Map,o=0,s=e.length;o<s;o++){var l=Math.floor(a(e[o])),c=Math.floor(i(t[o])),u=l*n+c,d=r.get(u);void 0===d&&(d={indices:[],x:l,y:c},r.set(u,d)),d.indices.push(o)}var h=[],p=[],f=[];return r.forEach((function(e,t){h.push(e.x),p.push(e.y),f.push(e.indices)})),{x:h,y:p,mode:"density",nbins:n,index:f}}(x[n.name+"_1"],x[n.name+"_2"]),S={};S[n.name+"_1"]=y.x,S[n.name+"_2"]=y.y,S[n.name+"_index"]=y.index,S[n.name+"_3"]=y.index,l[a]=S,O=S}var w=j!==ie?O[n.name+"_1"]:null,C=j!==ie?O[n.name+"_2"]:null,k=j!==ie?O[n.name+"_3"]:null;t.forEach((function(t){var x=t+"_"+a,y=t;if(!m.has(x)){var S=r[t],E=l[y];null==E&&("__count"===t?(E=new Int8Array(s.shape[0])).fill(1):console.log(y+" not found"));void 0!==E.value&&(E.purity,E=E.value);var z=Ni(s,t),T=z===Y,P=null;if(T){var M,A=S.categories,I=s.colors?s.colors[t]:null;null==I?M=A.length<=10?d.a:A.length<=12?h.a:A.length<=20?q:q.concat(K):Object(f.isArray)(I)?M=I:(M=[],A.forEach((function(e,t){var n=I[e];null==n&&(n=d.a[t%d.a.length]),M.push(n)})));var D=v[t];if(D)for(var _ in D)for(var R in D){var N=D[R];if(null!=N.color){var F=A.indexOf(R);-1!==F&&(M[F]=N.color)}}(P=Object(u.a)(M).domain(A)).summary=S}else{if(g()(E)){for(var L=new Float32Array(s.shape[0]),B=0,U=E.index.length;B<U;B++)L[E.index[B]]=E.values[B];E=L}if(null==S||"__count"===t){for(var V=Number.MAX_VALUE,H=-Number.MAX_VALUE,W=0,G=0,J=E.length;G<J;G++){var X=E[G];V=X<V?X:V,H=X>H?X:H,W+=X}S={min:V,max:H,mean:W/E.length},r[t]=S}var Z=[S.min,S.max];null==S.customMin||isNaN(S.customMin)||(Z[0]=S.customMin),null==S.customMax||isNaN(S.customMax)||(Z[1]=S.customMax),P=Ce(o).domain(Z)}if(j===ie&&null==n.categoryToIndices){var Q=l[n.attrs.group],$={},ee=He(l,{filters:n.attrs.selection});if(0===ee.size)throw new Error("No passing indices found");var te,re=Object(c.a)(ee);try{for(re.s();!(te=re.n()).done;){var oe=te.value,se=Q[oe],le=$[se];void 0===le&&(le=[],$[se]=le),le.push(oe)}}catch(Pe){re.e(Pe)}finally{re.f()}n.categoryToIndices=$}var ce={embedding:Object.assign({},n),name:t,featureType:z,x:w,y:C,z:null!=k?k:void 0,dimensions:null!=k?3:2,date:new Date,active:!0,colorScale:P,continuous:!T,isCategorical:T,values:E,type:j};if(null!=ce.mode&&(ce.index=O[n.name+"_index"],ce._values=ce.values,ce.values=function(e,t,n,a){var i,r=[];if("max"===a)i=function(t){for(var n=-Number.MAX_VALUE,a=0,i=t.length;a<i;a++)n=Math.max(e[t[a]],n);return n};else{if("mode"!==a)throw new Error;i=function(t){for(var n=new Map,a=0,i=t.length;a<i;a++){var r=e[t[a]],o=n.get(r);void 0===o&&(o=0),n.set(r,1+o)}var s=-Number.MAX_VALUE,l=null;return n.forEach((function(e,t){e>s&&(s=e,l=t)})),l}}for(var o=0===n.size,s=0,l=t.length;s<l;s++){var c=t[s],u=i(o?c:c.filter((function(e){return n.has(e)})));r.push(u)}return r}(ce.values,ce.index,p,ce.continuous?"max":"mode")),j===ae&&(ce.positions=function(e){var t,n=[1/0,-1/0],a=[1/0,-1/0],i=[1/0,-1/0],r=e.x.length,o=null!=e.z;o||(t=e.isCategorical?je(e.values.length,1):ve(be(e.values,!0)),i[0]=0,i[1]=1);for(var s=0;s<r;s++){var l=e.x[s];l<n[0]&&(n[0]=l),l>n[1]&&(n[1]=l);var c=e.y[s];if(c<a[0]&&(a[0]=c),c>a[1]&&(a[1]=c),o){var u=e.z[s];u<i[0]&&(i[0]=u),u>i[1]&&(i[1]=u)}}for(var d=function(e){return Math.abs(e[1]-e[0])},h=d(n),p=d(a),f=d(i),v=Math.max(h,p,f),b=function(e,t){return[e/v*-t,t*(e/v)]},m=b(h,1),g=b(p,1),j=b(f,1),O=new Float32Array(3*r),x=0,y=0;y<r;y++)O[x++]=On(e.x[y],n,m),O[x++]=On(e.y[y],a,g),O[x++]=On(o?e.z[y]:t[y]/(t.length+1),i,j);return O}(ce)),j===ie){var ue=l[Ma(n)];if(ce.source=ue.cloneNode(!0),ce.zscore=!0,ce.gallerySource=ue.cloneNode(!0),ce.categoryToIndices=n.categoryToIndices,ce.continuous){P.domain([-3,3]);var de=0,he=0;for(var pe in n.categoryToIndices)for(var me=n.categoryToIndices[pe],ge=0,Oe=me.length;ge<Oe;ge++)de+=ce.values[me[ge]],he++;de/=he;var xe=0;for(var ye in n.categoryToIndices)for(var Se=n.categoryToIndices[ye],we=0,ke=Se.length;we<ke;we++){var Ee=ce.values[Se[we]]-de;xe+=Ee*=Ee}var ze=xe/(he-1);ce.mean=de,ce.stdev=Math.sqrt(ze)}ce.fullCategoryToStats=At(ce,new Set),ce.categoryToStats=0===e.selection.size?ce.fullCategoryToStats:At(ce,e.selection)}if(fe(ce),j===ne){ce.indices=T?je(E.length):be(E,!0);var Te=s.api.getFileUrl(n.spatial.image);ce.tileSource=new b.a.ImageTileSource({url:Te,buildPyramid:!0,crossOriginPolicy:"Anonymous"})}i.push(ce)}}))})),i}function Li(e,t,n){if(console.log(t),401===t.status)return e(pi("Your session has expired. Please login again.")),e(Ia());null==n&&(n=t instanceof S?t.message:"An unexpected error occurred. Please try again."),e(pi(new Error(n)))}function Bi(){return function(e,t){return e(gi(!0)),t().serverInfo.api.getDatasetsPromise().then((function(t){e(mi(t))})).finally((function(){e(gi(!1))})).catch((function(t){Li(e,t,"Unable to retrieve datasets. Please try again.")}))}}function Ui(e){var t=e.chartOptions,n=e.combineDatasetFilters,a=e.activeFeature,i=e.dataset,r=e.embeddingLabels,o=e.distributionPlotOptions,s=e.distributionPlotInterpolator,l=e.embeddings,c=e.searchTokens,u=e.datasetFilter,d=e.interpolator,h=e.markerOpacity,p=e.pointSize,f=e.unselectedMarkerOpacity,v=e.distributionData,b={dataset:i.id,embeddings:l},m=t.scatterPlot;b.embeddings.length>0&&null!=m&&(b.camera=m.getCameraDef()),null!=a&&(b.activeFeature=a);var g={},j={showFog:false,darkMode:Pn,labelFontSize:14,labelStrokeWidth:4};for(var O in j){var x=t[O];x!==j[O]&&(g[O]=x)}1!==p&&(b.pointSize=p),Object.keys(g).length>0&&(b.chartOptions=g),c.length>0&&(b.q=c);var y={};for(var S in u){var w=u[S];Array.isArray(w)?function(){var e=[];w.forEach((function(t){var n=Object.assign({},t);n.indices=Array.from(t.indices),e.push(n)})),y[S]=e}():"in"===w.operation?y[S]={operation:w.operation,value:w.value}:""===w.operation||isNaN(w.value)||null==w.value||(y[S]={operation:w.operation,value:w.value})}Object.keys(y).length>0&&(b.datasetFilter=y),"and"!==n&&(b.combineDatasetFilters=n),1!==h&&(b.markerOpacity=h),f!==En&&(b.unselectedMarkerOpacity=f),v&&v.length>0&&(b.distributionPlotOptions=o,b.distributionPlotInterpolator=Object.assign({},s,{value:null}));var C=Object.assign({},d,{value:void 0});return("Viridis"!==C.name||C.reversed)&&(b.colorScheme=C),r.length>0&&(b.embeddingLabels=r),b}var Vi=n(376),Hi=n(377),Wi=n(378),Gi=n(379),Ji=n(380),Xi=n(353),qi=n(381);var Ki=Object(P.a)((function(e){return{dot:{borderRadius:"50%",display:"inlineBlock",border:"1px solid lightgray"},table:{borderCollapse:"collapse",position:"relative",width:"unset"},tr:{cursor:"pointer"},deleteTr:{cursor:"pointer","& span":{display:"none"},"&:hover span":{display:"block",position:"absolute",right:0,top:0}},rotateHeader:{top:0,padding:1,background:"transparent",whiteSpace:"nowrap"},checkbox:{padding:0},rotateHeaderDiv:{position:"absolute",bottom:0,left:0,textAlign:"left",transform:"translate(calc(50%),0) rotate(315deg)",transformOrigin:"0% calc(50%)",width:"100%"},rotateHeaderSpan:{position:"absolute",bottom:0,left:0,pointerEvents:"none",overflow:"hidden",textOverflow:"ellipsis"},td:{padding:1,whiteSpace:"nowrap",width:27,minWidth:27,maxWidth:27},rowHeader:{padding:1,whiteSpace:"nowrap"}}}))((function(e){for(var t=e.classes,n=e.onRowClick,a=e.onMouseMove,i=e.onMouseOut,r=e.toggleAll,o=e.rows,s=e.columns,l=e.isRowSelected,c=e.rowStart,u=e.columnStart,d=e.getRowId,h=e.getColor,p=e.getSize,f=e.getTooltip,v=e.sizeScale,b=e.valueScale,m=e.colorScale,g=e.headerWidth,j=e.rotateHeaders,O=!0,x=Math.max(v.range()[0],v.range()[1]),y=0;y<o.length;y++){if(!l(o[y])){O=!1;break}}return Object(V.jsx)(V.Fragment,{children:Object(V.jsx)(Vi.a,{color:"text.primary",children:Object(V.jsx)("div",{children:o.length>0&&Object(V.jsxs)(Hi.a,{onMouseMove:a,onMouseOut:i,stickyHeader:!0,className:t.table,children:[Object(V.jsx)(Wi.a,{children:Object(V.jsxs)(Gi.a,{children:[Object(V.jsx)(Ji.a,{className:t.rowHeader,component:"th",style:{backgroundColor:"unset",textAlign:"left"},children:Object(V.jsx)(Xi.a,{onClick:function(e){return r(e,O)},className:t.checkbox,checked:O})},"__id"),s.map((function(e){return j?Object(V.jsx)(Ji.a,{title:e,className:t.rotateHeader,children:Object(V.jsx)("div",{className:t.rotateHeaderDiv,children:Object(V.jsx)("span",{style:{width:g},className:t.rotateHeaderSpan,children:e})})},e):Object(V.jsx)(Ji.a,{style:{backgroundColor:"unset"},className:t.td,children:e},e)}))]})}),Object(V.jsx)(qi.a,{children:o.map((function(e,a){c(e,a);var i=d(e),r=l(e);return Object(V.jsxs)(Gi.a,{className:t.tr,hover:!0,onClick:function(t){return n(t,e)},role:"checkbox",tabIndex:-1,children:[Object(V.jsxs)(Ji.a,{className:t.rowHeader,component:"th",children:[Object(V.jsx)(Xi.a,{className:t.checkbox,checked:r}),i]},"id"),s.map((function(n,a){u(n,a);var i=h(e,n),r=p(e,n),o=f(e,n);if(null==i||isNaN(i))return Object(V.jsx)(Ji.a,{className:t.td,"data-title":o},n);var s=v(r),l=b?b(i):i,c=m(l);return Object(V.jsx)(Ji.a,{className:t.td,"data-title":o,children:Object(V.jsx)("div",{className:t.dot,style:{pointerEvents:"none",marginLeft:(x-s)/2,width:s,height:s,backgroundColor:c}})},n)}))]},e)}))})]})})})})})),Zi=n(106),Yi=n.n(Zi),Qi="RdBu";function $i(e){void 0===e.options&&(e.options={}),void 0===e.interpolator&&(e.interpolator={name:Qi,value:we(Qi),reversed:!0,scale:se});var t,n=e.groups,a=e.data;if(void 0===e.columns){for(var i=new Array(n.length),r=0,o=e.groups.length;r<o;r++)i[r]=r;e.columns=i,e.columns.sort((function(t,n){return W(e.groups[t],e.groups[n])}))}if(void 0===e.rowFilters){var s=[];e.fields.forEach((function(e){var t=e.toLowerCase();s.push([e,-1!==t.indexOf("pval")||-1!==t.indexOf("p_val")||-1!==t.indexOf("qval")||-1!==t.indexOf("q_val")||-1!==e.indexOf("fdr")?"<":">",NaN,""])})),e.rowFilters=s}if(void 0===e.ntop){var l=Math.min(10,e.data.length);e.ntop=l,e.ntopUI=l}if(void 0===e.sortedRows){for(var c=new Array(a.length),u=0,d=a.length;u<d;u++)c[u]=u;e.sortedRows=[];for(var h=0,p=n.length;h<p;h++)e.sortedRows.push(c)}if(void 0===e.byAscending&&(e.byAscending=!1),void 0===e.by){e.by=e.fields[0];for(var f=0;f<e.fields.length;f++)if(-1!==e.fields[f].toLowerCase().indexOf("score")){e.by=e.fields[f];break}}function v(e){for(var t=Number.MAX_VALUE,i=-Number.MAX_VALUE,r=0,o=a.length;r<o;r++)for(var s=0;s<n.length;s++){var l=n[s]+":"+e,c=a[r][l];null==c||isNaN(c)||(t=Math.min(t,c),i=Math.max(i,c))}return[t,i]}(void 0===e.sortByGroup&&(e.sortByGroup=e.groups[0]),void 0===e.color&&(e.color=e.fields[0]),void 0===e.size&&(e.size=e.fields[0]),void 0===e.rowSortOrder&&(e.rowSortOrder=[]),void 0===e.rows&&er(e),void 0===e.colorScale)&&(t=e.interpolator.scale!==se?[0,1]:v(e.color),isNaN(e.options.min)||(t[0]=e.options.min),isNaN(e.options.max)||(t[1]=e.options.max),e.colorScale=Ce(e.interpolator).domain(t));if(void 0===e.sizeScaleReversed&&(e.sizeScaleReversed=null!=e.size&&-1!==e.size.indexOf("pval")),void 0===e.sizeScale)if("none"!==e.size){var b=v(e.size);isNaN(e.options.minSize)||(b[0]=e.options.minSize),isNaN(e.options.maxSize)||(b[1]=e.options.maxSize),e.sizeScale=Object(_.a)().domain(b).range(e.sizeScaleReversed?[18,2]:[2,18]).clamp(!0)}else e.sizeScale=ue(18)}function er(e){var t=e.by,n=e.byAscending,a=e.groups,i=a.length;e.sortedRows=[];for(var r=function(i){for(var r=[],o=0,s=e.data.length;o<s;o++)r.push(o);var l=a[i]+":"+t;r.sort((function(t,a){var i=e.data[t][l],r=e.data[a][l],o=null==i||isNaN(i),s=null==r||isNaN(r);return o&&s?0:n?o?-1:s?1:i-r:o?1:s?-1:r-i})),e.sortedRows.push(r)},o=0;o<i;o++)r(o);var s=e.rowFilters,l=[];s.forEach((function(e){isNaN(e[2])||l.push({field:e[0],f:Ve(e)})}));var c=l.length;e.sortedFilteredRows=[];for(var u=0;u<i;u++){for(var d=a[u],h=[],p=e.sortedRows[u],f=0,v=p.length;f<v;f++){for(var b=!0,m=p[f],g=0;g<c;g++){var j=l[g],O=d+":"+j.field,x=e.data[m][O];if(!j.f(x)||null==x||isNaN(x)){b=!1;break}}b&&h.push(m)}e.sortedFilteredRows.push(h)}tr(e)}function tr(e){for(var t=new Set,n=e.groups.indexOf(e.sortByGroup),a=[n],i=0;i<e.groups.length;i++)i!==n&&a.push(i);for(var r=0;r<e.groups.length;r++)for(var o=e.sortedFilteredRows[a[r]],s=Math.min(e.ntop,o.length),l=0;l<s;l++)t.add(o[l]);e.rows=Array.from(t)}var nr=Object(o.b)((function(e){return{dataset:e.dataset,searchTokens:e.searchTokens}}),(function(e,t){return{onSearchTokens:function(t){e(Ti(t))}}}))((function(e){var t,n,a,i,r,o=e.dataset,s=e.jobResult,l=e.setTooltip,c=e.searchTokens,u=e.onSearchTokens,d=new Set;c.forEach((function(e){e.type===Q&&d.add(e.value)}));var h,p,f,v=!1,b=null,m=null,g=0,j=0,O=s.columns;p="none"!==s.size,t=s.data,n=s.color,a=s.by,i=s.size,r=s.groups,(m=[]).push(a),h=s.rows,n!==a&&m.push(n),i!==a&&p&&i!==n&&m.push(i),s.fields.forEach((function(e){-1===m.indexOf(e)&&m.push(e)}));for(var x=0;x<r.length;x++)if(r[x].length>2){v=!0;break}if(v){var y=document.createElement("span");y.style.position="absolute",y.style.left="-1000000px",y.className=".MuiTableCell-head .MuiTableCell-root",document.body.append(y);for(var S=0;S<r.length;S++)y.innerText=r[S],j=Math.max(j,2+y.getBoundingClientRect().width);y.remove(),j+=2,j=Math.min(j,300),g=Math.cos(45)*j}return s.interpolator.scale!==se&&(b=Object(_.a)().range([0,1]),f=[],s.interpolator.scale===re?h.forEach((function(e){var a=Number.MAX_VALUE,i=-Number.MAX_VALUE;O.forEach((function(o){var s=r[o]+":"+n,l=t[e][s];null==l||isNaN(l)||(a=l<a?l:a,i=l>i?l:i)})),f.push([a,i])})):s.interpolator.scale===oe&&O.forEach((function(e){var a=Number.MAX_VALUE,i=-Number.MAX_VALUE;h.forEach((function(o){var s=r[e]+":"+n,l=t[o][s];null==l||isNaN(l)||(a=l<a?l:a,i=l>i?l:i)})),f.push([a,i])}))),O=s.columns.map((function(e){return r[e]})),Object(V.jsxs)(Vi.a,{color:"text.primary",children:[Object(V.jsxs)(M.a,{style:{marginBottom:g+8},component:"h3",color:"textPrimary",children:[Object(V.jsx)("b",{children:s.name}),"\xa0",Object(V.jsx)("small",{children:Pt(h.length)+" / "+Pt(s.data.length)+" features"})]}),Object(V.jsx)(qe.a,{title:"Export",children:Object(V.jsx)(Ze.a,{edge:!1,size:"small","aria-label":"Export",onClick:function(e){var t=[];t.push("id"),s.columns.forEach((function(e){var n=s.groups[e];s.fields.forEach((function(e){t.push("\t"),t.push(n+":"+e)}))})),t.push("\n");for(var n=function(e){t.push(s.data[e].index),s.columns.forEach((function(n){var a=s.groups[n];s.fields.forEach((function(n){var i=a+":"+n,r=s.data[e][i];t.push("\t"),t.push(r)}))})),t.push("\n")},a=0;a<s.data.length;a++)n(a);var i=new Blob([t.join("")],{type:"text/plain;charset=utf-8"});window.saveAs(i,s.name+".tsv")},children:Object(V.jsx)(Yi.a,{})})}),Object(V.jsx)("div",{style:{paddingTop:6},children:h.length>0&&Object(V.jsx)(Ki,{isRowSelected:function(e){return d.has(t[e].index)},rows:h,columns:O,onMouseMove:function(e){l(e.target.dataset.title)},onMouseOut:function(e){l("")},getTooltip:function(e,n){var a=[];return m.forEach((function(i){var r=t[e][n+":"+i];a.push(i+": "+r)})),a=a.join(", ")},sizeScale:s.sizeScale,valueScale:b,rowStart:function(e,t){s.interpolator.scale===re&&b.domain(f[t])},getColor:function(e,a){return t[e][a+":"+n]},getSize:function(e,n){return t[e][n+":"+i]},getRowId:function(e){return t[e].index},columnStart:function(e,t){s.interpolator.scale===oe&&b.domain(f[t])},onRowClick:function(e,t){e.stopPropagation();for(var n=s.data[t].index,a=-1,i=0;i<c.length;i++)if(c[i].value===n){a=i;break}-1===a?c.push({value:n,type:-1!==o.obs.indexOf(n)?Z:Q}):c.splice(a,1),u(c.slice())},colorScale:s.colorScale,toggleAll:function(e,t){e.stopPropagation(),t=!t;for(var n=new Set,a=0;a<s.rows.length;a++){var i=s.data[s.rows[a]].index;n.add(i)}var r=r;if(t){var o=o;n.forEach((function(e){for(var t=!1,n=0;n<r.length;n++)if(r[n].value===e){t=!0;break}t||r.push({value:e,type:-1!==o.obs.indexOf(e)?Z:Q})}))}else r=r.filter((function(e){return!n.has(e.value)}));u(r.slice())},rotateHeaders:v,headerHeight:g,headerWidth:j})})]})})),ar={chartType:"dotplot",violinScale:"width",violinHeight:100,violinWidth:80,violinShowBoxplot:!0},ir={X:ar,modules:Object.assign({},ar,{chartType:"heatmap"}),obs:Object.assign({},ar,{chartType:"violin"})},rr={name:zn,value:we(zn),reversed:!1},or={name:Tn,value:we(Tn),reversed:!1,scale:se},sr={X:or,modules:or,obs:or},lr={width:window.innerWidth-280,height:Math.max(300,window.innerHeight-370)},cr={animating:!1,dragmode:"pan",showGalleryLabels:!1,showAxis:!0,showFog:false,darkMode:Pn,labelFontSize:14,labelStrokeWidth:4};var ur=Object(s.b)({activeFeature:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case ua:return null;case Fn:return t.payload;default:return e}},cachedData:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case ua:return{};default:return e}},categoricalNames:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case Zn:return t.payload;case Yn:var n=e[t.payload.name];return void 0===n&&(n={},e[t.payload.name]=n),n[t.payload.originalValue]=t.payload,Object.assign({},e);case ua:return{};default:return e}},chartOptions:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:cr,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case In:return Object.assign({},t.payload);case xa:return t.payload.chartOptions?Object.assign(cr,t.payload.chartOptions):e;default:return e}},chartSize:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:300,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case Ln:return t.payload;default:return e}},combineDatasetFilters:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"and",t=arguments.length>1?arguments[1]:void 0;switch(t.type){case Dn:return t.payload;case ua:return"and";case xa:return null!=t.payload.combineDatasetFilters?t.payload.combineDatasetFilters:e;default:return e}},dataset:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case ua:return document.title=null==t.payload?"Cirro":t.payload.name+" - Cirro",t.payload;case Gn:if(t.payload.id===e.id)return document.title=t.payload.name+" - Cirro",Object.assign(e,t.payload);default:return e}},datasetChoices:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case Oa:return t.payload.sort(W),t.payload;case la:return null==t.payload?[]:e;case Hn:return e.push(t.payload),e.sort(W),e.slice();case Gn:case Wn:for(var n=-1,a=0;a<e.length;a++)if(e[a].id===t.payload.id){n=a;break}return-1!==n?(t.type===Gn?(e[n]=t.payload,e.sort(W)):e.splice(n,1),e.slice()):e;default:return e}},datasetFilter:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case ua:return{};case Vn:return t.payload;case xa:return null!=t.payload.datasetFilter?t.payload.datasetFilter:e;default:return e}},datasetFilters:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case ua:return[];case _n:return t.payload;default:return e}},datasetViews:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case ua:return[];case Rn:return t.payload;default:return e}},dialog:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case ha:return t.payload;default:return e}},distributionData:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case Zn:return Object.assign({},e);case ya:return t.payload;case ua:return{};default:return e}},distributionPlotOptions:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ir,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case ua:return ir;case wa:return Object.assign({},e,t.payload);case xa:return null!=t.payload.distributionPlotOptions?t.payload.distributionPlotOptions:e;default:return e}},distributionPlotInterpolator:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:sr,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case An:return Object.assign({},sr,t.payload);case xa:if(null!=t.payload.distributionPlotInterpolator){var n=Object.assign({},sr,t.payload.distributionPlotInterpolator);return n.value=we(n.name),n}default:return e}},email:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case la:return t.payload;default:return e}},embeddingData:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case Ca:return t.payload;case ea:return e.forEach((function(e){e.type===ie&&(e.categoryToStats=0===t.payload.size?e.fullCategoryToStats:At(e,t.payload),fe(e))})),e.slice();case qn:return e.forEach((function(e){if(e.continuous&&e.name===t.payload.name){var n=t.payload.summary,a=e.type===ie?[-3,3]:[n.min,n.max];e.type===ie?(null==n.customZMin||isNaN(n.customZMin)||(a[0]=n.customZMin),null==n.customZMax||isNaN(n.customZMax)||(a[1]=n.customZMax)):(null==n.customMin||isNaN(n.customMin)||(a[0]=n.customMin),null==n.customMax||isNaN(n.customMax)||(a[1]=n.customMax)),e.colorScale.domain(a),fe(e)}})),e.slice();case Kn:return e.forEach((function(e){if(!e.continuous&&e.name===t.payload.name){var n=e.colorScale.range();n[e.colorScale.domain().indexOf(t.payload.originalValue)]=t.payload.color,e.colorScale.range(n),fe(e)}})),e.slice();case ra:return e.forEach((function(e){if(e.continuous){var n=e.colorScale.domain();e.colorScale=Ce(t.payload).domain(n),fe(e)}})),e.slice();case ua:return[];default:return e}},embeddingLabels:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case Mn:return t.payload;case ua:return[];case xa:return t.payload.embeddingLabels||[];default:return e}},embeddings:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case aa:return t.payload;case ua:return[];case xa:return null!=t.payload.embeddings?t.payload.embeddings:e;default:return e}},featureSummary:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case ta:return t.payload;case ua:return{};default:return e}},globalFeatureSummary:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case Jn:return t.payload;case ua:return{};default:return e}},interpolator:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:rr,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case ra:return t.payload;case xa:return null!=t.payload.colorScheme?t.payload.colorScheme:e;default:return e}},jobResult:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case ua:return null;case Pa:return null!=t.payload&&"de"==t.payload.type&&$i(t.payload),t.payload;default:return e}},jobResults:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case ua:return[];case Ta:return t.payload;default:return e}},legendScrollPosition:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case ua:return{};case Nn:return e[t.payload.name]=t.payload.value,e;default:return e}},loading:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case ka:return t.payload;default:return e}},loadingApp:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{loading:!1,progress:0},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case za:return t.payload;default:return e}},markerOpacity:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case Qn:return t.payload;case ua:return 1;case xa:return null!=t.payload.markerOpacity?t.payload.markerOpacity:e;default:return e}},markers:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case da:return t.payload;case ua:var n=null==t.payload?[]:t.payload.markers||[];if(Object(f.isPlainObject)(n)){var a=[];for(var i in n){var r=n[i];for(var o in r)a.push({category:i,name:o,id:i+"-"+o,readonly:!0,features:r[o]})}n=a}if(null!=t.payload&&null!=t.payload.markers_read_only)if(Object(f.isPlainObject)(t.payload.markers_read_only)){var s=t.payload.markers_read_only;for(var l in s){var c=s[l];for(var u in c)n.push({category:l,name:u,id:l+"-"+u,readonly:!0,features:c[u]})}}else t.payload.markers_read_only.forEach((function(e){e.readonly=!0,n.push(e)}));return n.forEach((function(e){null==e.id&&(e.id=e.category+"-"+e.name)})),n;default:return e}},message:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case ia:return t.payload;default:return e}},pointSize:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case oa:return t.payload;case xa:return null!=t.payload.pointSize?t.payload.pointSize:e;default:return e}},primaryChartSize:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:lr,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case Bn:return t.payload;default:return e}},savedDatasetState:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case Xn:return t.payload;default:return e}},searchTokens:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case na:return t.payload;case ua:return[];case xa:return t.payload.q||[];default:return e}},selectedDistributionData:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case Zn:return Object.assign({},e);case Sa:return t.payload;case ua:return{};default:return e}},selection:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Set,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case ea:return t.payload;case ua:return new Set;default:return e}},serverInfo:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case Un:return t.payload.ontology&&t.payload.ontology.cellTypes&&(t.payload.ontology.cellTypes.forEach((function(e){return e.text=e.name})),t.payload.ontology.cellTypes.sort((function(e,t){return W(e.text,t.text)}))),null==t.payload.datasetSelectorColumns&&(t.payload.datasetSelectorColumns=[{id:"name",label:"Name",visible:!0},{id:"species",label:"Species",visible:!0},{id:"title",label:"Title",visible:!0}]),t.payload;default:return e}},tab:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"embedding",t=arguments.length>1?arguments[1]:void 0;switch(t.type){case Ea:return t.payload;case ua:return"embedding";case ya:if("distribution"===e&&0===t.payload.length)return"embedding";case na:if("composition"===e&&t.payload.filter((function(e){return e.type===Y})).length<2)return"embedding";default:return e}},unselectedMarkerOpacity:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:En,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case $n:return t.payload;case ua:return En;case xa:return null!=t.payload.unselectedMarkerOpacity?t.payload.unselectedMarkerOpacity:e;default:return e}},unselectedPointSize:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case sa:return t.payload;case xa:return null!=t.payload.unselectedPointSize?t.payload.unselectedPointSize:e;default:return e}},user:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case ca:return t.payload;default:return e}}}),dr=n(344),hr=n(405),pr=n(227),fr=n(356),vr=n(399),br=n(383),mr=n(395),gr=n(370),jr=n(404),Or=n(226),xr=n.n(Or),yr=n(340),Sr=n(393),wr=n(382),Cr=n(373),kr=n(394),Er=n(392),zr=n(221),Tr=n.n(zr),Pr=n(219),Mr=n.n(Pr),Ar=n(220),Ir=n.n(Ar),Dr=n(218),_r=n.n(Dr),Rr=n(62);function Nr(){return Object(V.jsxs)(Ke.a,{style:{verticalAlign:"text-bottom",paddingBottom:3},children:[Object(V.jsx)("path",{d:"M19.21 12.04l-1.53-.11-.3-1.5C16.88 7.86 14.62 6 12 6 9.94 6 8.08 7.14 7.12 8.96l-.5.95-1.07.11C3.53 10.24 2 11.95 2 14c0 2.21 1.79 4 4 4h13c1.65 0 3-1.35 3-3 0-1.55-1.22-2.86-2.79-2.96z",fill:"#4285F4"}),Object(V.jsx)("path",{d:"M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96zM19 18H6c-2.21 0-4-1.79-4-4 0-2.05 1.53-3.76 3.56-3.97l1.07-.11.5-.95C8.08 7.14 9.94 6 12 6c2.62 0 4.88 1.86 5.39 4.43l.3 1.5 1.53.11c1.56.1 2.78 1.41 2.78 2.96 0 1.65-1.35 3-3 3z"})]})}var Fr=n(354),Lr=n(364),Br=n(339),Ur=n(391),Vr=n(365),Hr=n(355),Wr=n(142),Gr=n.n(Wr),Jr=n(384),Xr=n(390),qr=n(385),Kr=n(217),Zr=n.n(Kr),Yr=n(171),Qr=n.n(Yr),$r=n(341),eo=n(388);var to=Object(o.b)((function(e){return{dataset:e.dataset,dialog:e.dialog,datasetChoices:e.datasetChoices,datasetSelectorColumns:e.serverInfo.datasetSelectorColumns}}),(function(e){return{handleDialog:function(t){e(vi(t))}}}))((function(e){var t=Object(a.useState)(""),n=Object(Xe.a)(t,2),r=n[0],o=n[1],s=Object(a.useState)(null),l=Object(Xe.a)(s,2),c=l[0],u=l[1],d=Object(a.useState)(null),h=Object(Xe.a)(d,2),p=h[0],v=h[1],b=Object(a.useState)(30),m=Object(Xe.a)(b,2),g=m[0],j=(m[1],Object(a.useState)(0)),O=Object(Xe.a)(j,2),x=O[0],y=O[1],S=Object(a.useState)("asc"),w=Object(Xe.a)(S,2),C=w[0],k=w[1],E=Object(a.useState)(null),z=Object(Xe.a)(E,2),T=z[0],P=z[1],A=e.dataset,I=e.datasetChoices,D=e.datasetSelectorColumns,_=e.dialog,R=Object(a.useState)(!1),N=Object(Xe.a)(R,2),F=N[0],L=N[1];function B(t){e.handleDialog(pa),o("")}var U=null!=A?A.id:null;if(I.length<=1&&null!=U)return null;var H=_===pa,G=I,J=r.toLowerCase().trim(),X=D,q=X.filter((function(e){return!1!==e.visible}));if(""!=J){var K=q,Z=J.indexOf(":");if(-1!==Z)for(var Y=J.substring(0,Z),Q=0;Q<X.length;Q++)if(Y==X[Q].label.toLowerCase().replace(" ","_")){K=[X[Q]],J=J.substring(Z+1).trim();break}if(""!=J){var $=K.length;G=G.filter((function(e){for(var t=0;t<$;t++){var n=e[K[t].id];if(null!=n&&-1!==(""+n).toLowerCase().indexOf(J))return!0}return!1}))}}null!=T&&(G.sort((function(e,t){return W(e[T],t[T])})),"desc"==C&&G.reverse());var ee=Boolean(c);return Object(V.jsxs)(i.a.Fragment,{children:[Object(V.jsx)(Cr.a,{id:"dataset-details-selector",open:ee,anchorEl:c,onClose:function(e){u(null),v(null)},anchorOrigin:{vertical:"bottom",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"center"},children:Object(V.jsx)("div",{style:{width:500},children:p&&p.description&&Object(V.jsx)(Rr.a,{options:{overrides:ce},children:p.description})})}),null==U&&Object(V.jsx)(wr.a,{variant:"contained",onClick:B,color:"primary",startIcon:Object(V.jsx)(Qr.a,{}),children:"Open"}),null!=U&&Object(V.jsx)(qe.a,{title:"Open",children:Object(V.jsx)(Ze.a,{onClick:B,size:"large",children:Object(V.jsx)(Qr.a,{})})}),Object(V.jsx)(br.a,{fullWidth:!0,open:H,onClose:function(){e.handleDialog(null),o("")},maxWidth:"xl",children:Object(V.jsxs)(Jr.a,{sx:{height:"100vh"},children:[Object(V.jsx)(qr.a,{size:"small",style:{paddingTop:6},type:"text",placeholder:"Search Datasets",value:r,onChange:function(e){y(0),o(e.target.value)},fullWidth:!0,helperText:'Search a specific field by typing the field name followed by a colon ":" and then the term you are looking for',InputProps:""!==r.trim()?{endAdornment:Object(V.jsx)(Xr.a,{position:"end",children:Object(V.jsx)(Ze.a,{"aria-label":"clear",onClick:function(){y(0),o("")},size:"large",children:Object(V.jsx)(Zr.a,{})})})}:null}),Object(V.jsxs)("div",{children:[Object(V.jsx)(eo.a,{size:"small",sx:{float:"right",transform:"translateY(-20px)",m:1},children:Object(V.jsx)(Fr.a,{size:"small",labelId:"dataset-selector-columns-label",id:"dataset-selector-columns",multiple:!0,input:Object(V.jsx)(Lr.a,{size:"small"}),value:q.map((function(e){return e.id})),onChange:function(e){var t=e.target.value;D.forEach((function(e){e.visible=-1!==t.indexOf(e.id)})),L(!F)},renderValue:function(e){return"Column Visibility"},children:X.map((function(e){return Object(V.jsxs)(Qe.a,{value:e.id,children:[Object(V.jsx)(Xi.a,{checked:-1!==Object(f.findIndex)(q,(function(t){return t.id===e.id}))}),Object(V.jsx)(Br.a,{primary:e.label})]},e.id)}))})}),Object(V.jsx)(M.a,{variant:"subtitle1",children:(G.length!=I.length?Pt(G.length)+" / ":"")+Pt(I.length)+" Datasets"}),Object(V.jsx)(yr.a,{}),Object(V.jsx)(Ur.a,{children:Object(V.jsxs)(Hi.a,{stickyHeader:!0,size:"small",padding:"normal",children:[Object(V.jsx)(Wi.a,{children:Object(V.jsx)(Gi.a,{children:q.map((function(e){return Object(V.jsx)(Ji.a,{align:e.numeric?"right":"left",padding:e.disablePadding?"none":"normal",sortDirection:T===e.id&&C,children:Object(V.jsxs)(Vr.a,{active:T===e.id,direction:T===e.id?C:"asc",onClick:function(t){return n=e.id,k(T===n&&"asc"===C?"desc":"asc"),void P(n);var n},children:[e.label,T===e.id?Object(V.jsx)(Vi.a,{component:"span",sx:$r.a,children:"desc"===C?"sorted descending":"sorted ascending"}):null]})},e.id)}))})}),Object(V.jsx)(qi.a,{children:G.slice(x*g,x*g+g).map((function(t){return Object(V.jsx)(Gi.a,{selected:t.id===U,hover:!0,role:"checkbox",tabIndex:-1,onClick:function(n){return(a=t.id)!==(null!=e.dataset?e.dataset.id:null)&&e.onChange(a),e.handleDialog(null),void o("");var a},children:q.map((function(e,n){var a=t[e.id];return Object(V.jsxs)(Ji.a,{align:e.align,children:[e.format&&"number"===typeof a?e.format(a):a,0===n&&null!=t.description&&""!==t.description&&Object(V.jsx)(Ze.a,{onClick:function(e){return n=e,a=t.id,n.stopPropagation(),u(n.currentTarget),void v(Object(f.find)(I,(function(e){return a===e.id})));var n,a},edge:"end","aria-label":"description",size:"small",children:Object(V.jsx)(Gr.a,{})})]},e.id)}))},t.id)}))})]})}),Object(V.jsx)(Hr.a,{rowsPerPageOptions:[30],component:"div",count:G.length,rowsPerPage:g,page:x,onPageChange:function(e,t){y(t)}})]})]})})]})})),no=n(350),ao=function(e){Object(O.a)(n,e);var t=Object(x.a)(n);function n(e){var a;return Object(j.a)(this,n),(a=t.call(this,e)).handleTabChange=function(e,t){a.props.handleTab(t)},a.handleEmbeddingsChange=function(e){var t=e.target.value,n=[];t.forEach((function(e){e.precomputed||(e=Object.assign(e,{bin:a.props.binValues,nbins:a.props.numberOfBins,_nbins:a.props.numberOfBinsUI,agg:a.props.binSummary})),n.push(e)})),a.props.handleEmbeddings(n)},a.handleUserMenuClose=function(){a.setState({userMenuOpen:!1})},a.handleMoreMenuClose=function(){a.setState({moreMenuOpen:!1})},a.handleHelp=function(){a.props.handleDialog(ga)},a.handleUserMenuOpen=function(e){a.setState({userMenuOpen:!0,userMenuAnchorEl:e.currentTarget})},a.handleMoreMenuOpen=function(e){a.setState({moreMenuOpen:!0,moreMenuAnchorEl:e.currentTarget})},a.getLinkJson=function(){return Ui(a.props)},a.handleDataset=function(e){if(null!=a.props.dataset){var t=a.props.savedDatasetState,n=a.getLinkJson();n.dataset=null,t[a.props.dataset.id]=n,a.props.handleSavedDatasetState(t)}a.props.handleTab("embedding"),a.props.handleDataset(e)},a.copyLink=function(e){var t=window.location.protocol+"//"+window.location.host+window.location.pathname;de(t+="#q="+encodeURIComponent(JSON.stringify(a.getLinkJson()))),a.props.setMessage("Link copied"),a.setState({moreMenuOpen:!1})},a.onDarkMode=function(){a.props.chartOptions.darkMode=!a.props.chartOptions.darkMode,a.props.handleChartOptions(a.props.chartOptions)},a.handleLogout=function(){a.setState({userMenuOpen:!1}),a.props.handleLogout()},a.handleImportDataset=function(e){a.props.handleDialog(va),a.setState({moreMenuOpen:!1})},a.handleSettings=function(e){a.props.handleDialog(fa),a.setState({moreMenuOpen:!1})},a.handleDelete=function(e){a.props.handleDialog(ja),a.setState({moreMenuOpen:!1})},a.handleShowDatasetDetails=function(e){a.setState({datasetDetailsEl:e.currentTarget})},a.handleCloseDatasetDetails=function(e){a.setState({datasetDetailsEl:null})},a.state={userMenuOpen:!1,userMenuAnchorEl:null,moreMenuOpen:!1,moreMenuAnchorEl:null},a}return Object(C.a)(n,[{key:"render",value:function(){var e=this,t=this.props,n=t.dataset,a=t.distributionData,r=t.loadingApp,o=t.jobResults,s=t.email,l=t.selection,c=t.searchTokens,u=t.serverInfo,d=t.tab,h=t.user,p=Boolean(this.state.datasetDetailsEl),f=null!=n&&null!=n.shape?n.shape:null,v=null!=n&&null!=f&&f[0]>0&&l.size>0,b=c.filter((function(e){return e.type===Y})).map((function(e){return e.value})),m=null!=h&&h.importer&&!r.loading&&u.capabilities.has(X),g=null!==n&&n.owner&&!r.loading&&u.capabilities.has("SERVER_CAPABILITY_EDIT_DATASET"),j=null!==n&&n.owner&&!r.loading&&u.capabilities.has("SERVER_CAPABILITY_DELETE_DATASET"),O=(m||g||j||null!=n)&&!r.loading,x=!r.loading&&null==s&&""!==u.clientId;return Object(V.jsx)(Sr.a,{position:"fixed",sx:{width:"calc(100% - ".concat(oc,"px)"),ml:"".concat(oc,"px")},children:Object(V.jsxs)(Er.a,{variant:"dense",style:{paddingLeft:6},children:[null!=n&&Object(V.jsx)(Cr.a,{id:"dataset-details",open:p,anchorEl:this.state.datasetDetailsEl,onClose:this.handleCloseDatasetDetails,anchorOrigin:{vertical:"bottom",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"center"},children:Object(V.jsxs)(Vi.a,{style:{width:500,padding:"1em"},children:[Object(V.jsx)(M.a,{children:n.name}),Object(V.jsx)(yr.a,{}),n.species&&Object(V.jsxs)(M.a,{children:["Species: ",n.species]}),n.title&&Object(V.jsxs)(M.a,{children:["Title: ",n.title]}),n.description&&Object(V.jsxs)(V.Fragment,{children:["Description: ",Object(V.jsx)(Rr.a,{options:{overrides:ce},children:n.description})]}),"true"===!Object({NODE_ENV:"production",PUBLIC_URL:".",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_VERSION:"1.1.2-2.post2"}).REACT_APP_STATIC&&Object(V.jsxs)(M.a,{children:["URL: ",n.url]})]})}),null==n&&Object(V.jsxs)(M.a,{variant:"h5",children:[Object(V.jsx)(Nr,{})," Cirrocumulus"]}),n&&Object(V.jsx)(Nr,{}),n&&Object(V.jsx)(T.a,{color:"inherit",style:{paddingLeft:6,whiteSpace:"nowrap",maxWidth:300,overflow:"hidden",textOverflow:"ellipsis"},href:"#",underline:"none",onClick:this.handleShowDatasetDetails,"aria-owns":this.state.datasetDetailsOpen?"dataset-details":void 0,"aria-haspopup":"true",component:"h3",children:Object(V.jsx)("b",{children:n.name})}),n&&Object(V.jsxs)("small",{style:{whiteSpace:"nowrap"},children:["\xa0",v&&null!=f&&Pt(l.size)+" / ",null!=f&&Pt(f[0])+" cells"]}),null!=n&&Object(V.jsxs)(no.a,{textColor:"inherit",indicatorColor:"secondary",value:d,onChange:this.handleTabChange,children:[Object(V.jsx)(kr.a,{"data-testid":"embedding-tab",value:"embedding",label:"Embeddings"}),Object(V.jsx)(kr.a,{"data-testid":"distributions-tab",value:"distribution",label:"Distributions",disabled:0===a.length}),Object(V.jsx)(kr.a,{"data-testid":"composition-tab",value:"composition",label:"Composition",disabled:b.length<2}),o.length>0&&Object(V.jsx)(kr.a,{"data-testid":"results-tab",value:"results",label:"Results"})]}),Object(V.jsxs)("div",{style:{marginLeft:"auto",whiteSpace:"nowrap",overflow:"hidden"},children:[u.brand&&Object(V.jsx)(Rr.a,{options:{overrides:ce,wrapper:"span",createElement:function(e,t,n){return t.display="inline",t.gutterBottom=!1,i.a.createElement(e,t,n)}},children:u.brand}),!r.loading&&!x&&Object(V.jsx)(to,{onChange:this.handleDataset}),O&&Object(V.jsx)(qe.a,{title:"More",children:Object(V.jsx)(Ze.a,{"aria-label":"Menu","aria-haspopup":"true",onClick:this.handleMoreMenuOpen,size:"large",children:Object(V.jsx)(_r.a,{})})}),O&&Object(V.jsxs)(Ye.a,{id:"more-menu",anchorEl:this.state.moreMenuAnchorEl,anchorOrigin:{vertical:"top",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},open:this.state.moreMenuOpen,onClose:this.handleMoreMenuClose,children:[m&&Object(V.jsx)(Qe.a,{onClick:this.handleImportDataset,children:"New Dataset"}),g&&Object(V.jsx)(Qe.a,{onClick:this.handleSettings,children:"Edit Dataset"}),j&&Object(V.jsx)(Qe.a,{onClick:this.handleDelete,children:"Delete Dataset"}),(m||g||j)&&null!=n&&Object(V.jsx)(yr.a,{}),null!=n&&Object(V.jsx)(Qe.a,{onClick:this.copyLink,children:"Copy Link "})]}),Object(V.jsx)(qe.a,{title:"Toggle Light/Dark Theme",children:Object(V.jsx)(Ze.a,{edge:!1,className:this.props.chartOptions.darkMode?"cirro-active":"","aria-label":"Toggle Theme",onClick:function(){return e.onDarkMode()},size:"large",children:Object(V.jsx)(Mr.a,{})})}),null!=n&&Object(V.jsx)(qe.a,{title:"Help",children:Object(V.jsx)(Ze.a,{"aria-label":"Help",onClick:this.handleHelp,size:"large",children:Object(V.jsx)(Ir.a,{})})}),null!=s&&""!==s&&Object(V.jsx)(qe.a,{title:s,children:Object(V.jsx)(Ze.a,{"aria-label":"Menu","aria-haspopup":"true",onClick:this.handleUserMenuOpen,size:"large",children:Object(V.jsx)(Tr.a,{})})}),null!=s&&""!==s&&Object(V.jsx)(Ye.a,{id:"menu-user",anchorEl:this.state.userMenuAnchorEl,anchorOrigin:{vertical:"top",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},open:this.state.userMenuOpen,onClose:this.handleUserMenuClose,children:Object(V.jsx)(Qe.a,{onClick:this.handleLogout,children:"Sign Out"})}),x&&Object(V.jsx)(wr.a,{style:{whiteSpace:"nowrap"},color:"inherit",onClick:this.props.handleLogin,children:"Sign In"})]})]})})}}]),n}(i.a.PureComponent),io=Object(o.b)((function(e){return{activeFeature:e.activeFeature,binSummary:e.binSummary,binValues:e.binValues,chartOptions:e.chartOptions,combineDatasetFilters:e.combineDatasetFilters,dataset:e.dataset,datasetChoices:e.datasetChoices,datasetFilter:e.datasetFilter,dialog:e.dialog,distributionData:e.distributionData,distributionPlotInterpolator:e.distributionPlotInterpolator,email:e.email,embeddingLabels:e.embeddingLabels,embeddings:e.embeddings,interpolator:e.interpolator,jobResults:e.jobResults,loading:e.loading,loadingApp:e.loadingApp,markerOpacity:e.markerOpacity,message:e.message,pointSize:e.pointSize,savedDatasetState:e.savedDatasetState,searchTokens:e.searchTokens,selection:e.selection,serverInfo:e.serverInfo,tab:e.tab,unselectedMarkerOpacity:e.unselectedMarkerOpacity,user:e.user}}),(function(e,t){return{handleTab:function(t){e(ji(t))},setMessage:function(t){e(pi(t))},handleLogin:function(){e((function(e,t){window.gapi.auth2.getAuthInstance().signIn().then((function(t){e(ci())}))}))},handleLogout:function(){e(Ia())},handleSavedDatasetState:function(t){e({type:Xn,payload:t})},handleDataset:function(t){e(Ai(t))},handleDialog:function(t){e(vi(t))},handleChartOptions:function(t){e(Ha(t))}}}))(ao),ro=-.6558780715202539,oo=-.04200263503409524,so=.16653861138229148,lo=-.04219773455554433,co=-.009621971527876973,uo=.0072189432466631,ho=-.0011651675918590652,po=-.00021524167411495098,fo=.0001280502823881162,vo=-2013485478078824e-20,bo=-12504934821426706e-22,mo=1133027231981696e-21,go=-2.056338416977607e-7,jo=.5*Math.log(2*Math.PI),Oo=[.9999999999999971,57.15623566586292,-59.59796035547549,14.136097974741746,-.4919138160976202,3399464998481189e-20,4652362892704858e-20,-9837447530487956e-20,.0001580887032249125,-.00021026444172410488,.00021743961811521265,-.0001643181065367639,8441822398385275e-20,-26190838401581408e-21,36899182659531625e-22];function xo(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e-15,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Number.MAX_VALUE;if(Number.isNaN(e)||Number.isNaN(t)||e<=0||t<0)return Number.NaN;if(0==t)return 1;if(t<e+1)return 1-wo(e,t,n,a);var i=function(t,n){return t*(e-t)},r=function(t,n){return 2*t+1-e+n};return Math.exp(-t+e*Math.log(t)-So(e))/Co(t,n,a,i,r)}function yo(e){if(e<-.5||e>1.5)throw new Error("Out of range");return-Math.log1p(function(e){if(e<-.5||e>1.5)throw new Error("Out of range");var t=e<=.5?e:e-.5-.5;if(t<0){var n=1.9575583661463974e-10,a=go+t*((6.116095104481416e-9+6.247308301164655e-9*t)/(n=1+t*(n=.203610414066807+t*(n=.026620534842894922+t*(n=.0004939449793824468+t*(n=t*(n=t*(n=9.926418406727737e-7+t*(n=t*n-6.077618957228252e-8))-64304548177935305e-22)-8514194324403149e-21))))));return a=t*(a=ro+t*(a=oo+t*(a=so+t*(a=lo+t*(a=co+t*(a=uo+t*(a=ho+t*(a=po+t*(a=fo+t*(a=vo+t*(a=bo+t*(a=mo+t*a))))))))))))-.42278433509846713,e>.5?t*a/e:e*(a+.5+.5)}var i=4343529937408594e-30,r=.00026923694661863613,o=go+(i=6.116095104481416e-9+t*(i=6.8716741130671986e-9+t*(i=6.820161668496171e-10+t*(i=4686843322948848e-26+t*(i=15728330277104463e-28+t*(i=t*i-12494415722763663e-29))))))/(r=1+t*(r=.3056961078365221+t*(r=.054642130860422966+t*(r=.004956830093825887+t*r))))*t;return o=.5772156649015329+t*(o=ro+t*(o=oo+t*(o=so+t*(o=lo+t*(o=co+t*(o=uo+t*(o=ho+t*(o=po+t*(o=fo+t*(o=vo+t*(o=bo+t*(o=mo+t*o)))))))))))),e>.5?t/e*(o-.5-.5):e*o}(e))}function So(e){if(Number.isNaN(e)||e<=0)return Number.NaN;if(e<.5)return yo(e)-Math.log(e);if(e<=2.5)return yo(e-.5-.5);if(e<=8){for(var t=Math.floor(e-1.5),n=1,a=1;a<=t;a++)n*=e-a;return yo(e-(t+1))+Math.log(n)}var i=function(e){for(var t=0,n=Oo.length-1;n>0;n--)t+=Oo[n]/(e+n);return t+Oo[0]}(e),r=e+4.7421875+.5;return(e+.5)*Math.log(r)-r+jo+Math.log(i/e)}function wo(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e-15,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Number.MAX_VALUE;if(Number.isNaN(e)||Number.isNaN(t)||e<=0||t<0)return Number.NaN;if(0==t)return 0;if(t>=e+1)return 1-xo(e,t,n,a);for(var i=0,r=1/e,o=r;Math.abs(r/o)>n&&i<a&&o<Number.POSITIVE_INFINITY;)o+=r*=t/(e+(i+=1));if(i>=a)throw new Error("Failed to converge");if(Number.isFinite(o)){var s=Math.exp(-t+e*Math.log(t)-So(e))*o;return s>1?1:s}return 1}function Co(e,t,n,a,i){for(var r,o=ko(i(0,e)),s=1,l=0,c=o;s<=n;){var u=a(s,e),d=i(s,e),h=ko(d+u*l),p=ko(d+u/c),f=p*(h=1/h);if(r=o*f,!Number.isFinite(r))throw new Error("Continued fraction convergents diverged to +/- infinity");if(Number.isNaN(r))throw new Error("Continued fraction diverged to NaN");if(Math.abs(f-1)<t)return r;l=h,c=p,o=r,++s}throw new Error("maximal count exceeded")}function ko(e){return Math.abs(e-0<=1e-50)?1e-50:e}function Eo(e){for(var t=[],n=e.length,a=e[0].length,i=0,r=0;r<n;r++){for(var o=0,s=0;s<a;s++)o+=e[r][s];t.push(o),i+=o}for(var l=[],c=0;c<a;c++){for(var u=0,d=0;d<n;d++)u+=e[d][c];l.push(u)}for(var h=[],p=0;p<n;p++){for(var f=[],v=0;v<a;v++)f.push(t[p]*l[v]/i);h.push(f)}for(var b=0,m=0;m<n;m++)for(var g=0;g<a;g++)b+=Math.pow(e[m][g]-h[m][g],2)/h[m][g];var j,O,x,y=(n-1)*(a-1);return{expected:h,statistic:b,p:1-(O=y/2,x=2,(j=b)<=0?0:j>=Number.POSITIVE_INFINITY?1:wo(O,j/x)),df:y}}function zo(e,t,n,a){return Math.exp(Po(e+t)+Po(n+a)+Po(e+n)+Po(t+a)-(Po(e)+Po(t)+Po(n)+Po(a)+Po(e+t+n+a)))}var To=[0,0,.6931471805599453,1.791759469228055,3.1780538303479458,4.787491742782046,6.579251212010101,8.525161361065415,10.60460290274525,12.801827480081469,15.104412573075516,17.502307845873887,19.987214495661885,22.552163853123425,25.19122118273868,27.89927138384089,30.671860106080672,33.50507345013689,36.39544520803305,39.339884187199495,42.335616460753485,45.38013889847691,48.47118135183523,51.60667556776438,54.78472939811232,58.00360522298052,61.261701761002,64.55753862700634,67.88974313718154,71.25703896716801];function Po(e){if(e>=30){var t=1/e,n=t*t;return(e+.5)*Math.log(e)-e+.9189385332046728+t*(.08333333333333333+n*(n*(.0007936507936507937+-.0005952380952380953*n)-.002777777777777778))}return To[e]}var Mo=Object(P.a)((function(e){return{table:{width:"min-content","& td":{padding:6},"& th":{padding:6}}}}))((function(e){var t=Object(a.useState)(null),n=Object(Xe.a)(t,2),i=n[0],r=n[1],o=Object(a.useRef)(null),s=Object(a.useRef)({}),l=e.seriesToValueToCounts,c=e.colorScale,u=e.series,d=e.textColor,h=e.title,p=e.subtitle,f=e.uniqueValues;function v(e){if(null!=l){var t=s.current.height,n=s.current.margin,a=Object(_.a)().domain([0,1]).range([t-n.bottom,n.top]);e.textAlign="left",e.textBaseline="middle",e.textAlign="right",e.textBaseline="top";for(var i=a(0),r=function(t){var r=u[t],o=l[r],s=0;f.forEach((function(e){var t=o[e]||0;s+=t}));var h=i,p=n.left+20*t+10*t;f.forEach((function(t){var n=o[t];if(void 0!==n){var i=a(0)-a(n/s),r=h-i;e.fillStyle=c(t),e.fillRect(p,r,20,i),h=r}})),e.fillStyle=d,e.save(),e.translate(p+4,i+4),e.rotate(-Math.PI/2),e.fillText(r,0,0),e.restore()},o=0;o<u.length;o++)r(o);e.fillStyle=d,e.textBaseline="middle",e.textAlign="right",[0,.2,.4,.6,.8,1].forEach((function(t){var i=a(t);e.fillText(""+100*t,n.left-8,i),e.beginPath(),e.moveTo(n.left-6,i),e.lineTo(n.left-2,i),e.stroke()}))}}Object(a.useEffect)((function(){var e=o.current,t=e.getContext("2d");t.font=cn;var n=0;u.forEach((function(e){return n=Math.max(n,t.measureText(e).width)}));var a={left:25,top:10,bottom:n+6,right:4};s.current.margin=a;var i=20*u.length+10*u.length+a.left+a.right;s.current.width=i;var r=600+a.bottom+a.top;s.current.height=r,e.width=i*devicePixelRatio,e.height=r*devicePixelRatio,e.style.width=i+"px",e.style.height=r+"px",(t=e.getContext("2d")).font=cn,t.clearRect(0,0,i*devicePixelRatio,r*devicePixelRatio),t.scale(devicePixelRatio,devicePixelRatio),v(t)}));var b=function(e){var t,n;r(null),"svg"===e?(t=new window.C2S(10,10)).font=un:(t=(n=document.createElement("canvas")).getContext("2d")).font=cn;var a=s.current.width,i=s.current.height;"svg"===e?(t=new window.C2S(a,i)).font=un:(n.width=a*window.devicePixelRatio,n.height=i*window.devicePixelRatio,(t=n.getContext("2d")).scale(window.devicePixelRatio,window.devicePixelRatio),t.font=cn);if(t.fillStyle="white",t.fillRect(0,0,a,i),v(t),"svg"===e){var o=t.getSerializedSvg(),l=new Blob([o],{type:"text/plain;charset=utf-8"});window.saveAs(l,"composition.svg")}else n.toBlob((function(e){window.saveAs(e,"composition.png",!0)}))},m=[];f.forEach((function(e){var t=[];m.push(t),u.forEach((function(n){var a=l[n][e]||0;t.push(a)}))}));var g=null,j=null;if(2===m.length&&2===m[0].length)g=function(e,t,n,a){for(var i=zo(e,t,n,a),r=i,o=0,s=e+t+n+a;o<=s;o++){var l=e+t-o,c=e+n-o,u=t+a-l;if(o!==e&&l>=0&&c>=0&&u>=0){var d=zo(o,l,c,u);d<=i&&(r+=d)}}return Math.min(1,r)}(m[0][0],m[0][1],m[1][0],m[1][1]),j="Fisher's Exact";else if(m.length>=2&&m[0].length>=2){g=Eo(m).p,j="Chi-Square"}return Object(V.jsxs)(V.Fragment,{children:[Object(V.jsxs)("div",{children:[Object(V.jsxs)(M.a,{style:{display:"inline-block"},component:"h4",color:"textPrimary",children:[h,p&&Object(V.jsxs)("small",{children:["(",p,")"]})]}),Object(V.jsx)(qe.a,{title:"Save Image",children:Object(V.jsx)(Ze.a,{"aria-controls":"save-image-menu","aria-haspopup":"true",edge:!1,size:"small","aria-label":"Save Image",onClick:function(e){r(e.currentTarget)},children:Object(V.jsx)(ht.a,{})})}),Object(V.jsxs)(Ye.a,{id:"save-image-menu",anchorEl:i,keepMounted:!0,open:Boolean(i),onClose:function(e){r(null)},children:[Object(V.jsx)(Qe.a,{onClick:function(e){return b("png")},children:"PNG"}),Object(V.jsx)(Qe.a,{onClick:function(e){return b("svg")},children:"SVG"})]})]}),Object(V.jsxs)("div",{style:{display:"flex",flex:"flex-wrap"},children:[Object(V.jsx)("canvas",{ref:o}),Object(V.jsxs)("div",{children:[Object(V.jsxs)(Hi.a,{size:"small",className:e.classes.table,children:[Object(V.jsx)(Wi.a,{children:Object(V.jsxs)(Gi.a,{children:[Object(V.jsx)(Ji.a,{}),u.map((function(e){return Object(V.jsx)(Ji.a,{children:e},e)}))]})}),Object(V.jsx)(qi.a,{children:f.map((function(e,t){var n=m[t];return Object(V.jsxs)(Gi.a,{children:[Object(V.jsxs)(Ji.a,{style:{whiteSpace:"nowrap"},component:"th",children:[Object(V.jsx)("div",{style:{display:"inline-block",width:"1em",height:"1em",marginRight:2,verticalAlign:"text-bottom",backgroundColor:c(e)}}),e]}),u.map((function(e,t){var a=n[t],i=Pt(a);return Object(V.jsx)(Ji.a,{style:{textAlign:"center"},children:i},e)}))]},e)}))})]}),null!=g&&Object(V.jsxs)(M.a,{color:"textPrimary",children:[j," p-value: ",Tt(g)]})]})]})]})}));function Ao(e,t,n){if(t[e]){for(var a=t[e],i=new Map,r=n[e]||{},o=0;o<a.length;o++){var s=a[o];s=le(r,s),i.set(s,o)}return function(e,t){return i.get(e)-i.get(t)}}return W}function Io(e,t,n,a,i){var r=t.length;if(r>=2){for(var o=0,s=[],l=e.shape[0],c=[],u=0;u<r;u++){var d=n[t[u]];if(null==d)return null;s.push(d),c.push(a[t[u]]||{})}for(var h=null!=i&&i.size>0,p=r-1,f={},v={},b=0;b<l;b++)if(!h||i.has(b)){for(var m=[],g=0;g<r-1;g++){var j=s[g][b];j=le(c[g],j),m.push(j)}var O=m.join(","),x=f[O];if(void 0===x&&(x={},v[O]=m,f[O]=x,++o>100))return null;var y=s[p][b],S=c[p][y];void 0!==S&&(y=S);var w=x[y]||0;x[y]=w+1}for(var C=[],k=e.categoryOrder||{},E=0;E<r-1;E++){var z=t[E];C.push(Ao(z,k,a))}var T=Object.keys(f);T.sort((function(e,t){for(var n=v[e],a=v[t],i=0;i<C.length;i++){var r=C[i](n[i],a[i]);if(0!==r)return r}return 0}));var P=new Set;for(var M in f){var A=f[M];for(var I in A)P.add(I)}var D=Array.from(P);return D.sort(Ao(t[r-1],k,a)),{seriesToValueToCounts:f,uniqueValues:D,series:T}}return null}var Do=Object(o.b)((function(e){return{cachedData:e.cachedData,categoricalNames:e.categoricalNames,chartOptions:e.chartOptions,dataset:e.dataset,embeddingData:e.embeddingData,searchTokens:e.searchTokens,selection:e.selection}}),(function(e){return{}}))((function(e){var t=e.cachedData,n=e.categoricalNames,a=e.chartOptions,i=e.dataset,r=e.embeddingData,o=e.searchTokens,s=e.selection,l=o.filter((function(e){return e.type===Y})).map((function(e){return e.value}));if(l.length>1){var c=l[l.length-1],h=function(e,t){for(var n=null,a=0;a<e.length;a++)if(t===e[a].name){n=e[a].colorScale;break}return null==n&&(n=Object(u.a)(d.a)),n}(r,c),p=Io(i,l,t,n),f=a.darkMode?"white":"black",v=s.size>0?Io(i,l,t,n,s):null,b=c+" composition in "+l.slice(0,l.length-1).join(", ");return Object(V.jsxs)(V.Fragment,{children:[p&&Object(V.jsx)(Mo,{seriesToValueToCounts:p.seriesToValueToCounts,dimension:c,title:b,colorScale:h,series:p.series,uniqueValues:p.uniqueValues,textColor:f}),v&&Object(V.jsx)(Mo,{seriesToValueToCounts:v.seriesToValueToCounts,dimension:c,title:b,subtitle:"selection",colorScale:h,series:v.series,uniqueValues:v.uniqueValues,textColor:f})]})}return null})),_o=n(396),Ro=function(e){Object(O.a)(n,e);var t=Object(x.a)(n);function n(e){var a;return Object(j.a)(this,n),(a=t.call(this,e)).handleClose=function(){a.props.handleCancel()},a.handleDelete=function(){a.setState({loading:!0}),a.props.handleDelete({dataset:a.props.dataset})},a.state={open:!0},a}return Object(C.a)(n,[{key:"render",value:function(){return Object(V.jsxs)(br.a,{open:this.state.open,onClose:this.handleClose,"aria-labelledby":"delete-dataset-dialog-title",fullWidth:!0,maxWidth:"sm",children:[Object(V.jsx)(mr.a,{id:"delete-dataset-dialog-title",children:"Delete Dataset"}),Object(V.jsx)(Jr.a,{children:this.props.dataset&&Object(V.jsxs)("h3",{children:["Are you sure you want to delete ",this.props.dataset.name,"?"]})}),Object(V.jsxs)(_o.a,{children:[Object(V.jsx)(wr.a,{disabled:this.state.loading,onClick:this.handleClose,children:"Cancel"}),Object(V.jsx)(wr.a,{disabled:this.state.loading,onClick:this.handleDelete,variant:"contained",color:"primary",children:"Delete"})]})]})}}]),n}(i.a.PureComponent),No=Object(o.b)((function(e){return{dataset:e.dataset,email:e.email}}),(function(e){return{handleDelete:function(t){e(hi(t))},handleCancel:function(t){e(vi(null))}}}))(Ro),Fo=n(358),Lo=n(398),Bo=n(342);function Uo(e,t,n,a){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:20,r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"black",o=t.domain(),s=(o[1]-o[0])/(n+1),l=[];l.push(o[0]);for(var c=o[0],u=0;u<n;u++)c+=s,l.push(c);l.push(o[1]);var d=20,h=Object(_.a)().range([i,a-i]).domain([0,l.length-1]).clamp(!0),p=[1,9];t.range()[0]>t.range()[1]&&(p=[9,1]);var f=Object(_.a)().range(p).domain(o).clamp(!0);e.textBaseline="top",e.fillStyle=r,e.strokeStyle=r,e.textAlign="center";for(var v=0;v<l.length;v++){var b=h(v),m=f(l[v]);e.beginPath(),e.arc(b,10,m,0,2*Math.PI),e.stroke();var g=he(Tt(l[v]));e.fillText(g,b,d+2)}}var Vo=function(e){Object(O.a)(n,e);var t=Object(x.a)(n);function n(e){var a;return Object(j.a)(this,n),(a=t.call(this,e)).ref=i.a.createRef(),a.backingScale=1,a}return Object(C.a)(n,[{key:"redraw",value:function(){var e=this.backingScale,t=this.ref.current.getContext("2d"),n=this.props.height,a=this.props.width,i=this.props.textColor||"black";t.font=cn,t.clearRect(0,0,a*e,n*e),t.scale(e,e);var r=this.props.scale;null!=r&&(Uo(t,r,this.props.nsteps||3,a,20,i),t.setTransform(1,0,0,1,0,0))}},{key:"componentDidUpdate",value:function(e,t,n){this.redraw()}},{key:"componentDidMount",value:function(){this.redraw()}},{key:"render",value:function(){var e=1;"undefined"!==typeof window&&"devicePixelRatio"in window&&(e=window.devicePixelRatio),this.backingScale=e;var t=this.props.height,n=this.props.width,a={width:n,height:t};return this.props.style&&(a=Object.assign({},a,this.props.style)),Object(V.jsx)("canvas",{width:n*e,height:t*e,ref:this.ref,style:a})}}]),n}(i.a.PureComponent),Ho=12;function Wo(e,t){var n=[],a=0;if(e[0].length>0){a=e[0][0].name.length;for(var i=0;i<e[0][0].name.length;i++)n.push(0)}e.forEach((function(e){for(var i=e[0].name,r=0;r<a;r++)n[r]=Math.max(n[r],t.measureText(i[r]).width)}));for(var r=0;r<n.length;r++)n[r]+=6,n[r]+=Ho;return(n=Object(Bo.a)(n))[n.length-1]+=4,{endCoordinates:n,sum:n[n.length-1]}}var Go=function(e){Object(O.a)(n,e);var t=Object(x.a)(n);function n(e){var a;return Object(j.a)(this,n),(a=t.call(this,e)).diffExp=function(){!function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=0;n<e.length;n++){for(var a=[],i=0;i<e[0].length;i++){for(var r=e[n][i].vector,o=new Float32Array(r.size()),s=0,l=o.length;s<l;s++)o[s]=r.get(s);for(var c=[],u=0;u<e.length;u++)if(n!==u)for(var d=e[u][i].vector,h=0,p=d.size();h<p;h++)c.push(d.get(h));var f=Le(new Te("",o)),v=Le(new Te("",c)),b=rs(o,c);b.foldChange=Math.log2(f.logSum/f.n+t)-Math.log2(v.logSum/v.n+t),b.percentExpressed2=v.numExpressed/v.n*100,a.push(b)}for(var m=Oe(a.map((function(e){return e.p}))),g=0;g<e[0].length;g++){var j=e[n][g],O=a[g];O.fdr=m[g],j.de=O}}}(a.props.data)},a.exportFile=function(){var e=a.props.data,t=e.length>0?e[0].length:0,n=e.length,i=[];i.push("id");for(var r=0;r<n;r++){i.push("\t");var o=e[r][0].name.join("_");i.push(o+":mean"),i.push("\t"),i.push(o+":percent_expressed")}i.push("\n");for(var s=0;s<t;s++){for(var l=0;l<n;l++){var c=e[l][s];0===l&&i.push(c.feature),i.push("\t"),i.push(c.mean),i.push("\t"),i.push(c.percentExpressed)}i.push("\n")}var u=new Blob([i.join("")],{type:"text/plain;charset=utf-8"});window.saveAs(u,a.props.data[0][0].dimension+".tsv")},a.handleSaveImageMenu=function(e){a.setState({saveImageEl:e.currentTarget})},a.handleSaveImageMenuClose=function(e){a.setState({saveImageEl:null})},a.handleSaveImage=function(e){var t,n;a.setState({saveImageEl:null}),"svg"===e?(t=new window.C2S(10,10)).font=un:(t=(n=document.createElement("canvas")).getContext("2d")).font=cn;var i=a.getSize(t),r=i.height+i.y+35+40+10,o=Math.max(200,i.width+i.x),s=1;"svg"===e?(t=new window.C2S(o,r)).font=un:(n.width=o*window.devicePixelRatio,n.height=r*window.devicePixelRatio,t=n.getContext("2d"),s=window.devicePixelRatio,t.scale(s,s),t.font=cn);var l=a.props.textColor;if(t.fillStyle="white"===l?"black":"white",t.fillRect(0,0,o,r),a.drawContext(t,i),t.translate(4,s*(i.height+i.y+4)),sn(t,a.props.colorScale,l),t.translate(-10,39),a.props.drawCircles&&Uo(t,a.props.sizeScale,3,150,20,l),"svg"===e){var c=t.getSerializedSvg(),u=new Blob([c],{type:"text/plain;charset=utf-8"});window.saveAs(u,a.props.data[0][0].dimension+".svg")}else n.toBlob((function(e){window.saveAs(e,a.props.data[0][0].dimension+".png",!0)}))},a.divRef=i.a.createRef(),a.canvas=null,a.state={saveImageEl:null},a}return Object(C.a)(n,[{key:"redraw",value:function(){var e=this;if(null==this.props.data)return Object(V.jsx)("div",{});var t=1;if("undefined"!==typeof window&&"devicePixelRatio"in window&&(t=window.devicePixelRatio),null==this.canvas){this.canvas=document.createElement("canvas"),this.canvas.addEventListener("mousemove",(function(t){var n=t.target,a=e.props.sizeScale.range()[1],i=n.getBoundingClientRect(),r=[t.clientX-i.left-n.clientLeft,t.clientY-i.top-n.clientTop],o=Math.floor((r[0]-e.size.x)/(2*a)),s=Math.floor(r[1]/(2*a));if(o>=0&&o<e.props.data[0].length&&s>=0&&s<e.props.data.length){e.props.setTooltip("");var l=e.props.data[s][o],c="mean: "+he(Tt(l.mean))+", % expressed: "+he(Tt(l.percentExpressed))+", # cells: "+Pt(l.n);l.de&&(c+=", % expressed rest: "+he(zt(l.de.percentExpressed2)),c+=", log2 fold change: "+he(Tt(l.de.foldChange)),c+=", p-value: "+he(Tt(l.de.p)),c+=", FDR: "+he(Tt(l.de.fdr))),e.props.setTooltip(c+", "+l.feature+", "+l.name.join(", "))}else e.props.setTooltip("")})),this.canvas.addEventListener("mouseout",(function(t){e.props.setTooltip("")})),this.divRef.current.append(this.canvas)}var n=this.size.height+this.size.y,a=this.size.width+this.size.x,i=this.canvas,r=i.getContext("2d");i.width=a*t,i.height=n*t,i.style.width=a+"px",i.style.height=n+"px",r.font=cn,r.clearRect(0,0,a*t,n*t),r.scale(t,t),this.drawContext(r,this.size)}},{key:"drawContext",value:function(e,t){var n=this.props.data,a=this.props.colorScale,i=this.props.interpolator,r=this.props.categoryColorScales,o=this.props.sizeScale,s=this.props.drawCircles,l=this.props.textColor,c=o.range()[1],u=2*c,d=i.scale===re||i.scale===oe?Object(_.a)().range([0,1]):null,h=n.length>0?n[0].length:0,p=n.length,f=null;if(i.scale===re){f=[];for(var v=0;v<h;v++){for(var b=Number.MAX_VALUE,m=-Number.MAX_VALUE,g=0;g<p;g++){var j=n[g][v].mean;b=Math.min(b,j),m=Math.max(m,j)}f.push([b,m])}}else if(i.scale===oe){f=[];for(var O=0;O<p;O++){for(var x=Number.MAX_VALUE,y=-Number.MAX_VALUE,S=0;S<h;S++){var w=n[O][S].mean;x=Math.min(x,w),y=Math.max(y,w)}f.push([x,y])}}for(var C=0;C<h;C++){i.scale===re&&d.domain(f[C]);for(var k=0;k<p;k++){i.scale===oe&&d.domain(f[k]);var E=n[k][C],z=E.mean,T=k*u+(s?c:0);d&&(z=d(z));var P=a(z);if(e.fillStyle=P,e.beginPath(),s){var M=C*u+c+t.x,A=E.percentExpressed;e.arc(M,T,o(A),0,2*Math.PI)}else{var I=C*u+t.x;e.rect(I,T,u,u)}e.fill()}}e.textAlign="left",e.textBaseline="middle",n.forEach((function(n,a){for(var i=n[0].name,o=a*u+c,s=0;s<i.length;s++){var d=0===s?0:t.endCoordinates[s-1],h=r[s];e.fillStyle=h(n[0].categories[s]),e.beginPath(),e.rect(d,o-c/2-3,Ho,Ho),e.fill(),e.stroke(),e.fillStyle=l,e.fillText(i[s],d+2+Ho,o)}})),e.textAlign="right",e.textBaseline="top",n[0].forEach((function(n,a){var i=n.feature,r=a*u;e.save(),e.translate(t.x+r+4,t.height),e.rotate(-Math.PI/2),e.fillText(i,0,0),e.restore()})),e.setTransform(1,0,0,1,0,0)}},{key:"componentDidUpdate",value:function(e,t,n){this.redraw()}},{key:"componentDidMount",value:function(){this.redraw()}},{key:"getSize",value:function(e){var t=0,n=this.props.data;n[0].forEach((function(n){t=Math.max(t,e.measureText(n.feature).width)})),t+=4;var a=Wo(n,e),i=2*this.props.sizeScale.range()[1],r=n.length*i+4,o=n[0].length*i+4;return{endCoordinates:a.endCoordinates,x:a.sum,y:t,width:o,height:r}}},{key:"update",value:function(){var e=(null==this.canvas?document.createElement("canvas"):this.canvas).getContext("2d");e.font=cn,this.size=this.getSize(e)}},{key:"render",value:function(){var e=this;this.update();var t=this.state.saveImageEl,n=this.props.data[0][0].dimension;return Object(V.jsxs)("div",{style:{position:"relative"},children:[Object(V.jsxs)("div",{children:[Object(V.jsxs)(M.a,{style:{display:"inline-block"},component:"h4",color:"textPrimary",children:[n,this.props.subtitle&&Object(V.jsxs)("small",{children:["(",this.props.subtitle,")"]})]}),Object(V.jsx)(qe.a,{title:"Save Image",children:Object(V.jsx)(Ze.a,{"aria-controls":"save-image-menu","aria-haspopup":"true",edge:!1,size:"small","aria-label":"Save Image",onClick:this.handleSaveImageMenu,children:Object(V.jsx)(ht.a,{})})}),Object(V.jsxs)(Ye.a,{id:"save-image-menu",anchorEl:t,keepMounted:!0,open:Boolean(t),onClose:this.handleSaveImageMenuClose,children:[Object(V.jsx)(Qe.a,{onClick:function(t){return e.handleSaveImage("png")},children:"PNG"}),Object(V.jsx)(Qe.a,{onClick:function(t){return e.handleSaveImage("svg")},children:"SVG"})]}),Object(V.jsx)(qe.a,{title:"Export",children:Object(V.jsx)(Ze.a,{edge:!1,size:"small","aria-label":"Export",onClick:this.exportFile,children:Object(V.jsx)(Yi.a,{})})})]}),Object(V.jsx)("div",{ref:this.divRef})]})}}]),n}(i.a.PureComponent),Jo=n(397),Xo=n(386);function qo(e){return e.startsWith("interpolate")&&(e=e.substring("interpolate".length)),e}var Ko=function(e){Object(O.a)(n,e);var t=Object(x.a)(n);function n(e){var a;return Object(j.a)(this,n),(a=t.call(this,e)).onInterpolatorChange=function(e){var t=e.target.value;a.props.handleInterpolator(Object.assign({},a.props.interpolator,{name:t,value:we(t)}))},a.state={forceUpdate:!1},a}return Object(C.a)(n,[{key:"getScale",value:function(e){return Ce({name:e,value:N[e],reversed:this.props.interpolator.reversed}).domain([0,1])}},{key:"render",value:function(){var e=this,t=this.props,n=t.classes,a=t.interpolator;null==a.reversed&&(a.reversed=!1);var i=Se(a.name),r=this.props.width||176;return Object(V.jsxs)(V.Fragment,{children:[Object(V.jsx)(Fo.a,{shrink:!0,children:"Color Scheme"}),Object(V.jsxs)(Fr.a,{input:Object(V.jsx)(Xo.a,{}),className:n.select,onChange:this.onInterpolatorChange,value:i,multiple:!1,children:[Object(V.jsx)(Qe.a,{value:"Diverging",divider:!0,disabled:!0,children:"Diverging"},"Diverging"),G.Diverging.map((function(t){return Object(V.jsx)(Qe.a,{title:qo(t),value:t,children:Object(V.jsx)(ln,{width:r,label:!1,height:14,scale:e.getScale(t)})},t)})),Object(V.jsx)(Qe.a,{value:"Sequential (Single Hue)",divider:!0,disabled:!0,children:"Sequential (Single Hue)"},"Sequential (Single Hue)"),G["Sequential (Single Hue)"].map((function(t){return Object(V.jsx)(Qe.a,{title:qo(t),value:t,children:Object(V.jsx)(ln,{width:r,label:!1,height:14,scale:e.getScale(t)})},t)})),Object(V.jsx)(Qe.a,{value:"Sequential (Multi-Hue)",divider:!0,disabled:!0,children:"Sequential (Multi-Hue)"},"Sequential (Multi-Hue)"),G["Sequential (Multi-Hue)"].map((function(t){return Object(V.jsx)(Qe.a,{title:qo(t),value:t,children:Object(V.jsx)(ln,{width:r,label:!1,height:14,scale:e.getScale(t)})},t)})),Object(V.jsx)(Qe.a,{value:"Cyclical",divider:!0,disabled:!0,children:"Cyclical"},"Cyclical"),G.Cyclical.map((function(t){return Object(V.jsx)(Qe.a,{title:qo(t),value:t,children:Object(V.jsx)(ln,{width:r,label:!1,height:14,scale:e.getScale(t)})},t)}))]})]})}}]),n}(i.a.PureComponent),Zo=Object(P.a)((function(e){return{root:{display:"flex",flexWrap:"wrap","flex-direction":"column"},formControl:{display:"block",margin:e.spacing(1)}}}))(Ko),Yo=function(e){Object(O.a)(n,e);var t=Object(x.a)(n);function n(e){var a;return Object(j.a)(this,n),(a=t.call(this,e)).onMinChange=function(e){a.props.onMinUIChange(e.target.value),a.updateMin(e.target.value)},a.updateMin=function(e){a.props.onMinChange(parseFloat(e))},a.onMaxChange=function(e){a.props.onMaxUIChange(e.target.value),a.updateMax(e.target.value)},a.updateMax=function(e){a.props.onMaxChange(parseFloat(e))},a.onReversedChange=function(e){a.props.onInterpolator(Object.assign({},a.props.interpolator,{reversed:e.target.checked}))},a.updateMin=Object(f.debounce)(a.updateMin,500),a.updateMax=Object(f.debounce)(a.updateMax,500),a}return Object(C.a)(n,[{key:"render",value:function(){var e=this.props,t=e.domain,n=e.textColor,a=e.interpolator,i=e.onInterpolator,r=e.min,o=e.max,s="",l="";t&&(isNaN(t[0])||(s=he(zt(t[0]))),isNaN(t[1])||(l=he(zt(t[1]))),""!==s&&s===l&&(s=he(Tt(t[0])),l=he(Tt(t[1]))));return Object(V.jsxs)(V.Fragment,{children:[Object(V.jsx)(Zo,{handleInterpolator:i,interpolator:a}),Object(V.jsxs)(V.Fragment,{children:[Object(V.jsxs)("div",{style:{color:n,width:176},children:[Object(V.jsx)(M.a,{variant:"caption",children:s}),Object(V.jsx)(M.a,{variant:"caption",style:{float:"right"},children:l})]}),Object(V.jsx)(Fo.a,{disabled:null==t,shrink:!0,variant:"standard",children:"Custom Color Range"}),Object(V.jsx)(qr.a,{InputLabelProps:{shrink:!0},style:{width:90,marginRight:4},size:"small",type:"text",disabled:null==t,onChange:this.onMinChange,label:"Min",value:r}),Object(V.jsx)(qr.a,{InputLabelProps:{shrink:!0},style:{width:90},size:"small",type:"text",disabled:null==t,onChange:this.onMaxChange,label:"Max",value:o})]}),Object(V.jsx)(qe.a,{title:"Select to invert the color order",children:Object(V.jsx)("div",{children:Object(V.jsx)(Jo.a,{control:Object(V.jsx)(Lo.a,{checked:a.reversed,onChange:this.onReversedChange}),label:"Reverse Colors"})})})]})}}]),n}(i.a.PureComponent),Qo=function(e){Object(O.a)(n,e);var t=Object(x.a)(n);function n(e){var a;return Object(j.a)(this,n),(a=t.call(this,e)).onMinSizeChange=function(e){a.setState({minSize:e.target.value}),a.updateMinSize(e.target.value)},a.updateMinSize=function(e){e=parseFloat(e),a.props.onOptions({minSize:e})},a.onMaxSizeChange=function(e){a.setState({maxSize:e.target.value}),a.updateMaxSize(e.target.value)},a.updateMaxSize=function(e){e=parseFloat(e),a.props.onOptions({maxSize:e})},a.onReversedChange=function(e){a.props.onReversedChange(e.target.checked)},a.state={minSize:"",maxSize:""},a.updateMinSize=Object(f.debounce)(a.updateMinSize,500),a.updateMaxSize=Object(f.debounce)(a.updateMaxSize,500),a}return Object(C.a)(n,[{key:"render",value:function(){var e=this.props,t=e.sizeScale,n=e.reversed,a=e.showReversed,i=e.textColor;return Object(V.jsxs)(V.Fragment,{children:[Object(V.jsx)(Vo,{style:{display:"block"},width:174,textColor:i,label:!0,height:40,scale:t}),a&&Object(V.jsx)("div",{children:Object(V.jsx)(Jo.a,{control:Object(V.jsx)(Lo.a,{checked:n,onChange:this.onReversedChange}),label:"Reverse Sizes"})}),Object(V.jsx)(Fo.a,{style:{marginTop:16},shrink:!0,variant:"standard",children:"Custom Size Range"}),Object(V.jsx)(qr.a,{InputLabelProps:{shrink:!0},style:{width:90,marginRight:4},size:"small",type:"text",onChange:this.onMinSizeChange,label:"Min",value:this.state.minSize}),Object(V.jsx)(qr.a,{InputLabelProps:{shrink:!0},style:{width:90},size:"small",type:"text",onChange:this.onMaxSizeChange,label:"Max",value:this.state.maxSize})]})}}]),n}(i.a.PureComponent),$o=n(359);function es(e,t){for(var n=0,a=e.length,i=0;i<a;i++){var r=e[i]-t;n+=r*=r}return a<=1?NaN:((a-=1)<1&&(a=1),n/a)}function ts(e){return 1/Math.sqrt(2*Math.PI)*Math.exp(-.5*e*e)}function ns(e,t,n){var a=n.length,i=1/(a*e);return function(r){for(var o=0,s=0;s<a;s++)o+=t((r-n[s])/e);return i*o}}var as=Math.sqrt(2);function is(e,t,n){var a=t*n,i=a*(t+n+1)/12;return 2*function(e,t,n){var a=e-t;if(Math.abs(a)>40*n)return a<0?0:1;return.5*function(e){if(Math.abs(e)>40)return e>0?0:2;var t=xo(.5,e*e,1e-15,1e4);return e<0?2-t:t}(-a/(n*as))}((e-a/2)/Math.sqrt(i),0,1)}function rs(e,t){var n=function(e,t){for(var n=[],a=0,i=e.length;a<i;a++)n.push(e[a]);for(var r=0,o=t.length;r<o;r++)n.push(t[r]);for(var s=function(e){for(var t=[],n=0,a=e.length;n<a;n++)t.push({value:e[n],position:n});t.sort((function(e,t){return e.value<t.value||e.value===t.value&&e.position<t.position?-1:1}));var i=new Array(t.length),r=1;i[t[0].position]=r;var o=[];o.push(t[0].position);for(var s=1;s<t.length;s++)t[s].value>t[s-1].value?(r=s+1,o.length>1&&me(i,o),(o=[]).push(t[s].position)):o.push(t[s].position),i[t[s].position]=r;return o.length>1&&me(i,o),i}(n),l=0,c=0;c<e.length;++c)l+=s[c];var u=l-e.length*(e.length+1)/2,d=e.length*t.length-u;return Math.max(u,d)}(e,t);return{statistic:n,p:is(e.length*t.length-n,e.length,t.length)}}function os(e,t,n,a){e.lineWidth=1;var i=t.tickFormat(4),r=t.ticks(4);e.textAlign="right",e.textBaseline="middle",e.fillStyle=n,e.strokeStyle=n;var o=a.x-4;e.lineWidth=.5,e.beginPath(),e.moveTo(o+4,t(t.domain()[0])),e.lineTo(o+4,t(t.domain()[1])),e.stroke(),r.forEach((function(n){var a=t(n);e.fillText(i(n),o,a),e.beginPath(),e.moveTo(o,a),e.lineTo(o+4,a),e.stroke()})),e.lineWidth=1}function ss(e){var t=e.xscale,n=e.textColor,i=e.violinHeight,r=e.size,o=Object(a.useRef)(null);return Object(a.useEffect)((function(){var e=o.current,a=e.getContext("2d");a.setTransform(1,0,0,1,0,0),a.font=cn,a.clearRect(0,0,e.width,e.height),a.scale(window.devicePixelRatio,window.devicePixelRatio),os(a,t,n,r)})),Object(V.jsx)("canvas",{ref:o,width:r.x*window.devicePixelRatio,height:(r.y+i)*window.devicePixelRatio,style:{width:r.x,height:r.y+i}})}function ls(e){var t=e.categoryColorScales,n=e.categoryIndex,i=e.data,r=e.feature,o=e.featureIndex,s=e.names,l=e.options,c=e.size,u=e.textColor,d=e.xscale,h=e.yscale,p=Object(a.useRef)(null);return Object(a.useEffect)((function(){var e=p.current,a=e.getContext("2d");a.setTransform(1,0,0,1,0,0),a.font=cn,a.clearRect(0,0,e.width,e.height),a.scale(window.devicePixelRatio,window.devicePixelRatio),cs(a,c,s,r,o,i,n,d,h,t,u,l,!0)})),Object(V.jsx)("canvas",{ref:p,onMouseOut:function(t){return e.onTooltip(null)},onMouseMove:function(t){return e.onTooltip(i[n][o])},width:l.violinWidth*window.devicePixelRatio,height:(c.y+l.violinHeight)*window.devicePixelRatio,style:{width:l.violinWidth,height:c.y+l.violinHeight}})}function cs(e,t,n,a,i,r,o,s,l,c,u,d,h){var p=d.violinScale,f=d.violinHeight,v=d.violinWidth,b=d.violinShowBoxplot;e.save(),e.strokeStyle=u;var m=e.lineCap,g=e.lineJoin,j=r[o][i];"width"===p&&(l=Object(_.a)().domain([-j.density.max,j.density.max]).range([4,v-4])),e.lineCap="round",e.lineJoin="round";var O=j.density;e.beginPath(),e.moveTo(l(O.y[0]),s(O.x[0]));for(var x=1,y=O.x.length;x<y;x++)e.lineTo(l(-O.y[x]),s(O.x[x]));for(var S=O.x.length-2;S>0;S--)e.lineTo(l(O.y[S]),s(O.x[S]));e.stroke();if(e.lineCap=m,e.lineJoin=g,b&&(e.strokeRect(v/2-3,s(j.boxplotStats.q3),6,s(j.boxplotStats.q1)-s(j.boxplotStats.q3)),e.beginPath(),e.moveTo(v/2-3,s(j.boxplotStats.median)),e.lineTo(v/2-3+6,s(j.boxplotStats.median)),e.stroke(),e.beginPath(),e.moveTo(v/2,s(j.boxplotStats.upperAdjacentValue)),e.lineTo(v/2,s(j.boxplotStats.q3)),e.stroke(),e.beginPath(),e.moveTo(v/2,s(j.boxplotStats.q1)),e.lineTo(v/2,s(j.boxplotStats.lowerAdjacentValue)),e.stroke()),e.restore(),h){e.textBaseline="middle",e.textAlign="left";for(var w=f+t.y-1,C=j.name,k=v/2,E=0;E<C.length;E++){var z=0===E?0:t.endCoordinates[E-1],T=c[E],P=j.categories[E];e.fillStyle=T(P),e.beginPath(),e.rect(k-Ho+4,w-Ho-z,Ho,Ho),e.fill(),e.stroke(),e.save(),e.fillStyle=u,e.translate(k,w-z-Ho-2),e.rotate(-Math.PI/2),e.fillText(C[E],0,0),e.restore()}}}function us(e,t,n){for(var a,i=n.violinScale,r=n.violinHeight,o=n.violinWidth,s=Number.MAX_VALUE,l=-Number.MAX_VALUE,c=-Number.MAX_VALUE,u=e.map((function(e){return e[0].name})),d=0;d<u.length;d++){var h=e[d][t];s=Math.min(s,h.density.x[0]),l=Math.max(l,h.density.x[h.density.x.length-1]),c=Math.max(c,h.density.max)}return"area"===i&&(a=Object(_.a)().domain([-c,c]).range([4,o-4])),{xscale:Object(_.a)().domain([s,l]).range([r-1,6]).nice(),yscale:a}}function ds(e,t,n,a,i,r,o,s,l,c,u){var d=a[0].map((function(e){return e.feature})).indexOf(n),h=a.map((function(e){return e[0].name}));os(e,c,l,t),e.translate(t.x,0);for(var p=0;p<h.length;p++)e.save(),e.translate(p*r.violinWidth,0),cs(e,t,0,0,d,a,p,c,u,s,l,r,o),e.restore()}function hs(e){var t=e.data,n=e.feature,a=e.textColor,i=e.size,r=e.options,o=e.onTooltip,s=e.categoryColorScales,l=t[0].map((function(e){return e.feature})),c=t.map((function(e){return e[0].name})),u=l.indexOf(n),d=us(t,u,r),h=d.xscale,p=d.yscale;return Object(V.jsxs)(Vi.a,{borderColor:"text.primary",border:1,style:{display:"inline-block",margin:2},children:[Object(V.jsx)(M.a,{color:"textPrimary",component:"h4",style:{marginTop:"3.2px"},children:n}),Object(V.jsx)(ss,{xscale:h,textColor:a,violinHeight:r.violinHeight,size:i}),c.map((function(e,l){return Object(V.jsx)(ls,{options:r,categoryIndex:l,data:t,feature:n,featureIndex:u,names:c,xscale:h,yscale:p,textColor:a,onTooltip:o,categoryColorScales:s,size:i},e)}))]})}var ps=function(e){Object(O.a)(n,e);var t=Object(x.a)(n);function n(e){var a;return Object(j.a)(this,n),(a=t.call(this,e)).handleSaveImageMenu=function(e){a.setState({saveImageEl:e.currentTarget})},a.handleSaveImageMenuClose=function(e){a.setState({saveImageEl:null})},a.handleSaveImage=function(e){var t,n;a.setState({saveImageEl:null}),"svg"===e?(t=new window.C2S(10,10)).font=un:(t=(n=document.createElement("canvas")).getContext("2d")).font=cn;var i=a.getSize(t),r=i.totalHeight+i.y+15+20,o=Math.max(200,i.width+i.x);"svg"===e?(t=new window.C2S(o,r)).font=un:(n.width=o*window.devicePixelRatio,n.height=r*window.devicePixelRatio,(t=n.getContext("2d")).scale(window.devicePixelRatio,window.devicePixelRatio),t.font=cn);if(t.fillStyle="white",t.fillRect(0,0,o,r),a.drawContext(t,i),"svg"===e){var s=t.getSerializedSvg(),l=new Blob([s],{type:"text/plain;charset=utf-8"});window.saveAs(l,a.props.data[0][0].dimension+".svg")}else n.toBlob((function(e){window.saveAs(e,a.props.data[0][0].dimension+".png",!0)}))},a.onTooltip=function(e){if(e){var t=e.boxplotStats.median,n="mean: "+he(Tt(e.mean))+", median: "+he(Tt(t))+", % expressed: "+he(Tt(e.percentExpressed))+", # cells: "+Pt(e.n)+", "+e.name.join(", ");a.props.setTooltip(n)}else a.props.setTooltip("")},a.canvas=null,a.state={saveImageEl:null},a}return Object(C.a)(n,[{key:"drawContext",value:function(e,t){for(var n=this.props,a=n.categoryColorScales,i=(n.colorScale,n.data),r=n.options,o=n.textColor,s=r.violinHeight,l=r.violinWidth,c=i[0].map((function(e){return e.feature})),u=i.map((function(e){return e[0].name})),d=0;d<c.length;d++){e.save(),e.translate(0,s*d);var h=us(i,d,r),p=h.xscale,f=h.yscale;ds(e,t,c[d],i,0,r,d===c.length-1,a,o,p,f),e.textBaseline="top",e.textAlign="middle",e.fillStyle=o,e.fillText(c[d],l*u.length/2,0),e.restore()}e.setTransform(1,0,0,1,0,0)}},{key:"getSize",value:function(e){var t=this.props,n=t.data,a=t.options,i=a.violinHeight,r=a.violinWidth,o=n.map((function(e){return e[0].name})),s=n[0].map((function(e){return e.feature})),l=Wo(n,e),c=s.length*i+4,u=o.length*r+4;return{x:30,endCoordinates:l.endCoordinates,y:l.sum,width:u,totalHeight:c}}},{key:"render",value:function(){var e=this,t=this.state.saveImageEl,n=this.props,a=n.categoryColorScales,i=n.colorScale,r=n.data,o=n.options,s=n.textColor,l=r[0].map((function(e){return e.feature})),c=r[0][0].dimension,u=document.createElement("canvas").getContext("2d");u.font=cn;var d=this.getSize(u);return Object(V.jsxs)("div",{style:{position:"relative"},children:[Object(V.jsxs)("div",{children:[Object(V.jsxs)(M.a,{style:{display:"inline-block"},component:"h4",color:"textPrimary",children:[c,this.props.subtitle&&Object(V.jsxs)("small",{children:["(",this.props.subtitle,")"]})]}),Object(V.jsx)(qe.a,{title:"Save Image",children:Object(V.jsx)(Ze.a,{"aria-controls":"save-image-menu","aria-haspopup":"true",edge:!1,size:"small","aria-label":"Save Image",onClick:this.handleSaveImageMenu,children:Object(V.jsx)(ht.a,{})})}),Object(V.jsxs)(Ye.a,{id:"save-image-menu",anchorEl:t,keepMounted:!0,open:Boolean(t),onClose:this.handleSaveImageMenuClose,children:[Object(V.jsx)(Qe.a,{onClick:function(t){return e.handleSaveImage("png")},children:"PNG"}),Object(V.jsx)(Qe.a,{onClick:function(t){return e.handleSaveImage("svg")},children:"SVG"})]})]}),l.map((function(t){return Object(V.jsx)(hs,{onTooltip:e.onTooltip,feature:t,data:r,categoryColorScales:a,options:o,size:d,textColor:s,colorScale:i},t)}))]})}}]),n}(i.a.PureComponent),fs=n(389);function vs(e,t){var n=[];e[0].dimensions.forEach((function(e){n.push(t[e]||{})})),e.forEach((function(e){var t=[];n.forEach((function(a,i){var r=n[i],o=e.categories[i];o=le(r,o),t[i]=o,e.name=t}))}))}function bs(e,t,n){var a={};e.forEach((function(e){var t=a[e.name];null==t&&(t=[],a[e.name]=t),t.push(e)}));var i=Object.keys(a);if(i.length>=2e3)return null;var r=e[0].dimension;if(t.sortBy!==r){var o={},s={};e.forEach((function(e){e.feature===t.sortBy&&(o[e.name]=e.mean,s[e.name]=e.percentExpressed)})),i.sort((function(e,t){var n=o[e],a=o[t],i=n===a?0:n>a?-1:1;return 0===i&&(i=(n=s[e])===(a=s[t])?0:n>a?-1:1),i}))}else{var l=e[0].dimensions.map((function(e){if(n[e]){for(var t=n[e],a=new Map,i=0;i<t.length;i++)a.set(t[i],i);return function(e,t){return a.get(e)-a.get(t)}}return W})),c=l.length,u=i.map((function(e){return a[e][0]}));u.sort((function(e,t){for(var n=0;n<c;n++){var a=l[n](e.categories[n],t.categories[n]);if(0!==a)return a}return 0})),i=u.map((function(e){return e.name}))}for(var d=[],h=0;h<i.length;h++){var p=i[h],f=a[p];d.push(f)}return d}function ms(e){var t=[Number.MAX_VALUE,-Number.MAX_VALUE];return e.forEach((function(e){t[0]=Math.min(e.mean,t[0]),t[1]=Math.max(e.mean,t[1])})),{mean:t,percent:[0,100]}}var gs=function(e){Object(O.a)(n,e);var t=Object(x.a)(n);function n(e){var a;return Object(j.a)(this,n),(a=t.call(this,e)).onChartTypeChange=function(e){a.props.onDistributionPlotOptions({chartType:e.target.value})},a.onViolinScaleChange=function(e){a.props.onDistributionPlotOptions({violinScale:e.target.value})},a.onViolinShowBoxplot=function(e){a.props.onDistributionPlotOptions({violinShowBoxplot:e.target.checked})},a.onSortOrderChanged=function(e){a.props.onDistributionPlotOptions({sortBy:e.target.value})},a.onMinUIChange=function(e){a.setState({min:e})},a.onMaxUIChange=function(e){a.setState({max:e})},a.onMinChange=function(e){a.props.onDistributionPlotOptions({min:e})},a.onMaxChange=function(e){a.props.onDistributionPlotOptions({max:e})},a.state={min:"",max:""},a}return Object(C.a)(n,[{key:"render",value:function(){var e=this,t=this.props,n=t.textColor,a=t.categoryColorScales,i=t.dataset,r=t.distributionData,o=t.distributionPlotOptions,s=t.categoricalNames,l=t.selectedData,c=t.interpolator,u=t.setTooltip;if(null==r||0===r.length)return null;var d=o.chartType,h=ms(r),p=c.scale!==se?[0,1]:h.mean,f=h.percent;if(null!=l&&l.length>0){var v=ms(l);p[0]=Math.min(p[0],v.mean[0]),p[1]=Math.max(p[1],v.mean[1]),f[0]=Math.min(f[0],v.percent[0]),f[1]=Math.max(f[1],v.percent[1])}if(null==o.min||isNaN(o.min)||(p[0]=o.min),null==o.max||isNaN(o.max)||(p[1]=o.max),null==o.minSize||isNaN(o.minSize)||(f[0]=o.minSize),null==o.maxSize||isNaN(o.maxSize)||(f[1]=o.maxSize),null==o.sortBy&&(o.sortBy=r[0].dimension),o.sortBy!==r[0].dimension){for(var b=!1,m=0;m<r.length;m++)if(r[m].feature===o.sortBy){b=!0;break}b||(o.sortBy=r[0].dimension)}var g=Ce(c).domain(p),j=Object(_.a)().domain(f).range([1,9]).clamp(!0);vs(r,s),l&&vs(l,s);var O=bs(r,o,i.categoryOrder||{}),x=l&&l.length>0?bs(l,o,i.categoryOrder||{}):null;if((null==O||0===O.length)&&(null==x||0===x.length))return null;var y=(O?O[0]:x[0]).map((function(e){return e.feature}));if("violin"===d){var S=l?r.concat(l):r;y.forEach((function(e){S.forEach((function(t){if(t.feature===e&&null==t.density){for(var n=t.vector,a=new Float32Array(n.size()),i=0,r=a.length;i<r;i++)a[i]=n.get(i);t.boxplotStats=function(e){e=e.slice().sort((function(e,t){return e-t}));for(var t=Object($o.a)(e,.75),n=Object($o.a)(e,.25),a=Object($o.a)(e,.5),i=-Number.MAX_VALUE,r=Number.MAX_VALUE,o=t+1.5*(t-n),s=n-1.5*(t-n),l=0,c=0,u=e.length;c<u;c++){var d=e[c];d<=o&&(i=Math.max(i,d)),d>=s&&(r=Math.min(r,d)),l+=d}var h=l/e.length;return r>n&&(r=n),i<t&&(i=t),{mean:h,upperAdjacentValue:i,lowerAdjacentValue:r,median:a,q3:t,q1:n,variance:es(e,h),n:e.length,x0:e[0]}}(a);var o=function(e){var t,n=Math.sqrt(e.variance),a=e.q3-e.q1;return(t=Math.min(n,a/1.34))||(t=n)||(t=Math.abs(e.x0))||(t=1),.9*t*Math.pow(e.n,-.2)}(t.boxplotStats);t.bandwidth=o,t.density=function(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:200,a=Number.MAX_VALUE,i=-Number.MAX_VALUE,r=0,o=e.length;r<o;r++){var s=e[r];a=Math.min(a,s),i=Math.max(i,s)}for(var l=(i-a)/(n-1),c=new Float32Array(n),u=new Float32Array(n),d=0,h=ns(t,ts,e),p=0,f=a;p<n;p++,f+=l){var v=h(f);c[p]=f,u[p]=v,d=Math.max(d,v)}return{x:c,y:u,max:d}}(a,o)}}))}))}var w=[r[0].dimension].concat(y);return Object(V.jsxs)(Vi.a,{color:"text.primary",children:["violin"!==d&&O&&Object(V.jsx)(Go,{categoryColorScales:a,colorScale:g,interpolator:c,sizeScale:j,textColor:n,drawCircles:"dotplot"===d,setTooltip:u,data:O}),"violin"===d&&O&&Object(V.jsx)(ps,{categoryColorScales:a,colorScale:g,textColor:n,options:o,setTooltip:u,data:O}),"violin"!==d&&x&&Object(V.jsx)(Go,{categoryColorScales:a,colorScale:g,interpolator:c,sizeScale:j,subtitle:"selection",textColor:n,setTooltip:u,drawCircles:"dotplot"===d,data:x}),"violin"===d&&x&&Object(V.jsx)(ps,{categoryColorScales:a,colorScale:g,subtitle:"selection",options:o,textColor:n,setTooltip:u,data:x}),"violin"!==d&&Object(V.jsx)(Yo,{colorScale:g,textColor:n,domain:g.domain(),interpolator:c,onInterpolator:this.props.handleInterpolator,min:this.state.min,max:this.state.max,onMinChange:this.onMinChange,onMaxChange:this.onMaxChange,onMinUIChange:this.onMinUIChange,onMaxUIChange:this.onMaxUIChange}),"violin"!==d&&Object(V.jsxs)(eo.a,{className:this.props.classes.formControl,children:[Object(V.jsx)(Fo.a,{children:"Standardize"}),Object(V.jsxs)(Fr.a,{label:"Standardize",size:"small",onChange:function(t){return e.props.onColorScalingChange(t.target.value)},value:c.scale,children:[Object(V.jsx)(Qe.a,{value:"none",divider:!0,children:"(None)"}),Object(V.jsx)(Qe.a,{title:"Standardize features between 0 and 1",value:re,children:"Feature"}),Object(V.jsx)(Qe.a,{title:"Standardize groups between 0 and 1",value:oe,children:"Category"})]})]}),"dotplot"===d&&Object(V.jsxs)("div",{style:{paddingTop:16},children:[Object(V.jsx)(Fo.a,{shrink:!0,children:"Size"}),Object(V.jsx)(Qo,{sizeScale:j,textColor:n,onOptions:this.props.onDistributionPlotOptions,showReversed:!1})]}),Object(V.jsxs)(eo.a,{className:this.props.classes.formControl,children:[Object(V.jsx)(Fo.a,{shrink:!0,children:"Sort By"}),Object(V.jsx)(Fr.a,{label:"Sort By",size:"small",onChange:this.onSortOrderChanged,value:o.sortBy,children:w.map((function(e){return Object(V.jsx)(Qe.a,{value:e,children:e},e)}))})]}),"violin"===d&&Object(V.jsxs)(eo.a,{className:this.props.classes.formControl,children:[Object(V.jsx)(Fo.a,{id:"violin-scale-label",children:"Scale"}),Object(V.jsxs)(Fr.a,{label:"Scale",size:"small",className:this.props.classes.select,labelId:"violin-scale-label",value:o.violinScale,onChange:this.onViolinScaleChange,children:[Object(V.jsx)(Qe.a,{value:"area",children:"Area"}),Object(V.jsx)(Qe.a,{value:"width",children:"Width"})]}),Object(V.jsx)(fs.a,{children:'If "area", violins have the same area. If "width", violins have the same maximum width.'})]}),"violin"===d&&Object(V.jsx)("div",{children:Object(V.jsx)(Jo.a,{control:Object(V.jsx)(Lo.a,{value:"violinShowBoxplot",checked:o.violinShowBoxplot,onChange:this.onViolinShowBoxplot}),label:"Show Box Plot"})}),Object(V.jsxs)(eo.a,{className:this.props.classes.formControl,children:[Object(V.jsx)(Fo.a,{id:"dist-chart-type-label",children:"Chart Type"}),Object(V.jsxs)(Fr.a,{label:"Chart Type",size:"small",className:this.props.classes.select,labelId:"dist-chart-type-label",value:d,onChange:this.onChartTypeChange,children:[this.props.showDotPlotOption&&Object(V.jsx)(Qe.a,{value:"dotplot",children:"Dot Plot"}),Object(V.jsx)(Qe.a,{value:"heatmap",children:"Heatmap"}),Object(V.jsx)(Qe.a,{value:"violin",children:"Violin"})]})]})]})}}]),n}(i.a.PureComponent),js=Object(P.a)((function(e){return{formControl:{display:"block",margin:e.spacing(1)}}}))(gs);var Os=Object(o.b)((function(e){return{cachedData:e.cachedData,categoricalNames:e.categoricalNames,chartOptions:e.chartOptions,dataset:e.dataset,distributionData:e.distributionData,distributionPlotOptions:e.distributionPlotOptions,distributionPlotInterpolator:e.distributionPlotInterpolator,embeddingData:e.embeddingData,globalFeatureSummary:e.globalFeatureSummary,selectedDistributionData:e.selectedDistributionData}}),(function(e){return{onDistributionPlotOptions:function(t){e(Va(t))},onInterpolator:function(t){e({type:An,payload:t})}}}))((function(e){function t(t,n){var a=e.distributionPlotInterpolator[t];n.scale=a.scale,e.distributionPlotInterpolator[t]=n,e.onInterpolator(Object.assign({},e.distributionPlotInterpolator))}function n(t,n){e.distributionPlotInterpolator[t].scale=n,e.onInterpolator(Object.assign({},e.distributionPlotInterpolator))}function a(t,n){e.distributionPlotOptions[t]=Object.assign({},e.distributionPlotOptions[t],n),b(Object.assign({},e.distributionPlotOptions))}var i=e.cachedData,r=e.categoricalNames,o=e.chartOptions,s=e.dataset,l=e.distributionData,c=e.distributionPlotOptions,h=e.distributionPlotInterpolator,p=e.embeddingData,v=e.globalFeatureSummary,b=e.onDistributionPlotOptions,m=e.selectedDistributionData,g=e.setTooltip,j=o.darkMode?"white":"black",O=Object.keys(l),x={X:{order:0,name:"Features"},modules:{order:1,name:"Modules"},obs:{order:2,name:"Observations"}};return O.sort((function(e,t){return x[e].order-x[t].order})),O.map((function(e){var o=x[e].name,b=Object(f.groupBy)(l[e],"dimension"),O=Object(f.groupBy)(m[e],"dimension");return Object(V.jsxs)("div",{children:[Object(V.jsx)(M.a,{color:"textPrimary",variant:"h5",children:o}),Object.keys(b).map((function(o){var l=b[o],m=[];return l[0].dimensions.forEach((function(e){for(var t=!1,n=0;n<p.length;n++)if(e===p[n].name){m.push(p[n].colorScale),t=!0;break}t||m.push(Object(u.a)(d.a))})),Object(V.jsx)(js,{cachedData:i,setTooltip:g,showDotPlotOption:"X"===e,categoryColorScales:m,dataset:s,distributionData:l,globalFeatureSummary:v,selectedData:O[o],interpolator:h[e],distributionPlotOptions:c[e],categoricalNames:r,textColor:j,handleInterpolator:Object(f.partial)(t,e),onColorScalingChange:Object(f.partial)(n,e),onDistributionPlotOptions:Object(f.partial)(a,e)},o)}))]},e)}))}));var xs=Object(o.b)((function(e){return{activeFeature:e.activeFeature,primaryChartSize:e.primaryChartSize}}),(function(e){return{handlePrimaryChartSize:function(t){e(Ga(t))}}}))((function(e){var t=Object(a.useRef)(!1),n=Object(a.useRef)(-1),i=Object(a.useRef)(-1);function r(e){t.current&&(window.removeEventListener("mousemove",o),window.removeEventListener("mouseup",r),document.body.style.cursor=null),t.current=!1}function o(a){if(t.current){var r=e.primaryChartSize,o=n.current-a.clientY;e.handlePrimaryChartSize({width:r.width,height:Math.max(50,i.current-o)})}}var s=e.activeFeature;return Object(V.jsx)("div",{style:{height:10,cursor:"ns-resize",display:s?"flex":"none",alignItems:"center",justifyContent:"center"},onMouseDown:function(a){t.current=!0,n.current=a.clientY,i.current=e.primaryChartSize.height,document.body.style.cursor="ns-resize",window.addEventListener("mousemove",o),window.addEventListener("mouseup",r)},children:Object(V.jsx)(yr.a,{style:{width:"100%"}})})})),ys=n(222),Ss=n.n(ys),ws=n(143),Cs=n.n(ws),ks=["Homo sapiens","Mus musculus"],Es=["Gallus gallus","Macaca fascicularis","Macaca mulatta","Rattus norvegicus"];var zs=function(e){Object(O.a)(n,e);var t=Object(x.a)(n);function n(e){var a;return Object(j.a)(this,n),(a=t.call(this,e)).initDragDrop=function(){if(!a.init){var e=a.fileDropRef.current;a.init=!0,e.addEventListener("dragover",(function(e){a.showDragIndicator(e,!0)})),e.addEventListener("dragenter",(function(e){a.showDragIndicator(e,!0)})),e.addEventListener("dragend",(function(e){a.showDragIndicator(e,!1)})),e.addEventListener("dragleave",(function(e){a.showDragIndicator(e,!1)})),e.addEventListener("drop",(function(e){a.showDragIndicator(e,!1);var t=e.dataTransfer.files;1===t.length&&a.setState({file:t[0]})}))}},a.handleClose=function(){a.props.handleCancel()},a.handleSave=function(){var e=a.state.name.trim();if(""!==e){var t=null,n=null;null==a.props.dataset&&(1!==a.state.uploadTabValue&&a.props.serverInfo.upload?n=a.state.file:t=a.state.url.trim());var i=a.state.description.trim(),r=a.state.title.trim(),o=a.state.species;a.setState({loading:!0});var s=null;null!=a.state.readers&&(s=function(e){for(var t=e.split(","),n=new Set,a=0;a<t.length;a++){var i=t[a].trim().toLowerCase();""!==i&&n.add(i)}return Array.from(n)}(a.state.readers)),a.props.handleSave({dataset:a.props.dataset,name:e,title:r,description:i,url:t,file:n,species:o,readers:s})}},a.onWritePreviewTabChanged=function(e,t){a.setState({writePreviewTabValue:t})},a.onUploadTabChanged=function(e,t){a.setState({uploadTabValue:t})},a.onEmailChanged=function(e){a.setState({readers:e.target.value})},a.onUrlChanged=function(e){a.setState({url:e.target.value})},a.onFilesChanged=function(){var e=a.fileInputRef.current.files;a.setState({file:e[0]})},a.onSpeciesChange=function(e){a.setState({species:e.target.value})},a.onNameChanged=function(e){a.setState({name:e.target.value})},a.onDescriptionChanged=function(e){a.setState({description:e.target.value})},a.onTitleChanged=function(e){a.setState({title:e.target.value})},a.init=!1,a.fileInputRef=i.a.createRef(),a.fileDropRef=i.a.createRef(),a.dragIndicator=i.a.createRef(),a.state={url:"",writePreviewTabValue:"Write",uploadTabValue:"URL",species:null!=a.props.dataset?a.props.dataset.species:"",name:null!=a.props.dataset?a.props.dataset.name:"",title:null!=a.props.title&&null!=a.props.dataset.title?a.props.dataset.title:"",description:null!=a.props.dataset&&null!=a.props.dataset.description?a.props.dataset.description:"",readers:"",loading:null!=a.props.dataset},a}return Object(C.a)(n,[{key:"showDragIndicator",value:function(e,t){e.stopPropagation(),e.preventDefault(),this.dragIndicator.current.style.background=t?"#1976d2":""}},{key:"componentDidMount",value:function(){if(null!=this.props.dataset){var e=this.props.dataset.readers;if(e){var t=e.indexOf(this.props.email);-1!==t&&e.splice(t,1),e=e.join(", ")}this.setState({file:null,species:null!=this.props.dataset.species?this.props.dataset.species:"",name:this.props.dataset.name,description:null!=this.props.dataset.description?this.props.dataset.description:"",title:null!=this.props.dataset.title?this.props.dataset.title:"",loading:!1,url:this.props.dataset.url,readers:e})}}},{key:"render",value:function(){var e=this,t=this.props.serverInfo.upload,n=null==this.props.dataset,a=!this.state.loading&&""!==this.state.name.trim(),i=""!==this.props.serverInfo.clientId;if(n)if(1!==this.state.uploadTabValue&&this.props.serverInfo.upload)a=a&&null!=this.state.file;else{var r=this.state.url.trim();a=a&&""!==r}return Object(V.jsxs)(br.a,{open:!0,ref:this.fileDropRef,onClose:this.handleClose,"aria-labelledby":"edit-dataset-dialog-title",fullWidth:!0,maxWidth:"lg",TransitionProps:{onEntered:function(t){return e.initDragDrop()}},children:[Object(V.jsxs)(mr.a,{id:"edit-dataset-dialog-title",children:[n?"New":"Edit"," Dataset"]}),Object(V.jsx)(Jr.a,{children:Object(V.jsxs)(Vi.a,{children:[this.state.loading&&Object(V.jsx)(vr.a,{}),Object(V.jsx)(qr.a,{size:"small",disabled:this.state.loading,autoComplete:"off",required:!0,value:this.state.name,onChange:this.onNameChanged,margin:"dense",label:"Name",fullWidth:!0}),Object(V.jsxs)("div",{style:{display:n&&t?"":"none"},children:[Object(V.jsx)(eo.a,{className:this.props.classes.formControl,children:Object(V.jsx)(Fo.a,{shrink:!0,required:!0,children:"Source"})}),Object(V.jsxs)(no.a,{value:this.state.uploadTabValue,onChange:this.onUploadTabChanged,"aria-label":"upload",children:[Object(V.jsx)(kr.a,{value:"My Computer",label:"My Computer",icon:Object(V.jsx)(Ss.a,{})}),Object(V.jsx)(kr.a,{value:"URL",label:"URL",icon:Object(V.jsx)(Cs.a,{})})]}),Object(V.jsxs)("div",{role:"tabpanel",hidden:"My Computer"!==this.state.uploadTabValue,children:[Object(V.jsxs)("div",{ref:this.dragIndicator,children:[Object(V.jsx)(wr.a,{size:"small",variant:"outlined",disabled:this.state.loading,onClick:function(t){return e.fileInputRef.current.click()},children:"Select File"}),Object(V.jsx)(M.a,{style:{display:"inline-block",paddingLeft:"1em"},component:"h3",children:"or Drag And Drop"}),Object(V.jsx)("input",{hidden:!0,ref:this.fileInputRef,type:"file",onChange:this.onFilesChanged}),Object(V.jsx)(M.a,{style:{display:"block"},color:"textPrimary",variant:"caption",children:this.state.file?this.state.file.name:""})]}),Object(V.jsx)(yr.a,{style:{marginTop:"1em",marginBottom:"1em"}})]}),Object(V.jsx)("div",{role:"tabpanel",hidden:"URL"!==this.state.uploadTabValue,children:Object(V.jsx)(qr.a,{size:"small",required:!0,disabled:this.state.loading,autoComplete:"off",value:this.state.url,onChange:this.onUrlChanged,margin:"dense",helperText:this.props.serverInfo.email?"Please ensure that "+this.props.serverInfo.email+" has read permission to this URL":"",label:"URL",fullWidth:!0})})]}),Object(V.jsx)(qr.a,{size:"small",style:{display:n&&t?"none":""},required:!0,disabled:this.state.loading||!n,autoComplete:"off",value:this.state.url,onChange:this.onUrlChanged,margin:"dense",helperText:this.props.serverInfo.email?"Please ensure that "+this.props.serverInfo.email+" has read permission to this URL":"",label:"URL",fullWidth:!0}),Object(V.jsxs)(eo.a,{className:this.props.classes.formControl,children:[Object(V.jsx)(Fo.a,{id:"species-label",children:"Species"}),Object(V.jsxs)(Fr.a,{label:"Species",size:"small",labelId:"species-label",value:this.state.species,onChange:this.onSpeciesChange,children:[ks.map((function(e){return Object(V.jsx)(Qe.a,{value:e,children:e},e)})),Object(V.jsx)(Qe.a,{divider:!0}),Es.map((function(e){return Object(V.jsx)(Qe.a,{value:e,children:e},e)}))]})]}),Object(V.jsx)(qr.a,{size:"small",disabled:this.state.loading,autoComplete:"off",required:!1,value:this.state.title,onChange:this.onTitleChanged,margin:"dense",label:"Title",fullWidth:!0,inputProps:{maxLength:255}}),Object(V.jsxs)(eo.a,{className:this.props.classes.formControl,children:[Object(V.jsx)(Fo.a,{shrink:!0,children:"Summary"}),Object(V.jsx)(fs.a,{style:{marginTop:14},children:Object(V.jsx)(T.a,{href:"https://www.markdownguide.org/cheat-sheet/",target:"_blank",children:"Markdown Cheat Sheet"})})]}),Object(V.jsxs)(no.a,{value:this.state.writePreviewTabValue,onChange:this.onWritePreviewTabChanged,"aria-label":"description-editor",children:[Object(V.jsx)(kr.a,{value:"Write",label:"Write"}),Object(V.jsx)(kr.a,{value:"Preview",label:"Preview"})]}),Object(V.jsx)("div",{role:"tabpanel",hidden:"Write"!==this.state.writePreviewTabValue,children:Object(V.jsx)(qr.a,{size:"small",disabled:this.state.loading,autoComplete:"off",required:!1,value:this.state.description,onChange:this.onDescriptionChanged,margin:"dense",fullWidth:!0,variant:"outlined",rows:8,maxRows:8,multiline:!0,inputProps:{maxLength:1e3}})}),Object(V.jsx)("div",{role:"tabpanel",hidden:"Preview"!==this.state.writePreviewTabValue,children:""!==this.state.description&&Object(V.jsx)(Vi.a,{border:1,children:Object(V.jsx)(Rr.a,{options:{overrides:ce},children:this.state.description})})}),Object(V.jsx)(qr.a,{size:"small",value:this.state.readers,onChange:this.onEmailChanged,margin:"dense",label:"Readers",helperText:i?"Enter comma separated list of emails":"Enable authentication to permit sharing",disabled:this.state.loading||!i,fullWidth:!0,multiline:!0})]})}),Object(V.jsxs)(_o.a,{children:[Object(V.jsx)(wr.a,{disabled:this.state.loading,onClick:this.handleClose,children:"Cancel"}),Object(V.jsx)(wr.a,{disabled:!a,onClick:this.handleSave,variant:"contained",color:"primary",children:"Save"})]})]})}}]),n}(i.a.PureComponent),Ts=Object(P.a)((function(e){return{formControl:{minWidth:200,marginTop:e.spacing(1)},select:{minWidth:200}}}))(Object(o.b)((function(e){return{dataset:e.dialog===fa?e.dataset:null,email:e.email,serverInfo:e.serverInfo}}),(function(e){return{handleSave:function(t){e(di(t))},handleCancel:function(t){e(vi(null))},handleError:function(t){e(pi(t))}}}))(zs)),Ps=n(368),Ms=n(145),As=n(224),Is=n.n(As),Ds=n(3),_s=n(366),Rs=n(400),Ns=n(30),Fs=n(6),Ls=n(343),Bs=n(24),Us=n(367),Vs=n(111),Hs=n(345),Ws=["children"];function Gs(e){var t=e.data,n=e.index,a=e.style,i=t[n],r=Object(E.a)(Object(E.a)({},a),{},{top:a.top+0});if(i.hasOwnProperty("group"))return r.whiteSpace="nowrap",Object(V.jsx)(Rs.a,{disableGutters:!0,component:"div",style:r,children:i.group},i.key);var o=i[1],s=null!=o.text?o.text:o,l=null!=o.icon?o.icon:null,c=function(e,t){if(""!==(t=t.toLowerCase())){var n=e.toLowerCase().indexOf(t);if(-1!==n){var a=t.length;return[e.substring(0,n),e.substring(n,n+a),e.substring(n+a)]}}}(s,i[2]);return c?Object(V.jsxs)(M.a,Object(E.a)(Object(E.a)({component:"li"},i[0]),{},{title:s,noWrap:!0,style:r,children:[l,c[0],Object(V.jsx)("b",{children:c[1]}),c[2]]})):Object(V.jsxs)(M.a,Object(E.a)(Object(E.a)({component:"li"},i[0]),{},{title:s,noWrap:!0,style:r,children:[l,s]}))}var Js=i.a.createContext({}),Xs=i.a.forwardRef((function(e,t){var n=i.a.useContext(Js);return Object(V.jsx)("div",Object(E.a)(Object(E.a)({ref:t},e),n))}));var qs=i.a.forwardRef((function(e,t){var n=e.children,a=Object(z.a)(e,Ws),r=[];n.forEach((function(e){r.push(e),r.push.apply(r,Object(w.a)(e.children||[]))}));var o=Object(Ns.a)(),s=Object(Ls.a)(o.breakpoints.up("sm"),{noSsr:!0}),l=r.length,c=s?24:36,u=function(e){return e.hasOwnProperty("group")?36:c},d=function(e){var t=i.a.useRef(null);return i.a.useEffect((function(){null!=t.current&&t.current.resetAfterIndex(0,!0)}),[e]),t}(l);return Object(V.jsx)("div",{ref:t,children:Object(V.jsx)(Js.Provider,{value:a,children:Object(V.jsx)(Ms.b,{itemData:r,height:(l>8?8*c:r.map(u).reduce((function(e,t){return e+t}),0))+0,width:"100%",ref:d,outerElementType:Xs,innerElementType:"ul",itemSize:function(e){return u(r[e])},overscanCount:5,itemCount:l,children:Gs})})})})),Ks=Object(Fs.a)(Hs.a)(Object(Ds.a)({},"& .".concat(Bs.a.listbox),{boxSizing:"border-box","& ul":{padding:0,margin:0}}));function Zs(e){var t=i.a.createRef();function n(t,n){var a=e.value;if((n=n.map((function(e){return e.toLowerCase().trim().replace(/"/g,"")})).filter((function(e){return""!==e}))).length>0){for(var i=new Map,r=0;r<e.options.length;r++){var o=e.options[r],s=(null!=o.text?o.text:o).toLowerCase();i.set(s,o)}a.forEach((function(e){var t=null!=e.text?e.text:e;i.delete(t.toLowerCase())})),n.forEach((function(e){var t=i.get(e);null!=t&&(i.delete(e),a.push(t))}))}e.onChange(t,a)}function a(e){t.current.style.background=e?"#1976d2":""}function r(e){e.preventDefault(),e.stopPropagation(),a(!1)}var o=e.onChipClick?function(t,n){e.onChipClick(t,n)}:null,s=e.getOptionSelected;null==s&&(s=e.groupBy?function(e,t){return e.id===t.id&&e.group===t.group}:function(e,t){return e===t});var l=e.getChipText;null==l&&(l=function(e){return e});var c=e.getChipIcon;null==c&&(c=function(e){return null});var u=e.getChipTitle;null==u&&(u=function(e){return null});var d=e.getOptionLabel;null==d&&(d=e.groupBy?function(e){return e.text}:function(e){return e});var h=Object(Vs.b)((function(t){var n=t.option,a=t.sortIndex;return Object(V.jsx)(_s.a,{tabIndex:"-1",style:{zIndex:1e6},onDelete:function(t){return function(t,n){var a=e.value.slice();a.splice(n,1),e.onChange(t,a)}(t,a)},onClick:o?function(e){return o(e,n)}:null,label:l(n),title:u(n),size:"small",icon:c(n)},a)})),p=Object(Vs.a)((function(e){var t=e.items;return Object(V.jsx)("ul",{style:{padding:0,marginTop:0,marginBottom:0,maxWidth:240,overflow:"hidden"},children:t.map((function(e,t){return Object(V.jsx)(h,{option:e,index:t,sortIndex:t},t)}))})})),f=null==e.multiple||e.multiple;return Object(V.jsxs)(V.Fragment,{children:[Object(V.jsx)(Us.a,{"data-testid":e.testId,multiple:f,ref:t,size:"small",disableListWrap:!0,freeSolo:null!=e.freeSolo&&e.freeSolo,blurOnSelect:!0,openOnFocus:!1,autoHighlight:!0,filterOptions:function(e,t){var n=t.inputValue;if(""===(n=n.trim().toLowerCase()))return e;for(var a=n.length,i=[],r=[],o=[],s=0,l=e.length;s<l;s++){var c=e[s],u=d(c).toLowerCase(),h=u.indexOf(n);0===h?u.length===a?i.push(c):r.push(c):-1!==h&&o.push(c)}return i.concat(r).concat(o)},isOptionEqualToValue:s,value:e.value,filterSelectedOptions:!0,getOptionLabel:d,groupBy:e.groupBy,ChipProps:{size:"small"},ListboxComponent:qs,PopperComponent:Ks,options:e.options,onChange:e.onChange,renderTags:function(e,t){return null},renderInput:function(t){return Object(V.jsx)(qr.a,Object(E.a)(Object(E.a)({},t),{},{label:e.label,helperText:e.helperText,fullWidth:!0,margin:"dense"}))},renderGroup:function(e){return e},renderOption:function(e,t,n){return[e,t,n.inputValue]},onPaste:function(e){var t=e.clipboardData.getData("text/plain");null!=t&&t.length>0&&(e.preventDefault(),e.stopPropagation(),n(e,(t=t.trim()).split(/[\n,\t]/)))},onDrop:function(e){e.preventDefault(),e.stopPropagation();var t=e.dataTransfer.files,i=new FileReader;i.onload=function(e){var t=e.target.result.trim();n(e,t.split(/[\n,\t]/))},i.onerror=function(e){alert("Unable to read file.")},i.readAsText(t[0]),a(!1)},onDragOver:function(e){e.dataTransfer.files.length>0&&(e.preventDefault(),e.stopPropagation(),a(!0))},onDragEnd:r,onDragLeave:r}),f&&Object(V.jsx)(p,{distance:2,onSortEnd:function(t){var n=e.value.slice(),a=n[t.newIndex];n[t.newIndex]=n[t.oldIndex],n[t.oldIndex]=a,e.onChange(t,n)},axis:"xy",items:e.value})]})}function Ys(e){var t=Object(a.useRef)(),n=Object(a.useState)(null),i=Object(Xe.a)(n,2),r=i[0],o=i[1],s=Object(a.useState)(""),l=Object(Xe.a)(s,2),c=l[0],u=l[1],d=Object(a.useState)([]),h=Object(Xe.a)(d,2),p=h[0],v=h[1],b=Object(a.useState)([]),m=Object(Xe.a)(b,2),g=m[0],j=m[1],O=Object(a.useState)(null),x=Object(Xe.a)(O,2),y=x[0],S=x[1],w=Object(a.useState)(null),C=Object(Xe.a)(w,2),k=C[0],E=C[1],z=Object(a.useState)(null),P=Object(Xe.a)(z,2),M=P[0],A=P[1],I=e.categoricalNames,D=e.datasetFilter,_=e.features,R=e.featureSummary,N=e.globalFeatureSummary,F=e.handleScrollPosition,L=e.height,B=e.name,U=e.scale,H=e.legendScrollPosition,W=e.serverInfo,G=e.visible;function J(e){S(null)}function X(t,n){t.preventDefault(),e.handleClick({name:e.name,value:n,shiftKey:t.shiftKey,metaKey:t.ctrlKey||t.metaKey})}function q(t,n){t.preventDefault(),t.stopPropagation(),o({mouseX:t.clientX-2,mouseY:t.clientY-4});var a=ne[n];null==a&&(a={}),null!=W.ontology?u(null!=a.newValue?{text:a.newValue}:null):u(null!=a.newValue?a.newValue:n),j(null!=a.negativeMarkers?a.negativeMarkers:[]),v(null!=a.positiveMarkers?a.positiveMarkers:[]),A(n),E(e.scale(n))}Object(a.useEffect)((function(){var e=H[B];return null!=e&&(console.log("scrollTo"),t.current.scrollTo(e)),function(){t.current&&F({name:B,value:t.current.state.scrollOffset})}}),[B]),Object(a.useEffect)((function(){}),[B]);var K=D[B],Z=R[B],Y={};if(null!=Z)for(var $=0;$<Z.counts.length;$++)Y[Z.categories[$]]=Z.counts[$];var ee=N[B],te=ee.categories.slice(0),ne=I[B]||{};function ae(t,n){e.handleSearchTokens(n,Q,!1,!1)}return G?Object(V.jsxs)(V.Fragment,{children:[Object(V.jsx)("div",{"data-testid":"categorical-legend",children:Object(V.jsx)(Ms.a,{height:L,width:250,itemSize:40,itemCount:te.length,ref:t,onScroll:function(e){"forward"===e.scrollDirection&&0===e.scrollOffset||F({name:B,value:e.scrollOffset})},children:function(e){var t=e.index,n=e.style,a=te[t],i=ee.categories.indexOf(a),r=null!=K&&-1!==K.value.indexOf(a),o=le(ne,a);return Object(V.jsxs)(Ps.a,{disableGutters:!0,divider:!0,dense:!0,onContextMenu:function(e){return q(e,a)},onClick:function(e){return X(e,a)},selected:r,button:!0,style:n,children:[Object(V.jsx)("div",{style:{marginBottom:15,marginRight:2,display:"inline-block",width:12,height:12,background:U(a)}}),Object(V.jsx)(Br.a,{title:o,primaryTypographyProps:{noWrap:!0},primary:o,secondary:(null==Z?"":Pt(Y[a]||0)+" / ")+Pt(ee.counts[i])}),Object(V.jsx)(Ze.a,{onClick:function(e){return q(e,a)},"aria-label":"menu",size:"large",children:Object(V.jsx)(Is.a,{})})]},t)}})}),Object(V.jsxs)(br.a,{open:Boolean(y),onClose:J,"aria-labelledby":"edit-category-dialog-title",fullWidth:!0,children:["color"==y&&Object(V.jsxs)(V.Fragment,{children:[Object(V.jsxs)(mr.a,{id:"edit-category-dialog-title",children:["Edit ",null!=ne[M]?ne[M].newValue:M," Color"]}),Object(V.jsx)(Jr.a,{children:Object(V.jsx)("input",{type:"color",value:k,onChange:function(e){E(e.target.value)},style:{width:100}})}),Object(V.jsxs)(_o.a,{children:[Object(V.jsx)(wr.a,{onClick:J,color:"primary",children:"Close"}),Object(V.jsx)(wr.a,{onClick:function(t){e.handleColorChange({name:e.name,originalValue:M,color:k})},color:"primary",children:"Apply"})]})]}),"name"==y&&Object(V.jsxs)(V.Fragment,{children:[Object(V.jsxs)(mr.a,{id:"edit-category-dialog-title",children:["Annotate ",null!=ne[M]?ne[M].newValue:M]}),Object(V.jsxs)(Jr.a,{children:[null==W.ontology&&Object(V.jsx)(qr.a,{size:"small",inputProps:{maxLength:1e3},fullWidth:!0,type:"text",required:!1,autoComplete:"off",value:c,onChange:function(e){u(e.target.value)},margin:"dense",label:"Category Name",helperText:"Enter cell type or other annotation"}),null!=W.ontology&&Object(V.jsx)(eo.a,{sx:{display:"block"},children:Object(V.jsx)(Zs,{textFieldSx:{width:"90%"},label:"Cell Type",multiple:!1,getOptionLabel:function(e){return e.text},getChipText:function(e){return e.text},options:W.ontology.cellTypes,value:c,getOptionSelected:function(e,t){return e.text===t},onChange:function(e,t){u(t)}})}),Object(V.jsxs)(eo.a,{sx:{display:"block"},children:[Object(V.jsx)(Zs,{textFieldSx:{width:"90%"},label:"Positive Genes/Features",options:_,value:p,onChange:function(e,t){v(t)}}),Object(V.jsx)("div",{children:Object(V.jsx)(T.a,{style:{float:"right",marginRight:4,fontSize:"0.75rem",transform:"translateY(-20px)",display:0===p.length?"none":""},onClick:function(e){return ae(0,p)},children:"View All"})})]}),Object(V.jsxs)(eo.a,{sx:{display:"block"},children:[Object(V.jsx)(Zs,{label:"Negative Genes/Features",options:_,value:g,onChange:function(e,t){j(t)}}),Object(V.jsx)("div",{children:Object(V.jsx)(T.a,{style:{float:"right",marginRight:4,fontSize:"0.75rem",transform:"translateY(-20px)",display:0===g.length?"none":""},onClick:function(e){return ae(0,g)},children:"View All"})})]})]}),Object(V.jsxs)(_o.a,{children:[Object(V.jsx)(wr.a,{onClick:J,color:"primary",children:"Cancel"}),Object(V.jsx)(wr.a,{onClick:function(t){var n=Object(f.isString)(c)?c.trim():c.text;e.handleNameChange({name:e.name,originalValue:M,newValue:""===n?null:n,positiveMarkers:p,negativeMarkers:g}),S(null)},color:"primary",children:"OK"})]})]})]}),Object(V.jsxs)(Ye.a,{anchorReference:"anchorPosition",anchorPosition:null!=r?{top:r.mouseY,left:r.mouseX}:void 0,open:Boolean(r),onClose:function(e){o(null)},children:[Object(V.jsx)(Qe.a,{onClick:function(e){o(null),S("name")},children:"Annotate"}),Object(V.jsx)(Qe.a,{onClick:function(e){o(null),S("color")},children:"Edit Color"})]})]}):null}var Qs=function(e){Object(O.a)(n,e);var t=Object(x.a)(n);function n(){return Object(j.a)(this,n),t.apply(this,arguments)}return Object(C.a)(n,[{key:"getTable",value:function(e,t,n){return Object(V.jsxs)("table",{children:[Object(V.jsx)("thead",{children:Object(V.jsxs)("tr",{children:[Object(V.jsx)("td",{}),e.map((function(e){return Object(V.jsx)("td",{children:Object(V.jsx)("small",{children:e})},e)}))]})}),Object(V.jsxs)("tbody",{children:[Object(V.jsxs)("tr",{children:[Object(V.jsxs)("td",{style:{textAlign:"right"},children:["Mean",":"]}),Object(V.jsx)("td",{children:he(zt(n.mean))}),t&&Object(V.jsx)("td",{children:he(zt(t.mean))})]}),null!=n.numExpressed&&Object(V.jsxs)("tr",{children:[Object(V.jsxs)("td",{style:{textAlign:"right"},children:["% Expressed",":"]}),Object(V.jsx)("td",{children:Mt(100*n.numExpressed/this.props.nObs)}),t&&Object(V.jsx)("td",{children:Mt(100*t.numExpressed/this.props.nObsSelected)})]}),(null==n.numExpressed||0!==n.min)&&Object(V.jsxs)("tr",{children:[Object(V.jsxs)("td",{style:{textAlign:"right"},children:["Min",":"]}),Object(V.jsx)("td",{children:he(zt(n.min))}),t&&Object(V.jsx)("td",{children:he(zt(t.min))})]}),Object(V.jsxs)("tr",{children:[Object(V.jsxs)("td",{style:{textAlign:"right"},children:["Max",":"]}),Object(V.jsx)("td",{children:he(zt(n.max))}),t&&Object(V.jsx)("td",{children:he(zt(t.max))})]})]})]})}},{key:"render",value:function(){var e=this.props,t=e.name,n=e.featureSummary,a=e.globalFeatureSummary,i=n[t],r=a[t],o=["all"];return null!=i&&o.push("selection"),Object(V.jsx)(V.Fragment,{children:null!=r&&"__count"!==t&&this.getTable(o,i,r)})}}]),n}(i.a.PureComponent),$s=function(e){Object(O.a)(n,e);var t=Object(x.a)(n);function n(e){var a;return Object(j.a)(this,n),(a=t.call(this,e)).handleValueUpdate=function(){var e=a.getFilter(),t=parseFloat(e.uiValue);a.props.handleUpdate({name:a.props.name,value:t,update:!0})},a.handleOperationChanged=function(e){var t=e.target.value;a.props.handleUpdate({name:a.props.name,operation:t,update:!0})},a.handleValueChange=function(e){var t=a.getFilter();t.uiValue=e.target.value,a.props.handleUpdate({name:a.props.name,operation:t.operation,value:t.value,update:!1}),a.handleValueUpdate()},a.handleValueUpdate=Object(f.debounce)(a.handleValueUpdate,500),a}return Object(C.a)(n,[{key:"getFilter",value:function(){var e=this.props.datasetFilter[this.props.name];return null==e&&(e={operation:">",value:NaN,uiValue:""},this.props.datasetFilter[this.props.name]=e),e}},{key:"render",value:function(){var e=this.props.name,t=this.getFilter(),n=e+"_filter";return Object(V.jsxs)("div",{style:{display:"flex"},children:[Object(V.jsx)(Fo.a,{id:n+"_label",children:"Filter"}),Object(V.jsxs)(Fr.a,{label:"Filter",size:"small",labelId:n+"_label",id:n,style:{marginRight:6},value:t.operation,onChange:this.handleOperationChanged,children:[Object(V.jsx)(Qe.a,{value:""}),Object(V.jsx)(Qe.a,{value:">",children:">"}),Object(V.jsx)(Qe.a,{value:"<",children:"<"}),Object(V.jsx)(Qe.a,{value:"=",children:"="}),Object(V.jsx)(Qe.a,{value:">=",children:">="}),Object(V.jsx)(Qe.a,{value:"<=",children:"<="}),Object(V.jsx)(Qe.a,{value:"!=",children:"!="})]}),Object(V.jsx)(qr.a,{size:"small",onChange:this.handleValueChange,value:t.uiValue,style:{maxWidth:60}})]})}}]),n}(i.a.PureComponent),el=function(e){Object(O.a)(n,e);var t=Object(x.a)(n);function n(e){var a;return Object(j.a)(this,n),(a=t.call(this,e)).onMinChange=function(e){a.setState({min:e.target.value}),a.onMinUpdate(parseFloat(e.target.value))},a.onMinUpdate=function(e){isNaN(e)?delete a.props.globalFeatureSummary[a.props.name].customMin:a.props.globalFeatureSummary[a.props.name].customMin=e,a.props.handleDomain({name:a.props.name,summary:a.props.globalFeatureSummary[a.props.name]})},a.onMaxChange=function(e){a.setState({max:e.target.value}),a.onMaxUpdate(parseFloat(e.target.value))},a.onMaxUpdate=function(e){isNaN(e)?delete a.props.globalFeatureSummary[a.props.name].customMax:a.props.globalFeatureSummary[a.props.name].customMax=e,a.props.handleDomain({name:a.props.name,summary:a.props.globalFeatureSummary[a.props.name]})},a.state={min:"",max:""},a.onMinUpdate=Object(f.debounce)(a.onMinUpdate,500),a.onMaxUpdate=Object(f.debounce)(a.onMaxUpdate,500),a}return Object(C.a)(n,[{key:"componentDidUpdate",value:function(e,t,n){e.name!==this.props.name&&this.setState({min:"",max:""})}},{key:"render",value:function(){var e=this.props,t=e.colorScale,n=e.datasetFilter,a=e.featureSummary,i=e.globalFeatureSummary,r=e.handleUpdate,o=e.maxHeight,s=e.name,l=e.nObs,c=e.nObsSelected,u=e.selected,d={display:"inline-block",verticalAlign:"top"};this.props.style&&(d=Object.assign({},d,this.props.style));var h="__count"===s;return Object(V.jsxs)("div",{"data-testid":"continuous-legend",className:"cirro-condensed",style:d,children:[Object(V.jsx)(Qs,{name:s,selected:u,summary:t.summary,featureSummary:a,nObs:l,nObsSelected:c,globalFeatureSummary:i,maxHeight:o}),!h&&Object(V.jsx)($s,{datasetFilter:n,name:s,handleUpdate:r})]})}}]),n}(i.a.PureComponent),tl=n(34),nl=function(){function e(t,n){var a=this;Object(j.a)(this,e),this._viewer=t,this.backingScale=1,this._containerWidth=0,this._containerHeight=0,this._canvas=document.createElement("canvas"),this._canvas.style.position="absolute",this._canvas.style.width="100%",this._canvas.style.height="100%",this._viewer.canvas.appendChild(this._canvas),this.onRedraw=n.onRedraw||function(){},this.clearBeforeRedraw="undefined"===typeof n.clearBeforeRedraw||n.clearBeforeRedraw,this._viewer.addHandler("update-viewport",(function(){a.resize(),a._updateCanvas()})),this._viewer.addHandler("open",(function(){a.resize(),a._updateCanvas()}))}return Object(C.a)(e,[{key:"canvas",value:function(){return this._canvas}},{key:"context2d",value:function(){return this._canvas.getContext("2d")}},{key:"clear",value:function(){this._canvas.getContext("2d").clearRect(0,0,this._containerWidth*this.backingScale,this._containerHeight*this.backingScale)}},{key:"resize",value:function(){var e=1;"undefined"!==typeof window&&"devicePixelRatio"in window&&(e=window.devicePixelRatio);var t=this.backingScale!==e;this.backingScale=e,(this._containerWidth!==this._viewer.container.clientWidth||t)&&(this._containerWidth=this._viewer.container.clientWidth,this._canvas.setAttribute("width",e*this._containerWidth),this._canvas.setAttribute("width",e*this._containerWidth)),(this._containerHeight!==this._viewer.container.clientHeight||t)&&(this._containerHeight=this._viewer.container.clientHeight,this._canvas.setAttribute("height",e*this._containerHeight),this._canvas.setAttribute("height",e*this._containerHeight))}},{key:"_updateCanvas",value:function(){var e=this._viewer.viewport.getZoom(!0);this.clearBeforeRedraw&&this.clear();for(var t=this._canvas.getContext("2d"),n=0,a=this._viewer.world.getItemCount();n<a;n++){var i=this._viewer.world.getItemAt(n);if(i){var r=i.viewportToImageZoom(e),o=i.imageToViewportCoordinates(0,0,!0),s=this._viewer.viewport.pixelFromPoint(o,!0);t.scale(this.backingScale,this.backingScale),t.translate(s.x,s.y),t.scale(r,r),this.onRedraw({index:n,context:t,x:s.x,y:s.y,zoom:r}),t.setTransform(1,0,0,1,0,0)}}}}],[{key:"getTileIndexFromPixel",value:function(e,t){for(var n=e.viewport.pointFromPixel(t),a=0,i=e.world.getItemCount();a<i;a++){var r=e.world.getItemAt(a),o=new window.OpenSeadragon.Rect(n.x,n.y,0,0),s=r._viewportToTiledImageRectangle(o).getTopLeft(),l=r.source;if(s.x>=0&&s.x<=1&&s.y>=0&&s.y<=1/l.aspectRatio)return a}return-1}}]),e}(),al="http://www.w3.org/2000/svg",il=function(){function e(t){Object(j.a)(this,e);var n=this;this._viewer=t,this._containerWidth=0,this._containerHeight=0,this._svg=document.createElementNS(al,"svg"),this._svg.style.position="absolute",this._svg.style.left=0,this._svg.style.top=0,this._svg.style.width="100%",this._svg.style.height="100%",this._viewer.canvas.appendChild(this._svg),this._node=document.createElementNS(al,"g"),this._svg.appendChild(this._node),this._viewer.addHandler("update-viewport",(function(){n.resize()})),this._viewer.addHandler("open",(function(){n.resize()})),this._viewer.addHandler("rotate",(function(e){n.resize()})),this._viewer.addHandler("resize",(function(){n.resize()})),this.resize()}return Object(C.a)(e,[{key:"node",value:function(){return this._node}},{key:"resize",value:function(){this._containerWidth!==this._viewer.container.clientWidth&&(this._containerWidth=this._viewer.container.clientWidth,this._svg.setAttribute("width",this._containerWidth)),this._containerHeight!==this._viewer.container.clientHeight&&(this._containerHeight=this._viewer.container.clientHeight,this._svg.setAttribute("height",this._containerHeight));var e=this._viewer.viewport.pixelFromPoint(new b.a.Point(0,0),!0),t=this._viewer.viewport.getZoom(!0);this._viewer.world.getItemCount()>0&&(t=this._viewer.world.getItemAt(0).viewportToImageZoom(t));var n=this._viewer.viewport.getRotation();this._node.setAttribute("transform","translate("+e.x+","+e.y+") scale("+t+") rotate("+n+")")}}]),e}();function rl(e,t){return t*(e.embedding.spatial.spot_diameter?e.embedding.spatial.spot_diameter/2:20)}function ol(e,t,n,a,i,r,o){if(r.length>0){e.textAlign="center",e.textBaseline="middle";var s=Math.ceil(a.labelFontSize/t);e.fillStyle="white",e.strokeStyle="rgba(0,0,0,0.9)",e.lineWidth=a.labelStrokeWidth,e.font=s+"px Roboto Condensed,Helvetica,Arial,sans-serif";for(var l=yn(n.embedding,r,o),c=wn(r,l.labels,i),u=0,d=0,h=c.length;u<h;u++,d+=3){var p=l.positions[d],f=l.positions[d+1];e.strokeText(""+c[u],p,f),e.fillText(""+c[u],p,f)}}}function sl(e,t,n,a,i,r,o){e.lineWidth=2/t,e.setLineDash&&e.setLineDash([2,2]);var s=0===a.size,l=n.indices;if(s){e.globalAlpha=i;for(var c=0;c<n.x.length;c++){var u=l[c],d=n.x[u],h=n.y[u];e.fillStyle=n.colors[u],e.beginPath(),e.arc(d,h,o,0,2*Math.PI,!0),e.fill()}}else{e.globalAlpha=r;for(var p=0;p<n.x.length;p++){var f=l[p],v=n.x[f],b=n.y[f];a.has(f)||(e.fillStyle=n.colors[f],e.beginPath(),e.arc(v,b,o,0,2*Math.PI,!0),e.fill())}e.globalAlpha=i;for(var m=0;m<n.x.length;m++){var g=l[m],j=n.x[g],O=n.y[g];a.has(g)&&(e.fillStyle=n.colors[g],e.beginPath(),e.arc(j,O,o,0,2*Math.PI,!0),e.fill())}}e.globalAlpha=1,e.setLineDash&&e.setLineDash([])}var ll=function(e){Object(O.a)(n,e);var t=Object(x.a)(n);function n(e){var a;return Object(j.a)(this,n),(a=t.call(this,e)).onSaveImage=function(e){var t=a.props.trace,n=a.viewer.source.levels[a.viewer.source.levels.length-1].context2D.canvas;dn(t,{width:n.width,height:n.height},Object(f.bind)(a.drawContext,Object(tl.a)(a)),e)},a.onZoomIn=function(){a.viewer.viewport.zoomBy(a.viewer.zoomPerClick/1),a.viewer.viewport.applyConstraints()},a.onZoomOut=function(){a.viewer.viewport.zoomBy(1/a.viewer.zoomPerClick),a.viewer.viewport.applyConstraints()},a.onHome=function(){a.viewer.viewport.goHome(),a.viewer.viewport.applyConstraints()},a.onDragMode=function(e){a.props.chartOptions.dragmode=e,a.props.setChartOptions(a.props.chartOptions)},a.id=Object(f.uniqueId)("cirro-image"),a.editSelection=!1,a.state={loading:!1},a}return Object(C.a)(n,[{key:"findPointsInPolygon",value:function(e){for(var t=this.props.trace,n=[],a=0;a<t.x.length;a++)xe({x:t.x[a],y:t.y[a]},e)&&n.push(a);return n}},{key:"findPointsInRectangle",value:function(e){for(var t=this.props.trace,n=rl(t,this.props.pointSize),a=[],i=parseFloat(e.getAttribute("x")),r=parseFloat(e.getAttribute("y")),o=i+parseFloat(e.getAttribute("width")),s=r+parseFloat(e.getAttribute("height")),l=0;l<t.x.length;l++){var c=t.x[l],u=t.y[l];c<=o&&i<=c+n&&u<=s&&r<=u+n&&a.push(l)}return a}},{key:"findPointIndex",value:function(e,t){for(var n=this.props.trace,a=rl(n,this.props.pointSize),i=0;i<n.x.length;i++)if(Math.abs(n.x[i]-e)<=a&&Math.abs(n.y[i]-t)<=a)return i;return-1}},{key:"setTooltip",value:function(e,t){var n=this.props.trace,a=this.findPointIndex(e,t);if(-1!=a){var i=n.values[a],r=this.props.categoricalNames[n.name];if(r){var o=r[i];null!=o&&(i=o)}"number"===typeof i&&(i=Tt(i)).endsWith(".00")&&(i=i.substring(0,i.lastIndexOf("."))),this.props.setTooltip(""+i)}else this.props.setTooltip("")}},{key:"drawContext",value:function(e,t){var n=this.viewer.source.levels[this.viewer.source.levels.length-1].context2D.canvas;null==t&&(t={width:n.width,height:n.height});var a=Math.min(t.width/n.width,t.height/n.height);e.drawImage(n,0,0,n.width*a,n.height*a),this._drawOverlay({context:e,zoom:a})}},{key:"_drawOverlay",value:function(e){var t=e.context,n=this.props.trace,a=this.props.selection,i=this.props.markerOpacity,r=this.props.unselectedMarkerOpacity,o=rl(n,this.props.pointSize);sl(t,e.zoom,n,a,i,r,o),ol(t,e.zoom,n,this.props.chartOptions,this.props.categoricalNames,this.props.obsCat,this.props.cachedData)}},{key:"createViewer",value:function(){var e=this;this.viewer&&this.viewer.destroy(),this.props.trace.tileSource.ready?this.setState({loading:!1}):(this.setState({loading:!0}),this.props.trace.tileSource.addOnceHandler("ready",(function(t){e.setState({loading:!1})}))),this.viewer=new b.a({id:this.id,gestureSettingsMouse:{dblClickToZoom:!0,clickToZoom:!1},autoResize:!0,showFullPageControl:!1,collectionMode:!1,showNavigationControl:!1,tileSources:this.props.trace.tileSource});var t=this.viewer,n=this;this.canvasOverlay=new nl(this.viewer,{onRedraw:function(e){n._drawOverlay(e)}});var a=[],i=[0,0],r={x:0,y:0,width:0,height:0};this.viewer.innerTracker.moveHandler=function(e){if(null==t.world)n.props.setTooltip("");else if("pan"===n.props.chartOptions.dragmode&&t.world.getItemCount()>0){var a=e.position,i=t.viewport.pointFromPixel(a),r=t.world.getItemAt(0).viewportToImageCoordinates(i,!0);n.setTooltip(r.x,r.y)}else n.props.setTooltip("")},this.viewer.addHandler("canvas-drag",(function(e){if(("lasso"===n.props.chartOptions.dragmode||"select"===n.props.chartOptions.dragmode)&&t.world.getItemCount()>0){e.preventDefaultAction=!0;var o=e.position,c=t.viewport.pointFromPixel(o),u=t.world.getItemAt(0).viewportToImageCoordinates(c,!0);a.push({x:u.x,y:u.y}),"lasso"===n.props.chartOptions.dragmode?(a=U()(a),s.setAttribute("d",ye(a))):(r.x=Math.min(u.x,i[0]),r.y=Math.max(u.y,i[1]),r.width=Math.max(u.x,i[0])-r.x,r.height=r.y-Math.min(u.y,i[1]),l.setAttribute("x",""+r.x),l.setAttribute("y",""+(r.y-r.height)),l.setAttribute("width",""+r.width),l.setAttribute("height",""+r.height))}})),this.viewer.addHandler("canvas-press",(function(e){if("lasso"===n.props.chartOptions.dragmode||"select"===n.props.chartOptions.dragmode){e.preventDefaultAction=!0,n.editSelection=e.metaKey||e.ctrlKey;var o=e.position,l=t.viewport.pointFromPixel(o),c=t.world.getItemAt(0).viewportToImageCoordinates(l,!0);"lasso"===n.props.chartOptions.dragmode?((a=[]).push({x:c.x,y:c.y}),a=U()(a),s.setAttribute("d",ye(a))):(i=[c.x,c.y],r={x:i[0],y:i[1],width:1,height:1})}})),this.viewer.addHandler("canvas-release",(function(e){if("lasso"===n.props.chartOptions.dragmode){e.preventDefaultAction=!0;var t=new Set(n.findPointsInPolygon(a));a=[],s.setAttribute("d",""),n.props.onSelected({name:Ma(n.props.trace.embedding),clear:!n.editSelection,value:{basis:n.props.trace.embedding,indices:t}})}else if("select"===n.props.chartOptions.dragmode){e.preventDefaultAction=!0;var i=new Set(n.findPointsInRectangle(l));l.removeAttribute("x"),l.removeAttribute("y"),l.removeAttribute("width"),l.removeAttribute("height"),n.props.onSelected({name:Ma(n.props.trace.embedding),clear:!n.editSelection,value:{basis:n.props.trace.embedding,indices:i}})}})),t.addHandler("canvas-exit",(function(e){n.props.setTooltip("")}));var o=new il(t),s=document.createElementNS("http://www.w3.org/2000/svg","path"),l=document.createElementNS("http://www.w3.org/2000/svg","rect");[s,l].forEach((function(e){e.setAttribute("stroke","black"),e.setAttribute("stroke-width","3px"),e.setAttribute("fill","#0bb"),e.setAttribute("fill-opacity","0.3"),e.setAttribute("stroke-dasharray","2 2"),o.node().appendChild(e)}))}},{key:"componentDidUpdate",value:function(e,t,n){this.canvasOverlay&&this.canvasOverlay._updateCanvas()}},{key:"componentWillUnmount",value:function(){this.viewer&&this.viewer.destroy(),this.viewer=null}},{key:"componentDidMount",value:function(){null==this.viewer&&this.createViewer(this.props.trace.url)}},{key:"render",value:function(){return Object(V.jsxs)(V.Fragment,{children:[Object(V.jsx)("div",{className:this.props.classes.root,children:Object(V.jsx)(kt,{dragmode:this.props.chartOptions.dragmode,onGallery:this.props.onGallery,animating:!1,onZoomIn:this.onZoomIn,onZoomOut:this.onZoomOut,is3d:!1,onHome:this.onHome,onSaveImage:this.onSaveImage,onDragMode:this.onDragMode})}),Object(V.jsx)("div",{style:{display:"inline-block",width:this.props.chartSize.width,height:this.props.chartSize.height},id:this.id}),this.state.loading&&Object(V.jsx)(vr.a,{style:{position:"absolute",left:this.props.chartSize.width/2,top:this.props.chartSize.height/2},size:20})]})}}]),n}(i.a.PureComponent),cl=Object(P.a)((function(e){return{root:{"& > *":{margin:e.spacing(.4)},"& > .MuiIconButton-root":{padding:0},position:"absolute",zIndex:1,top:0,left:0,display:"inline-block",verticalAlign:"top",whiteSpace:"nowrap",overflow:"hidden"}}}))(ll),ul=n(51),dl=Object(ul.a)((function(e,t){return ze(e).obsCat.filter((function(e){return-1!==t.indexOf(e)}))})),hl=function(e){Object(O.a)(n,e);var t=Object(x.a)(n);function n(e){var a;return Object(j.a)(this,n),(a=t.call(this,e)).handleToggleLegend=function(e){e.preventDefault(),a.setState({showLegend:!a.state.showLegend})},a.onCamera=function(e,t){for(var n=a.props,i=n.embeddingData,r=n.activeFeature,o=Object(f.find)(i,(function(e){return Aa(e)===r.embeddingKey})),s=0,l=i.length;s<l;s++)o.embedding.name===i[s].embedding.name&&(i[s].camera=t);a.props.handleEmbeddingData(a.props.embeddingData.slice())},a.state={showLegend:!0},a.resizeListener=function(){var e=window.innerWidth-280,t=Math.max(300,window.innerHeight-370);a.props.handlePrimaryChartSize({width:e,height:t}),a.windowHeight=window.innerHeight},window.addEventListener("resize",a.resizeListener),a}return Object(C.a)(n,[{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.resizeListener)}},{key:"componentDidUpdate",value:function(e,t,n){null!=e.activeFeature&&null!=this.props.activeFeature&&e.activeFeature.name===this.props.activeFeature.name||this.setState({showLegend:!0})}},{key:"render",value:function(){var e=this.props,t=e.activeFeature,n=e.cachedData,a=e.categoricalNames,i=e.chartOptions,r=e.dataset,o=e.datasetFilter,s=e.embeddingData,l=e.embeddingLabels,c=e.featureSummary,u=e.globalFeatureSummary,d=e.handleSearchTokens,h=e.handleScrollPosition,p=e.legendScrollPosition,v=e.markerOpacity,b=e.onCategoricalNameChange,m=e.onChartOptions,g=e.onColorChange,j=e.onDimensionFilterUpdated,O=e.onDomain,x=e.onGallery,y=e.onMeasureFilterUpdated,S=e.onSelect,w=e.pointSize,C=e.primaryChartSize,k=e.searchTokens,E=e.serverInfo,z=e.selection,P=e.setTooltip,A=e.shape,I=e.unselectedMarkerOpacity,D=e.unselectedPointSize;if(null==t)return null;var _=Object(f.find)(s,(function(e){return Aa(e)===t.embeddingKey}));if(null==_)return console.log(t.embeddingKey+" not found"),null;var R=z.size,N=dl(k,l),F="__count"===_.name?"":_.name;return Object(V.jsxs)(Vi.a,{bgcolor:"inherit",color:"inherit",style:{position:"relative"},children:[Object(V.jsxs)(Vi.a,{"data-testid":"chart-extra",color:"text.primary",sx:{marginTop:3.2,position:"absolute",textAlign:"right",overflow:"hidden",textOverflow:"ellipsis",maxWidth:300,right:8,zIndex:1e3},children:[""!==F&&Object(V.jsx)(qe.a,{title:"Embedding: "+_.embedding.name,children:Object(V.jsx)(T.a,{onClick:this.handleToggleLegend,children:Object(V.jsx)(M.a,{color:"textPrimary",style:{marginRight:14},component:"h4",children:F})})}),_.continuous?Object(V.jsx)(el,{handleDomain:O,width:140,showColorScheme:!1,height:30,style:{display:this.state.showLegend?"block":"none"},handleUpdate:y,datasetFilter:o,colorScale:_.colorScale,featureSummary:c,globalFeatureSummary:u,nObs:A[0],nObsSelected:R,maxHeight:null,name:_.name}):Object(V.jsx)(Ys,{legendScrollPosition:p,handleScrollPosition:h,visible:this.state.showLegend,height:C.height-40,features:r.features,datasetFilter:o,handleClick:j,handleColorChange:g,handleNameChange:b,handleSearchTokens:d,categoricalNames:a,name:_.name,scale:_.colorScale,nObs:A[0],nObsSelected:R,globalFeatureSummary:u,featureSummary:c,serverInfo:E})]}),"scatter"===_.type&&null==_.embedding.mode&&Object(V.jsx)(mn,{trace:_,cachedData:n,obsCat:N,chartSize:C,setChartOptions:m,chartOptions:i,categoricalNames:a,selection:z,onSelected:S,pointSize:w,unselectedPointSize:D,markerOpacity:v,unselectedMarkerOpacity:I,color:_.colors,onGallery:x,onCamera:this.onCamera,setTooltip:P,handleClick:j}),_.type===ie&&Object(V.jsx)(Dt,{trace:_,cachedData:n,chartSize:C,setChartOptions:m,chartOptions:i,dataset:r,selection:z,categoricalNames:a,markerOpacity:v,onSelected:S,onGallery:x,setTooltip:P}),"image"===_.type&&Object(V.jsx)(cl,{cachedData:n,obsCat:N,setChartOptions:m,chartOptions:i,style:{display:"inline-block"},trace:_,pointSize:w,chartSize:C,categoricalNames:a,selection:z,onInitialized:this.onInitialized,markerOpacity:v,unselectedMarkerOpacity:I,onSelected:S,onGallery:x,setTooltip:P})]})}}]),n}(i.a.PureComponent),pl=Object(o.b)((function(e){return{activeFeature:e.activeFeature,embeddingData:e.embeddingData,cachedData:e.cachedData,categoricalNames:e.categoricalNames,chartOptions:e.chartOptions,dataset:e.dataset,datasetFilter:e.datasetFilter,embeddingLabels:e.embeddingLabels,featureSummary:e.featureSummary,globalFeatureSummary:e.globalFeatureSummary,legendScrollPosition:e.legendScrollPosition,markerOpacity:e.markerOpacity,selection:e.selection,pointSize:e.pointSize,primaryChartSize:e.primaryChartSize,serverInfo:e.serverInfo,shape:e.dataset.shape,searchTokens:e.searchTokens,unselectedMarkerOpacity:e.unselectedMarkerOpacity,unselectedPointSize:e.unselectedPointSize}}),(function(e){return{onChartOptions:function(t){e(Ha(t))},onDomain:function(t){e(Qa(t))},onDimensionFilterUpdated:function(t){var n;e((n=t,function(e,t){for(var a,i=n.name,r=n.value,o=n.shiftKey,s=n.metaKey,l=t().datasetFilter,c=t().embeddingData,u=0;u<c.length;u++)if(c[u].name===i){a=c[u].colorScale.domain();break}var d=l[i];if(null==d&&(d={operation:"in",value:[]},l[i]=d),o&&d.value.length>0){var h=a.indexOf(d.value[d.value.length-1]),p=a.indexOf(r);if(p>h)for(var f=h;f<=p;f++){var v=d.value.indexOf(r);-1!==v&&d.value.splice(v,1),d.value.push(a[f])}else for(var b=h;b>=p;b--){var m=d.value.indexOf(r);-1!==m&&d.value.splice(m,1),d.value.push(a[b])}}else{var g=d.value.indexOf(r);s||(d.value=[]),-1!==g?(d.value.splice(g,1),0===d.value.length&&delete l[i]):d.value.push(r)}e(qa(l)),e(Ya())}))},onColorChange:function(t){var n;e((n=t,function(e,t){var a=Object.assign({id:t().dataset.id},n);t().serverInfo.capabilities.has(J)?t().serverInfo.api.setCategoryNamePromise(a).then((function(){e(ti(n))})):e(ti(n))}))},onCategoricalNameChange:function(t){var n;e((n=t,function(e,t){var a=Object.assign({id:t().dataset.id},n);t().serverInfo.capabilities.has(J)?t().serverInfo.api.setCategoryNamePromise(a).then((function(){e(ei(n))})):e(ei(n))}))},onMeasureFilterUpdated:function(t){var n;e((n=t,function(e,t){var a=n.name,i=n.operation,r=n.value,o=n.update,s=t().datasetFilter,l=s[a];null==l&&(l={operation:">",value:NaN},s[a]=l),o&&(null!=r&&(o=isNaN(r)?isNaN(r)!==isNaN(l.value):r!==l.value),null!=i&&(o=o||i!==l.operation&&!isNaN(l.value))),null!=i&&(l.operation=i),null!=r&&(l.value=r),e(qa(Object.assign({},s))),o&&e(Ya())}))},onSelect:function(t){var n;e((n=t,function(e,t){var a=n.name,i=n.value,r=n.clear,o=null!=n.value?n.value.indices:null,s=t().datasetFilter;function l(){if(r)for(var e in s){var t=s[e];Array.isArray(t)&&delete s[e]}}var c=!0;if(null==i||0===o.size)c=null!=s[a],delete s[a],l();else{var u=s[a],d=!1;if(null!=u){var h=null!=i.id?Object(f.findIndex)(u,(function(e){return e.id===i.id})):-1;-1!==h&&(d=!0,u.splice(h,1))}d||(l(),null==(u=s[a])&&(u=[],s[a]=u),u.push({basis:i.basis,indices:o,id:i.id}))}c&&(e(qa(Object.assign({},s))),e(Ya()))}))},handleScrollPosition:function(t){e({type:Nn,payload:t})},handlePrimaryChartSize:function(t){e(Ga(t))},handleEmbeddingData:function(t){e(fi(t))},handleSearchTokens:function(t,n,a,i){e(zi(null==t?[]:t,n,a,i))}}}))(hl);function fl(e,t,n,a,i,r,o,s,l,c){var u=document.createElement("canvas");u.width=a*window.devicePixelRatio,u.height=a*window.devicePixelRatio;var d=u.getContext("2d");return d.scale(window.devicePixelRatio,window.devicePixelRatio),function(e,t,n,a,i,r,o,s,l,c,u){if(n.tileSource.ready){var d=n.tileSource.levels[n.tileSource.levels.length-1].context2D.canvas;null==t&&(t={width:d.width,height:d.height});var h=Math.min(t.width/d.width,t.height/d.height);e.drawImage(d,0,0,d.width*h,d.height*h),e.scale(h,h),sl(e,h,n,a,i,r,u),ol(e,h,n,o,s,l,c),e.setTransform(1,0,0,1,0,0)}}(d,{width:a,height:a},l,s,i,c,n,t,r,e,rl(l,o)),u.toDataURL()}function vl(e){var t=Object(a.useState)(null),n=Object(Xe.a)(t,2),i=n[0],r=n[1],o=Object(a.useState)(null),s=Object(Xe.a)(o,2),l=s[0],c=s[1],u=Object(a.useState)(!1),d=Object(Xe.a)(u,2),h=d[0],p=d[1],f=Object(a.useRef)();function v(t){t.preventDefault(),e.onSelect(e.traceInfo)}var b=e.cachedData,m=e.categoricalNames,g=e.chartOptions,j=e.chartSize,O=e.containerElement,x=e.primaryChartSize,y=e.markerOpacity,S=e.obsCat,w=e.pointSize,C=e.scatterPlot,k=e.selection,E=e.traceInfo,z=e.unselectedMarkerOpacity,T=e.unselectedPointSize;Object(a.useEffect)((function(){if("scatter"===E.type&&null==E.embedding.mode){vn(C,gn).zoomFactor=function(e){var t=1.2,n=e.width/e.height,a=-1.2,i=t,r=-1.2,o=t;n>1?(a*=n,i*=n):(o/=n,r/=n);var s=new Lt.k(a,i,o,r,-1e3,1e3);return s.up=new Lt.w(0,0,1),s.updateProjectionMatrix(),s.projectionMatrix.elements[0]}(x),Sn(C,E,k,y,z,w,T,m,g,S,b,E.camera);var e=O.querySelector("canvas"),t=null;if(S.length>0&&g.showGalleryLabels){var n=yn(E.embedding,S,b),a=document.createElement("canvas");a.width=j*window.devicePixelRatio,a.height=j*window.devicePixelRatio;var i=a.getContext("2d");i.scale(window.devicePixelRatio,window.devicePixelRatio),i.font="bold "+g.labelFontSize+"px Roboto Condensed",fn(i,wn(S,n.labels,m),n.positions,g,{width:j,height:j},C.camera),t=a.toDataURL()}r(e.toDataURL()),c(t),p(!1)}else if("image"===E.type)E.tileSource.ready?(r(fl(b,m,g,j,y,S,w,k,E,z)),c(null),p(!1)):(r(null),c(null),p(!0),E.tileSource.addOnceHandler("ready",(function(){p(!1),r(fl(b,m,g,j,y,S,w,k,E,z))})));else{var o=f.current;o.innerHTML="";var s=E.gallerySource;s.setAttribute("width",j),s.setAttribute("height",j),o.append(s),r(null),c(null),p(!1)}}),[O,x,b,m,g,j,y,S,w,C,k,E,z,T]);var P=e.traceInfo.name;return"__count"===P&&(P=""),Object(V.jsx)(Vi.a,{borderColor:"text.primary",border:1,"data-testid":"gallery-image",style:{display:"inline-block",margin:2},children:Object(V.jsxs)("div",{style:{position:"relative",width:e.chartSize,height:e.chartSize,cursor:"pointer"},children:[Object(V.jsx)(qe.a,{title:"Embedding: "+e.traceInfo.embedding.name,children:Object(V.jsx)(M.a,{color:"textPrimary",variant:"caption",onClick:v,style:{marginTop:3.2,position:"absolute",right:4,zIndex:1e3},children:P})}),h&&Object(V.jsx)(vr.a,{style:{position:"absolute",left:e.chartSize/2,top:e.chartSize/2},size:20}),Object(V.jsx)("div",{onClick:v,ref:f,style:{position:"absolute",left:0,top:0}}),i&&Object(V.jsx)("div",{style:{position:"absolute",left:0,top:0},children:Object(V.jsx)("img",{alt:"",src:i,width:e.chartSize*window.devicePixelRatio,height:e.chartSize*window.devicePixelRatio,onClick:v,style:{width:e.chartSize,height:e.chartSize}})}),l&&Object(V.jsx)("div",{style:{position:"absolute",left:0,top:0},children:Object(V.jsx)("img",{alt:"",src:l,onClick:v,style:{width:e.chartSize,height:e.chartSize}})})]})})}function bl(e){var t=document.createElement("div");return t.style.position="absolute",t.style.left="-9999px",t.style.width=e+"px",t.style.height=e+"px",t}var ml=function(e){Object(O.a)(n,e);var t=Object(x.a)(n);function n(e){var a;return Object(j.a)(this,n),(a=t.call(this,e)).onChartSelected=function(e){a.props.handleActiveFeature({name:e.name,type:e.featureType,embeddingKey:Aa(e)}),window.scrollTo(0,0)},a.onSortEnd=function(e,t){var n=e[t.oldIndex],i=e[t.newIndex],r=a.props.embeddingData,o=Object(f.findIndex)(r,n),s=Object(f.findIndex)(r,i);r.splice(o,1),r.splice(s,0,n),a.props.handleEmbeddingData(r.slice())},a.containerElement=bl(a.props.chartSize),document.body.appendChild(a.containerElement),a.scatterPlot=xn(a.containerElement,null!=window.ApplePaySession,!1,!1),a}return Object(C.a)(n,[{key:"render",value:function(){var e=this,t=this.props,n=t.cachedData,a=t.categoricalNames,i=t.chartSize,r=t.chartOptions,o=t.embeddingData,s=t.embeddingLabels,l=t.markerOpacity,c=t.pointSize,u=t.primaryChartSize,d=t.searchTokens,h=t.selection,p=t.unselectedMarkerOpacity,f=t.unselectedPointSize;this.containerElement.style.width!==this.props.chartSize+"px"&&(document.body.removeChild(this.containerElement),this.containerElement=bl(this.props.chartSize),document.body.appendChild(this.containerElement),this.scatterPlot=xn(this.containerElement,window.ApplePaySession,!1,!1));var v=o.filter((function(e){return e.active})),b=ze(d).obsCat.filter((function(e){return-1!==s.indexOf(e)})),m=Object(Vs.b)((function(t){var o=t.trace;return Object(V.jsx)(vl,{traceInfo:o,obsCat:b,cachedData:n,scatterPlot:e.scatterPlot,markerOpacity:l,chartOptions:r,pointSize:c,unselectedPointSize:f,primaryChartSize:u,chartSize:i,categoricalNames:a,unselectedMarkerOpacity:p,selection:h,containerElement:e.containerElement,onSelect:e.onChartSelected},Aa(o))})),g=Object(Vs.a)((function(e){var t=e.items;return Object(V.jsx)("ul",{style:{padding:0,marginTop:4,marginBottom:0},children:t.map((function(e,t){return Object(V.jsx)(m,{index:t,trace:e},Aa(e))}))})}));return Object(V.jsx)(g,{distance:2,axis:"xy",items:v,onSortEnd:function(t){return e.onSortEnd(v,t)}})}}]),n}(i.a.PureComponent),gl=Object(o.b)((function(e){return{cachedData:e.cachedData,categoricalNames:e.categoricalNames,chartOptions:e.chartOptions,chartSize:e.chartSize,embeddingData:e.embeddingData,embeddingLabels:e.embeddingLabels,markerOpacity:e.markerOpacity,pointSize:e.pointSize,primaryChartSize:e.primaryChartSize,searchTokens:e.searchTokens,selection:e.selection,unselectedMarkerOpacity:e.unselectedMarkerOpacity,unselectedPointSize:e.unselectedPointSize}}),(function(e){return{handleActiveFeature:function(t){e(Ja(t))},handleEmbeddingData:function(t){e(fi(t))}}}))(ml),jl=n(374);var Ol=Object(o.b)((function(e){return{serverInfo:e.serverInfo}}),(function(e){return{}}))((function(e){return Object(V.jsxs)(jl.a,{elevation:0,children:[Object(V.jsx)("p",{children:"Cirrocumulus: an interactive tool for large-scale single-cell genomics"}),Object(V.jsx)(M.a,{variant:"h5",children:"Links"}),Object(V.jsxs)("ul",{children:[Object(V.jsx)("li",{children:Object(V.jsx)(T.a,{target:"_blank",rel:"noopener noreferrer",href:"http://cirrocumulus.readthedocs.io/",children:"Documentation"})}),Object(V.jsx)("li",{children:Object(V.jsx)(T.a,{target:"_blank",rel:"noopener noreferrer",href:"https://github.com/klarman-cell-observatory/cirrocumulus",children:"Source Code"})})]}),Object(V.jsx)(M.a,{variant:"h5",children:"Primary Embedding Controls"}),Object(V.jsxs)("ul",{children:[Object(V.jsx)("li",{children:"Pan: Mouse left click (2-d), right click (3-d)"}),Object(V.jsx)("li",{children:"Rotate 3-d: Mouse left click"}),Object(V.jsx)("li",{children:"Zoom: Mouse wheel"}),Object(V.jsx)("li",{children:"Select: When using lasso or select tool, hold down the Ctrl or Command key to add to selection"}),Object(V.jsx)("li",{children:"Resize: Click and drag the divider below the primary embedding"}),Object(V.jsx)("li",{children:"Tooltip: Mouse move"}),Object(V.jsx)("li",{children:"Select Category: Mouse click"})]}),Object(V.jsx)(M.a,{variant:"h5",children:"Embedding Gallery"}),Object(V.jsxs)("ul",{children:[Object(V.jsx)("li",{children:"Drag charts to reorder"}),Object(V.jsx)("li",{children:"Click chart to set primary view"})]}),e.serverInfo&&e.serverInfo.footer&&Object(V.jsx)(Vi.a,{children:Object(V.jsx)(Rr.a,{options:{overrides:ce},children:e.serverInfo.footer})}),Object(V.jsx)(yr.a,{}),Object(V.jsxs)(M.a,{variant:"body2",children:["Version: ","1.1.2-2.post2"]}),Object(V.jsx)(M.a,{variant:"caption",display:"block",children:"Tue Oct 12 2021"})]})})),xl=function(e){Object(O.a)(n,e);var t=Object(x.a)(n);function n(e){var a;return Object(j.a)(this,n),(a=t.call(this,e)).handleClose=function(){a.props.handleClose()},a.state={open:!0},a}return Object(C.a)(n,[{key:"render",value:function(){return Object(V.jsx)(br.a,{open:this.state.open,onClose:this.handleClose,"aria-labelledby":"help-dataset-dialog-title",fullWidth:!0,maxWidth:"sm",children:Object(V.jsx)(Jr.a,{children:Object(V.jsx)(Ol,{})})})}}]),n}(i.a.PureComponent),yl=Object(o.b)((function(e){return{}}),(function(e){return{handleClose:function(t){e(vi(null))}}}))(xl),Sl=function(e){Object(O.a)(n,e);var t=Object(x.a)(n);function n(e){var a;return Object(j.a)(this,n),(a=t.call(this,e)).onNameChanged=function(e){a.setState({name:e.target.value})},a.onNotesChanged=function(e){a.setState({notes:e.target.value})},a.handleClose=function(){a.props.handleCancel()},a.handleSave=function(){a.props.handleSave({name:a.state.name.trim(),notes:a.state.notes.trim().trim()})},a.state={name:"",notes:""},a}return Object(C.a)(n,[{key:"render",value:function(){var e=this.state,t=e.name,n=e.notes;return Object(V.jsxs)(br.a,{open:!0,onClose:this.handleClose,"aria-labelledby":"edit-dataset-view-dialog-title",fullWidth:!0,maxWidth:"sm",children:[Object(V.jsxs)(mr.a,{id:"edit-dataset-view-dialog-title",children:["Save"," Link"]}),Object(V.jsxs)(Jr.a,{children:[Object(V.jsx)(qr.a,{size:"small",margin:"dense",required:!0,value:t,autoComplete:"off",onChange:this.onNameChanged,label:"Name",fullWidth:!0}),Object(V.jsx)(qr.a,{size:"small",margin:"dense",required:!1,value:n,autoComplete:"off",onChange:this.onNotesChanged,label:"Notes",multiline:!0,fullWidth:!0})]}),Object(V.jsxs)(_o.a,{children:[Object(V.jsx)(wr.a,{onClick:this.handleClose,children:"Cancel"}),Object(V.jsx)(wr.a,{disabled:0===t.trim().length,onClick:this.handleSave,variant:"contained",color:"primary",children:"Save"})]})]})}}]),n}(i.a.PureComponent),wl=Object(o.b)((function(e){return{}}),(function(e){return{handleSave:function(t){var n;e((n=t,function(e,t){var a=t();delete Ui(a).dataset,n=Object.assign({ds_id:a.dataset.id},n),e(gi(!0)),t().serverInfo.api.upsertViewPromise(n,!1).then((function(a){n=Object.assign(a,n);var i=t().datasetViews;i.push(n),e(Mi(i.slice())),e(pi("Link saved"))})).finally((function(){e(gi(!1)),e(vi(null))})).catch((function(t){Li(e,t,"Unable to save link. Please try again.")}))}))},handleCancel:function(t){e(vi(null))},handleError:function(t){e(pi(t))}}}))(Sl),Cl=function(e){Object(O.a)(n,e);var t=Object(x.a)(n);function n(e){var a;return Object(j.a)(this,n),(a=t.call(this,e)).onNameChanged=function(e){a.setState({name:e.target.value})},a.onCategoryChanged=function(e){a.setState({category:e.target.value})},a.handleClose=function(){a.props.handleCancel()},a.handleSave=function(){var e=a.state.name.trim(),t=a.state.category;null!=t&&(t=t.trim()),a.setState({loading:!0}),a.props.handleSave({name:e,category:t})},a.state={open:!0,name:"",category:""},a}return Object(C.a)(n,[{key:"render",value:function(){var e=this.state,t=e.name,n=e.category;return Object(V.jsxs)(br.a,{open:!0,onClose:this.handleClose,"aria-labelledby":"edit-set-dialog-title",fullWidth:!0,maxWidth:"sm",children:[Object(V.jsx)(mr.a,{id:"edit-set-dialog-title",children:"Create Set"}),Object(V.jsxs)(Jr.a,{children:[Object(V.jsx)(qr.a,{required:!0,autoComplete:"off",value:t,onChange:this.onNameChanged,margin:"dense",label:"Set Name",fullWidth:!0}),Object(V.jsx)(qr.a,{required:!0,autoComplete:"off",value:n,onChange:this.onCategoryChanged,margin:"dense",label:"Set Category",fullWidth:!0})]}),Object(V.jsxs)(_o.a,{children:[Object(V.jsx)(wr.a,{onClick:this.handleClose,children:"Cancel"}),Object(V.jsx)(wr.a,{disabled:0===t.trim().length||0===n.trim().length,onClick:this.handleSave,variant:"contained",color:"primary",children:"Save"})]})]})}}]),n}(i.a.PureComponent),kl=Object(o.b)((function(e){return{}}),(function(e){return{handleSave:function(t){var n;e((n=t,function(e,t){var a=t(),i=ze(a.searchTokens).X,r={ds_id:a.dataset.id,name:n.name,features:i,category:n.category};e(gi(!0)),t().serverInfo.api.upsertFeatureSet(r,!1).then((function(a){var r=t().markers;r.push({category:n.category,name:n.name,features:i,id:a.id}),e(bi(r.slice())),e(pi("Set saved"))})).finally((function(){e(gi(!1)),e(vi(null))})).catch((function(t){Li(e,t,"Unable to save set. Please try again.")}))}))},handleCancel:function(t){e(vi(null))},handleError:function(t){e(pi(t))}}}))(Cl),El=n(375),zl=n(401),Tl=n(360),Pl=n(144),Ml=n.n(Pl),Al=function(e){Object(O.a)(n,e);var t=Object(x.a)(n);function n(e){var a;return Object(j.a)(this,n),(a=t.call(this,e)).updateTopNJobResultDebounced=function(){tr(a.props.jobResult),a.handleJobResults()},a.sortAndFilterDebounced=function(){er(a.props.jobResult),a.handleJobResults()},a.handleJobResultDebounced=function(){$i(a.props.jobResult),a.handleJobResults()},a.onSizeReversedChange=function(e){var t=a.props.jobResult;t.sizeScaleReversed=e,t.sizeScale=void 0,$i(t),a.handleJobResults()},a.handleJobResults=function(){var e=a.props,t=e.jobResult,n=e.jobResults,i=Object.assign({},t),r=Object(f.findIndex)(n,(function(e){return e.id===t.id}));if(-1===r)throw new Error(t.id+" not found");n[r]=i,a.props.handleJobResults(n.slice())},a.onSortChange=function(e){var t=a.props.jobResult;t.sortByGroup=e.target.value,tr(t),a.handleJobResults()},a.onMinUIChange=function(e){a.setState({min:e})},a.onMaxUIChange=function(e){a.setState({max:e})},a.onMinChange=function(e){var t=a.props.jobResult;t.options.min=e,t.colorScale=void 0,$i(t),a.handleJobResults()},a.onMaxChange=function(e){var t=a.props.jobResult;t.options.max=e,t.colorScale=void 0,$i(t),a.handleJobResults()},a.onOptions=function(e){var t=a.props.jobResult;t.options=Object.assign(t.options,e),t.colorScale=void 0,t.sizeScale=void 0,a.handleJobResultDebounced(a.props.jobResultId)},a.onInterpolator=function(e){var t=a.props.jobResult,n=t.interpolator.scale;t.interpolator=e,t.interpolator.scale=n,t.colorScale=Ce(t.interpolator).domain(t.colorScale.domain()).clamp(!0),a.handleJobResults()},a.onColorScalingChange=function(e){var t=a.props.jobResult;t.colorScale=void 0,t.interpolator.scale=e,$i(t),a.handleJobResults()},a.onColorChanged=function(e){var t=a.props.jobResult;t.colorScale=void 0,t.color=e.target.value,$i(t),a.handleJobResults()},a.onSizeChanged=function(e){var t=a.props.jobResult;t.sizeScale=void 0,t.size=e.target.value,$i(t),a.handleJobResults()},a.onNtopChange=function(e,t){var n=a.props.jobResult;n.ntopUI=t,n.ntop=t,a.setState((function(e,t){return{forceUpdate:!e.forceUpdate}})),a.updateTopNJobResultDebounced()},a.onByChanged=function(e){var t=a.props.jobResult;t.by=e.target.value,er(t),a.handleJobResults()},a.onByAscendingChange=function(e){var t=a.props.jobResult;t.byAscending=e.target.checked,er(t),a.handleJobResults()},a.onOperationChanged=function(e,t){var n=a.props.jobResult;e[1]=t,er(n),a.handleJobResults()},a.onValueChange=function(e,t){e[2]=parseFloat(t),e[3]=t,a.setState((function(e,t){return{forceUpdate:!e.forceUpdate}})),a.sortAndFilterDebounced()},a.handleJobResultDebounced=Object(f.debounce)(a.handleJobResultDebounced,500),a.sortAndFilterDebounced=Object(f.debounce)(a.sortAndFilterDebounced,500),a.updateTopNJobResultDebounced=Object(f.debounce)(a.updateTopNJobResultDebounced,500),a.state={forceUpdate:!1,min:"",max:""},a}return Object(C.a)(n,[{key:"render",value:function(){var e=this,t=this.props,n=t.jobResult,a=t.classes,i=t.textColor,r=n.rowFilters,o=n.color,s=n.size,l=n.by,c=n.byAscending,u=n.colorScale,d=n.ntopUI,h=n.interpolator,p=n.sizeScale,f=n.fields.slice();return f.sort(W),Object(V.jsxs)(V.Fragment,{children:[Object(V.jsxs)("div",{style:{marginTop:16},children:[Object(V.jsx)(M.a,{component:"h2",children:"Rank Features"}),Object(V.jsxs)(eo.a,{style:{display:"block"},className:a.formControl,children:[Object(V.jsx)(Fo.a,{children:"By"}),Object(V.jsx)(Fr.a,{label:"By",size:"small",onChange:this.onByChanged,value:l,children:f.map((function(e){return Object(V.jsx)(Qe.a,{value:e,children:e},e)}))})]}),Object(V.jsx)("div",{children:Object(V.jsx)(Jo.a,{control:Object(V.jsx)(Lo.a,{value:"byAscending",checked:c,onChange:this.onByAscendingChange}),label:"Ascending"})}),Object(V.jsx)(Fo.a,{style:{marginLeft:8,marginTop:8},children:"Number of Features"}),Object(V.jsx)(Tl.a,{min:5,max:Math.min(100,n.data.length),step:5,style:{marginLeft:10,width:"86%"},valueLabelDisplay:"auto",value:d,onChange:this.onNtopChange}),n.groups.length>1&&Object(V.jsxs)(eo.a,{style:{display:"block"},className:a.formControl,children:[Object(V.jsx)(Fo.a,{children:"Sort Features"}),Object(V.jsx)(Fr.a,{label:"Sort Features",size:"small",onChange:this.onSortChange,value:n.sortByGroup,children:n.columns.map((function(e){return Object(V.jsx)(Qe.a,{value:n.groups[e],children:n.groups[e]},n.groups[e])}))})]})]}),Object(V.jsx)("div",{style:{marginTop:8}}),Object(V.jsx)(qe.a,{title:"Filters are applied separately per cluster",children:Object(V.jsx)(M.a,{component:"h2",children:"Filters"})}),r.map((function(t){var n="job_result"+t[0];return Object(V.jsxs)("div",{style:{paddingTop:8},children:[Object(V.jsxs)(eo.a,{className:a.formControlInline,children:[Object(V.jsx)(Fo.a,{children:t[0]}),Object(V.jsxs)(Fr.a,{label:t[0],size:"small",labelId:n+"_label",id:n,style:{marginRight:6},value:t[1],onChange:function(n){return e.onOperationChanged(t,n.target.value)},children:[Object(V.jsx)(Qe.a,{value:""}),Object(V.jsx)(Qe.a,{value:">",children:">"}),Object(V.jsx)(Qe.a,{value:"<",children:"<"}),Object(V.jsx)(Qe.a,{value:"=",children:"="}),Object(V.jsx)(Qe.a,{value:">=",children:">="}),Object(V.jsx)(Qe.a,{value:"<=",children:"<="}),Object(V.jsx)(Qe.a,{value:"!=",children:"!="})]})]}),Object(V.jsx)(qr.a,{size:"small",onChange:function(n){return e.onValueChange(t,n.target.value)},value:t[3],style:{maxWidth:60,verticalAlign:"bottom"}})]},t[0])})),Object(V.jsx)(M.a,{style:{marginTop:16},component:"h2",children:"View Options"}),Object(V.jsxs)(eo.a,{className:a.formControl,children:[Object(V.jsx)(Fo.a,{children:"Color"}),Object(V.jsx)(Fr.a,{label:"Color",size:"small",onChange:this.onColorChanged,value:o,children:f.map((function(e){return Object(V.jsx)(Qe.a,{value:e,children:e},e)}))})]}),Object(V.jsx)(Yo,{domain:u.domain(),textColor:i,interpolator:h,min:this.state.min,max:this.state.max,onMinChange:this.onMinChange,onMaxChange:this.onMaxChange,onMinUIChange:this.onMinUIChange,onMaxUIChange:this.onMaxUIChange,onInterpolator:this.onInterpolator}),n.groups.length>1&&Object(V.jsxs)(eo.a,{className:this.props.classes.formControl,children:[Object(V.jsx)(Fo.a,{children:"Standardize"}),Object(V.jsxs)(Fr.a,{label:"Standardize",size:"small",onChange:function(t){return e.onColorScalingChange(t.target.value)},value:h.scale,children:[Object(V.jsx)(Qe.a,{value:"none",divider:!0,children:"(None)"}),Object(V.jsx)(Qe.a,{title:"Standardize features between 0 and 1",value:re,children:"Feature"}),Object(V.jsx)(Qe.a,{title:"Standardize groups between 0 and 1",value:oe,children:"Category"})]})]}),Object(V.jsxs)(eo.a,{style:{marginTop:16},className:a.formControl,children:[Object(V.jsx)(Fo.a,{children:"Size"}),Object(V.jsxs)(Fr.a,{label:"Size",size:"small",onChange:this.onSizeChanged,value:s,children:[Object(V.jsx)(Qe.a,{divider:!0,value:"none",children:"(None)"}),f.map((function(e){return Object(V.jsx)(Qe.a,{value:e,children:e},e)}))]})]}),Object(V.jsx)("div",{style:{display:"none"===s?"none":"",marginTop:6},children:Object(V.jsx)(Qo,{sizeScale:p,textColor:i,onOptions:this.onOptions,showReversed:!0,reversed:n.sizeScaleReversed,onReversedChange:this.onSizeReversedChange})})]})}}]),n}(i.a.PureComponent),Il=Object(P.a)((function(e){return{formControl:{display:"block",margin:e.spacing(0,1)},formControlInline:{margin:e.spacing(0,1)}}}))(Object(o.b)((function(e){return{textColor:e.chartOptions.darkMode?"white":"black",jobResults:e.jobResults}}),(function(e,t){return{handleJobResults:function(t){e(yi(t))}}}))(Al));var Dl=Object(o.b)((function(e){return{jobResultId:e.jobResult,jobResults:e.jobResults}}),(function(e,t){return{}}))((function(e){var t=e.jobResultId,n=e.jobResults,a=null!=t?Object(f.find)(n,(function(e){return e.id===t})):null,i=null!=a?a.type:null;return Object(V.jsx)(V.Fragment,{children:"de"==i&&Object(V.jsx)(Il,{jobResult:a})})}));function _l(e){return Object(V.jsx)(Ke.a,Object(E.a)(Object(E.a)({},e),{},{children:Object(V.jsx)("path",{d:"M5.41,21L6.12,17H2.12L2.47,15H6.47L7.53,9H3.53L3.88,7H7.88L8.59,3H10.59L9.88,7H15.88L16.59,3H18.59L17.88,7H21.88L21.53,9H17.53L16.47,15H20.47L20.12,17H16.12L15.41,21H13.41L14.12,17H8.12L7.41,21H5.41M9.53,9L8.47,15H14.47L15.53,9H9.53Z"})}))}var Rl=n(124),Nl=n.n(Rl),Fl=n(123),Ll=n.n(Fl),Bl=n(369),Ul=n(225),Vl=n.n(Ul),Hl=Object(ul.a)((function(e,t){var n=[];return e.forEach((function(e){n.push({group:"Continuous",text:e,id:e,icon:Object(V.jsx)(_l,{style:{marginRight:2,fontSize:"0.9rem"}})})})),t.forEach((function(e){n.push({group:"Categorical",text:e,id:e,icon:Object(V.jsx)(Ll.a,{style:{marginRight:2,fontSize:"0.9rem"}})})})),n.sort((function(e,t){return W(e.text,t.text)})),n})),Wl=Object(ul.a)((function(e){var t=[];return e.forEach((function(e){t.push({text:e.name+(e.mode?" "+e.mode:""),id:Ma(e)})})),t.sort((function(e,t){return W(e.text.toLowerCase(),t.text.toLowerCase())})),t})),Gl=Object(ul.a)((function(e){if(e){var t=e.slice();return t.sort((function(e,t){return W(e.id.toLowerCase(),t.id.toLowerCase())})),t.map((function(e){return e.id}))}return[]})),Jl=Object(ul.a)((function(e,t){var n=e.map((function(e){return{group:e.category,text:e.name,id:e.id}}));return n.forEach((function(e){var n=e.group,a=n.lastIndexOf(" (");-1!==a&&(n=n.substring(0,a));var i=t[n]||{};e.text=le(i,e.text)})),n.sort((function(e,t){var n=W(e.group,t.group);return 0!==n?n:W(e.text,t.text)})),n}));function Xl(e){var t=Object.keys(e),n=t.indexOf("id");return-1!==n&&t.splice(n,1),t.sort(W),t.map((function(t){var n=e[t];return n=Object(f.isArray)(n)?n.join(", "):Object(f.isObject)(n)?JSON.stringify(n):""+n,Object(V.jsxs)("div",{children:[Object(V.jsx)(M.a,{color:"textSecondary",children:t}),Object(V.jsx)(M.a,{variant:"h6",component:"h3",children:n})]},t)}))}var ql=Object(P.a)((function(e){return{toolbar:{"& hr":{margin:e.spacing(0,.5)}}}}))(Object(o.b)((function(e){return{activeFeature:e.activeFeature,categoricalNames:e.categoricalNames,combineDatasetFilters:e.combineDatasetFilters,dataset:e.dataset,datasetFilter:e.datasetFilter,datasetFilters:e.datasetFilters,embeddingData:e.embeddingData,embeddingLabels:e.embeddingLabels,embeddings:e.embeddings,markers:e.markers,savedDatasetFilter:e.savedDatasetFilter,searchTokens:e.searchTokens,selection:e.selection,serverInfo:e.serverInfo,tab:e.tab}}),(function(e,t){return{handleDialog:function(t){e(vi(t))},handleTab:function(t){e(ji(t))},handleActiveFeature:function(t){e(Ja(t))},handleCombineDatasetFilters:function(t){e(Wa(t))},handleDownloadSelectedIds:function(){e((function(e,t){e(gi(!0));var n=t(),a=Ba(n);n.dataset.api.getSelectedIdsPromise({filter:a},n.cachedData).then((function(e){var t=new Blob([e.ids.join("\n")],{type:"text/plain;charset=utf-8"});Object(p.saveAs)(t,"selection.txt")})).finally((function(){e(gi(!1))})).catch((function(t){Li(e,t)}))}))},removeDatasetFilter:function(t){e(Fa(t))},handleEmbeddings:function(t){e(Pi(t))},handleEmbeddingLabel:function(t){e(wi(t))},handleSearchTokens:function(t,n){e(zi(null==t?[]:t,n))},handleDeleteView:function(t){e(_a(t))},handleDeleteFeatureSet:function(t){e(Na(t))}}}))((function(e){var t=Object(a.useState)(null),n=Object(Xe.a)(t,2),i=n[0],r=n[1],o=Object(a.useState)(null),s=Object(Xe.a)(o,2),l=s[0],c=s[1],u=Object(a.useState)({}),d=Object(Xe.a)(u,2),h=d[0],p=d[1];function v(t,n){t.stopPropagation();for(var a=n.id,i=t.target.closest(".MuiFormControl-root"),r=e.markers,o=null,s=0;s<r.length;s++)if(r[s].id===a){o=r[s];break}null==o&&console.log(a+" not found"),c(i),p({value:o,type:$})}function b(t,n){t.stopPropagation();for(var a,i=t.target.closest(".MuiFormControl-root"),r=e.dataset.modules,o=0,s=r.length;o<s;o++)if(r[o].id==n){a=r[o];break}c(i),p({value:a,type:ee})}function m(e){c(null),p({})}function g(e){e.stopPropagation(),p({}),r(null)}function j(e){O(e,e.target.innerText)}function O(t,n){t.stopPropagation();for(var a=void 0!==n.text?n.text:n,i=e.embeddingData.filter((function(e){return e.active})),r=0;r<i.length;r++)if(i[r].name===a){"embedding"!==e.tab&&e.handleTab("embedding"),e.handleActiveFeature({name:i[r].name,type:i[r].featureType,embeddingKey:Aa(i[r])});break}}var x=e.categoricalNames,y=e.classes,S=e.combineDatasetFilters,w=e.dataset,C=e.datasetFilter,k=e.embeddingLabels,E=e.embeddings,z=e.markers,P=e.searchTokens,A=e.selection,I=e.serverInfo,D=e.tab,_=function(e){var t=[],n=!1;for(var a in e){var i=e[a];Array.isArray(i)?n=!0:"in"===i.operation?t.push(a):null==i.operation||""===i.operation||isNaN(i.value)||null==i.value||t.push(a)}return n&&t.push("selection"),t}(C);_.sort(W);var R=ze(P),N=Ee(z,R.featureSets),F=w.features,L=Gl(w.modules),B=w.obsCat,U=w.obs,H=Hl(U,B),G=Jl(z,x),J=Wl(w.embeddings),X=Wl(E);return Object(V.jsxs)(V.Fragment,{children:["feature set view"===i&&Object(V.jsxs)(br.a,{open:!0,onClose:g,"aria-labelledby":"view-dialog-title",fullWidth:!0,maxWidth:"lg",children:[Object(V.jsx)(mr.a,{id:"view-dialog-title",children:h?h.value.name:""}),Object(V.jsx)(Jr.a,{children:Object(V.jsx)(qr.a,{size:"small",value:h?h.value.features.join("\n"):"",margin:"dense",fullWidth:!0,readOnly:!0,variant:"outlined",multiline:!0})})]}),h.type===$&&Object(V.jsxs)(Ye.a,{id:"feature-set-menu",anchorEl:l,open:Boolean(l),onClose:m,children:[Object(V.jsx)(Qe.a,{onClick:function(e){e.stopPropagation(),c(null),r("feature set view")},children:"View"}),Object(V.jsx)(Qe.a,{divider:!0}),Object(V.jsx)(Qe.a,{disabled:h.value.readonly,onClick:function(t){t.stopPropagation();var n=e.searchTokens,a=h.value.id,i=n.filter((function(e){return e.type===$&&e.value.id!==a}));e.handleSearchTokens(i,$),e.handleDeleteFeatureSet(a),p({}),c(null)},children:"Delete"})]}),"module view"===i&&Object(V.jsxs)(br.a,{open:!0,onClose:g,"aria-labelledby":"view-dialog-title",fullWidth:!0,maxWidth:"lg",children:[Object(V.jsx)(mr.a,{id:"view-dialog-title",children:h?h.value.id:""}),Object(V.jsx)(Jr.a,{children:Xl(h.value)})]}),h.type===ee&&Object(V.jsx)(Ye.a,{id:"module-menu",anchorEl:l,open:Boolean(l),onClose:m,children:Object(V.jsx)(Qe.a,{onClick:function(e){e.stopPropagation(),c(null),r("module view")},children:"View"})}),Object(V.jsxs)("div",{style:"embedding"===D||"distribution"===D||"composition"===D?null:{display:"none"},children:[Object(V.jsx)(M.a,{gutterBottom:!1,component:"h1",style:{textTransform:"uppercase",letterSpacing:"0.1em"},children:"Explore"}),"embedding"===D&&J.length>0&&Object(V.jsx)(eo.a,{sx:{display:"block"},children:Object(V.jsx)(Zs,{label:"Embeddings",testId:"embeddings-input",options:J,getChipTitle:function(e){return e.text},getOptionLabel:function(e){return e.text},value:X,getChipText:function(e){return e.text},getOptionSelected:function(e,t){return-1!==Object(f.findIndex)(X,(function(t){return t.id===e.id}))},onChange:function(t,n){var a=[],i=e.dataset.embeddings.map((function(e){return Ma(e)}));n.forEach((function(t){var n=void 0!==t.id?t.id:t,r=i.indexOf(n),o=e.dataset.embeddings[r];a.push(o)})),e.handleEmbeddings(a)}})}),F.length>0&&Object(V.jsxs)(eo.a,{sx:{display:"block"},children:[Object(V.jsx)(Zs,{onChipClick:O,label:"Genes/Features",testId:"genes-input",options:F,value:R.X,getOptionLabel:function(e){return e},onChange:function(t,n){e.handleSearchTokens(n,Q)},helperText:"Enter or paste list"}),Object(V.jsx)("div",{children:Object(V.jsx)(T.a,{style:{float:"right",marginRight:4,fontSize:"0.75rem",transform:"translateY(-50px)",display:0===R.X.length?"none":""},onClick:function(t){t.preventDefault(),t.stopPropagation(),de(e.searchTokens.filter((function(e){return e.type===Q})).map((function(e){return e.value})).join("\n"))},children:"Copy"})})]}),H.length>0&&Object(V.jsx)(eo.a,{sx:{display:"block"},children:Object(V.jsx)(Zs,{label:"Cell Metadata",testId:"cell-meta-input",options:H,value:P.filter((function(e){return e.type===Y||e.type===Z})).map((function(e){return e.value})),onChipClick:O,getOptionLabel:function(e){return e.text},getChipIcon:function(t){return-1!==R.obsCat.indexOf(t)?Object(V.jsx)(Ll.a,{onClick:function(n){!function(t,n){e.handleEmbeddingLabel(n),t.stopPropagation()}(n,t)},title:"Toggle Show/Hide Labels",style:{marginLeft:4,marginTop:0,marginRight:0,marginBottom:0},className:"MuiChip-deleteIcon MuiChip-deleteIconSmall"+(-1!==k.indexOf(t)?" cirro-active":"")}):null},getOptionSelected:function(e,t){return e.id===t},onChange:function(t,n){var a=[];n.forEach((function(e){void 0!==e.text?a.push(e.text):a.push(e)})),e.handleSearchTokens(a,Z)}})}),L.length>0&&Object(V.jsx)(eo.a,{sx:{display:"block"},children:Object(V.jsx)(Zs,{label:"Modules",testId:"modules-input",options:L,value:R.modules,onChange:function(t,n){e.handleSearchTokens(n,ee)},onChipClick:b,getChipIcon:function(e){return Object(V.jsx)(Nl.a,{onClick:function(t){b(t,e)}})}})}),Object(V.jsxs)(eo.a,{sx:{display:"block"},children:[Object(V.jsx)(Zs,{label:"Sets",testId:"sets-input",options:G,value:N,getChipTitle:function(e){return e.category+", "+e.name},onChipClick:v,getChipIcon:function(e){return Object(V.jsx)(Nl.a,{onClick:function(t){v(t,e)}})},groupBy:function(e){return e.group},onChange:function(t,n){var a=[];n.forEach((function(e){void 0!==e.id?a.push(e.id):a.push(e)})),e.handleSearchTokens(a,$)},getOptionSelected:function(e,t){return e.id===t.id},getChipText:function(e){return e.name}}),I.capabilities.has("SERVER_CAPABILITY_FEATURE_SETS")&&Object(V.jsx)("div",{children:Object(V.jsx)(qe.a,{title:"Save Current Genes/Features",children:Object(V.jsx)(T.a,{style:{float:"right",fontSize:"0.75rem",marginRight:4,display:0===R.X.length?"none":""},onClick:function(){e.handleDialog(ma)},children:"Save"})})})]})]}),Object(V.jsxs)("div",{style:{maxHeight:500},children:[Object(V.jsx)(yr.a,{inset:"true"}),Object(V.jsx)(M.a,{gutterBottom:!1,component:"h1",style:{textTransform:"uppercase"},children:"Filters"}),Object(V.jsxs)(Bl.a,{alignContent:"flex-start",container:!0,alignItems:"center",spacing:0,children:[Object(V.jsx)(Bl.a,{item:!0,children:Object(V.jsx)(Fo.a,{shrink:!0,children:"Combine"})}),Object(V.jsx)(Bl.a,{item:!0,children:"AND"}),Object(V.jsx)(Bl.a,{item:!0,children:Object(V.jsx)(Lo.a,{size:"small",checked:"or"===S,onChange:function(t){e.handleCombineDatasetFilters(t.target.checked?"or":"and")}})}),Object(V.jsx)(Bl.a,{item:!0,children:"OR"})]}),_.length>0&&A.size>0&&Object(V.jsx)(V.Fragment,{children:Object(V.jsxs)("div",{style:{marginBottom:2},children:[Pt(A.size)+" / "+Pt(w.shape[0])+": ",_.map((function(t){return Object(V.jsx)(_s.a,{onDelete:function(){var n;n=t,e.removeDatasetFilter(n)},onClick:j,size:"small",style:{marginRight:2,verticalAlign:"bottom"},label:t},t)})),Object(V.jsx)(yr.a,{}),Object(V.jsxs)(Bl.a,{container:!0,alignItems:"center",className:y.toolbar,disabled:0===_.length,children:[Object(V.jsx)(qe.a,{title:"Clear All",children:Object(V.jsx)(Ze.a,{size:"small",onClick:function(){e.removeDatasetFilter(null)},children:Object(V.jsx)(Vl.a,{})})}),Object(V.jsx)(qe.a,{title:"Download Selected IDs",children:Object(V.jsx)(Ze.a,{size:"small",onClick:function(t){t.preventDefault(),e.handleDownloadSelectedIds()},children:Object(V.jsx)(Yi.a,{})})})]})]})})]})]})}))),Kl=n(402);var Zl=Object(o.b)((function(e){return{combineDatasetFilters:e.combineDatasetFilters,dataset:e.dataset,datasetFilter:e.datasetFilter,selection:e.selection,serverInfo:e.serverInfo,tab:e.tab}}),(function(e,t){return{handleDialog:function(t){e(vi(t))},handleTab:function(t){e(ji(t))},handleSubmitJob:function(t){e(Ra(t))}}}))((function(e){var t=e.compareActions,n=e.combineDatasetFilters,i=e.dataset,r=e.datasetFilter,o=e.handleSubmitJob,s=e.selection,l=e.serverInfo,c=e.tab,u=Object(a.useState)("selected"),d=Object(Xe.a)(u,2),h=d[0],p=d[1],f=Object(a.useState)(null),v=Object(Xe.a)(f,2),b=v[0],m=v[1],g=Object(a.useState)(null),j=Object(Xe.a)(g,2),O=j[0],x=j[1],y=Object(a.useState)(null),S=Object(Xe.a)(y,2),w=S[0],C=S[1],k=Object(a.useState)(null),E=Object(Xe.a)(k,2),z=E[0],T=E[1],P=Object(a.useState)(""),A=Object(Xe.a)(P,2),I=A[0],D=A[1],_=Object(a.useState)(null),R=Object(Xe.a)(_,2),N=R[0],F=R[1],L=Object(a.useState)(null),B=Object(Xe.a)(L,2),U=B[0],H=B[1],W=Object(a.useState)([]),G=Object(Xe.a)(W,2),J=G[0],X=G[1],q=Hl([],i.obsCat);function K(){D(""),F(null)}function Z(e){var t=Ua(i,r,n),a=s.size;1===e?(m(t),x(a)):(C(t),T(a))}return Object(a.useEffect)((function(){m(null),x(null),C(null),T(null),X([]),F(null)}),[i]),Object(V.jsxs)(V.Fragment,{children:[Object(V.jsxs)(br.a,{open:null!=N,onClose:K,"aria-labelledby":"submit-job-dialog-title","aria-describedby":"submit-job-dialog-description",children:[Object(V.jsx)(mr.a,{id:"submit-job-dialog-title",children:"Submit"}),Object(V.jsx)(Jr.a,{children:Object(V.jsx)(qr.a,{size:"small",onChange:function(e){D(e.target.value)},value:I,autoFocus:!0,margin:"dense",label:"Job Name",type:"text",fullWidth:!0})}),Object(V.jsxs)(_o.a,{children:[Object(V.jsx)(wr.a,{onClick:K,children:"Cancel"}),Object(V.jsx)(wr.a,{disabled:""===I,variant:"contained",onClick:function(e){return N.name=I,o(N),D(""),void F(null)},color:"primary",children:"Submit"})]})]}),l.capabilities.has("SERVER_CAPABILITY_JOBS")&&Object(V.jsxs)("div",{style:"embedding"===c?null:{display:"none"},children:[Object(V.jsx)(yr.a,{}),Object(V.jsx)(M.a,{gutterBottom:!1,component:"h1",style:{textTransform:"uppercase"},children:"Compare"}),Object(V.jsxs)(Bl.a,{alignContent:"flex-start",container:!0,alignItems:"center",spacing:0,children:[Object(V.jsx)(qe.a,{title:"Compare all pairs in a category",children:Object(V.jsx)(Bl.a,{item:!0,children:"ALL PAIRS"})}),Object(V.jsx)(Bl.a,{item:!0,children:Object(V.jsx)(Lo.a,{size:"small",checked:"selected"===h,onChange:function(e){p(e.target.checked?"selected":"all")}})}),Object(V.jsx)(qe.a,{title:"Choose a specific pair",children:Object(V.jsx)(Bl.a,{item:!0,children:"SELECTED"})})]}),"selected"===h&&Object(V.jsxs)(Kl.a,{variant:"outlined",disabled:0===s.size,children:[Object(V.jsx)(qe.a,{title:"Group one"+(O?" ("+Pt(O)+" cells)":""),children:Object(V.jsx)(wr.a,{size:"small",onClick:function(e){return Z(1)},children:"1"})}),Object(V.jsx)(qe.a,{title:"Group two"+(z?" ("+Pt(z)+" cells)":""),children:Object(V.jsx)(wr.a,{size:"small",onClick:function(e){return Z(2)},children:"2"})})]}),"all"===h&&Object(V.jsx)(eo.a,{sx:{display:"block"},children:Object(V.jsx)(Zs,{label:"Metadata Categories",testId:"compare-meta-input",options:q,value:J,getOptionLabel:function(e){return e.text},getChipIcon:function(e){return Object(V.jsx)(Ll.a,{style:{marginLeft:4,marginTop:0,marginRight:0,marginBottom:0},className:"MuiChip-deleteIcon MuiChip-deleteIconSmall"})},getOptionSelected:function(e,t){return e.id===t},onChange:function(e,t){var n=[];t.forEach((function(e){void 0!==e.text?n.push(e.text):n.push(e)})),X(n)}})}),Object(V.jsx)(wr.a,{size:"small",variant:"outlined",endIcon:Object(V.jsx)(Nl.a,{}),disabled:"selected"===h&&(null==b||null==w)||"all"===h&&0===J.length,onClick:function(e){return H(e.currentTarget)},children:"GO"}),Object(V.jsx)(Ye.a,{variant:"menu",id:"compare-menu",anchorEl:U,open:Boolean(U),onClose:function(e){return H(null)},children:t.map((function(e){return Object(V.jsx)(Qe.a,{title:e.title,onClick:function(t){!function(e,t){D("");var n={type:e,params:{version:t}};"selected"===h?(n.params.filter=b,n.params.filter2=w):n.params.obs=J,F(n)}(e.jobType,e.version),H(null)},children:e.title},e.jobType)}))})]})]})})),Yl=[{value:.1,label:"10%"},{value:.25,label:"25%"},{value:.5,label:"50%"},{value:.75,label:"75%"},{value:1,label:"100%"},{value:1.5,label:"150%"},{value:2,label:"200%"},{value:3,label:"300%"},{value:4,label:"400%"},{value:5,label:"500%"}],Ql=[{value:200,label:"Extra Small"},{value:300,label:"Small"},{value:500,label:"Medium"},{value:800,label:"Large"}],$l=function(e){Object(O.a)(n,e);var t=Object(x.a)(n);function n(e){var a;return Object(j.a)(this,n),(a=t.call(this,e)).onLabelFontSizeUpdate=function(e){!isNaN(e)&&e>0&&(a.props.chartOptions.labelFontSize=e,a.props.handleChartOptions(a.props.chartOptions),a.setState({labelFontSize:e}))},a.onLabelFontSize=function(e){a.setState({labelFontSize:e.target.value}),a.onLabelFontSizeUpdate(e.target.value)},a.onLabelStrokeWidth=function(e){a.setState({labelStrokeWidth:e.target.value}),a.onLabelStrokeWidthUpdate(e.target.value)},a.onLabelStrokeWidthUpdate=function(e){!isNaN(e)&&e>=0&&(a.props.chartOptions.labelStrokeWidth=e,a.props.handleChartOptions(a.props.chartOptions),a.setState({labelStrokeWidth:e}))},a.onMinUIChange=function(e){a.setState({minColor:e})},a.onMaxUIChange=function(e){a.setState({maxColor:e})},a.onMinChange=function(e){var t=a.props,n=t.activeFeature,i=t.embeddingData,r=t.globalFeatureSummary[n.name];Object(f.find)(i,(function(e){return Aa(e)===n.embeddingKey})).type!==ie?r.customMin=isNaN(e)?void 0:e:r.customZMin=isNaN(e)?void 0:e,a.props.onDomain({name:n.name,summary:r})},a.onMaxChange=function(e){var t=a.props,n=t.activeFeature,i=t.embeddingData,r=t.globalFeatureSummary[n.name];Object(f.find)(i,(function(e){return Aa(e)===n.embeddingKey})).type!==ie?r.customMax=isNaN(e)?void 0:e:r.customZMax=isNaN(e)?void 0:e,a.props.onDomain({name:a.props.activeFeature.name,summary:r})},a.onMarkerOpacityChange=function(e,t){a.setState({opacity:t}),a.updateMarkerOpacity(t)},a.updateMarkerOpacity=function(e){var t=parseFloat(e);t>=0&&t<=1&&a.props.handleMarkerOpacity(t)},a.onUnselectedMarkerOpacityChange=function(e,t){a.setState({unselectedOpacity:t}),a.updateUnselectedMarkerOpacity(t)},a.updateUnselectedMarkerOpacity=function(e){var t=parseFloat(e);t>=0&&t<=1&&a.props.handleUnselectedMarkerOpacity(t)},a.openView=function(e){a.props.handleOpenView(e)},a.deleteView=function(e){a.props.handleDeleteView(e)},a.viewDetails=function(e,t){e.stopPropagation(),a.setState({selectedViewEl:e.currentTarget,selectedView:Object(f.find)(a.props.datasetViews,(function(e){return e.id===t}))})},a.copyView=function(e){var t=window.location.protocol+"//"+window.location.host+window.location.pathname;de(t+="#q="+encodeURIComponent(JSON.stringify({link:e})))},a.onPointSizeChange=function(e){a.props.handlePointSize(e.target.value)},a.onUnselectedPointSizeChange=function(e){a.props.handleUnselectedPointSize(e.target.value)},a.onChartSizeChange=function(e){var t=e.target.value;a.props.handleChartSize(t)},a.onShowGalleryLabelsChange=function(e){var t=a.props.chartOptions;t.showGalleryLabels=e.target.checked,a.props.handleChartOptions(t)},a.handleCloseViewDetails=function(){a.setState({selectedViewEl:null,selectedView:null})},a.onViewSaved=function(){a.props.handleDialog(ba)},a.onDatasetViewSaved=function(){a.props.handleDialog(ba)},a.state={opacity:e.markerOpacity,unselectedOpacity:e.unselectedMarkerOpacity,minColor:"",maxColor:"",labelFontSize:e.chartOptions.labelFontSize,labelStrokeWidth:e.chartOptions.labelStrokeWidth,selectedViewEl:null,selectedView:null},a.onLabelFontSizeUpdate=Object(f.debounce)(a.onLabelFontSizeUpdate,500),a.onLabelStrokeWidthUpdate=Object(f.debounce)(a.onLabelStrokeWidthUpdate,500),a.updateMarkerOpacity=Object(f.debounce)(a.updateMarkerOpacity,500),a.updateUnselectedMarkerOpacity=Object(f.debounce)(a.updateUnselectedMarkerOpacity,500),a}return Object(C.a)(n,[{key:"componentDidUpdate",value:function(e,t,n){var a=this;if(e.chartOptions.labelFontSize!==this.props.chartOptions.labelFontSize&&this.setState({labelFontSize:this.props.chartOptions.labelFontSize}),e.chartOptions.labelStrokeWidth!==this.props.chartOptions.labelStrokeWidth&&this.setState({labelStrokeWidth:this.props.chartOptions.labelStrokeWidth}),e.markerOpacity!==this.props.markerOpacity&&this.setState({opacity:this.props.markerOpacity}),e.unselectedMarkerOpacity!==this.props.unselectedMarkerOpacity&&this.setState({unselectedOpacity:this.props.unselectedMarkerOpacity}),e.activeFeature!==this.props.activeFeature){var i=null==this.props.activeFeature?null:this.props.globalFeatureSummary[this.props.activeFeature.name];if(null==this.props.activeFeature)this.setState({minColor:"",maxColor:""});else{var r=Object(f.find)(this.props.embeddingData,(function(e){return Aa(e)===a.props.activeFeature.embeddingKey}));null==r?this.setState({minColor:"",maxColor:""}):r.type!==ie?this.setState({minColor:null==i.customMin?"":i.customMin,maxColor:null==i.customMax?"":i.customMax}):this.setState({minColor:null==i.customZMin?"":i.customZMin,maxColor:null==i.customZMax?"":i.customZMax})}}}},{key:"render",value:function(){var e=this,t=this.props,n=t.activeFeature,a=t.chartOptions,i=t.chartSize,r=t.classes,o=t.compareActions,s=t.datasetViews,l=t.embeddingData,c=t.interpolator,u=t.pointSize,d=t.serverInfo,h=t.tab,p=t.textColor,v=t.unselectedPointSize,b=null==n?null:Object(f.find)(l,(function(e){return Aa(e)===n.embeddingKey})),m=this.state,g=m.unselectedOpacity,j=m.opacity,O=m.minColor,x=m.maxColor,y=m.selectedViewEl,S=m.selectedView;return Object(V.jsxs)("div",{className:r.root,children:[Object(V.jsx)(ql,{}),Object(V.jsx)(Zl,{compareActions:o}),S&&Object(V.jsx)(Cr.a,{id:"view-details",open:Boolean(y),anchorEl:y,onClose:this.handleCloseViewDetails,anchorOrigin:{vertical:"bottom",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"center"},children:Object(V.jsxs)("div",{style:{width:500},children:[S.last_updated&&Object(V.jsxs)(M.a,{children:["Last Updated: ",new Date(S.last_updated).toDateString()]}),S.notes&&Object(V.jsx)(Rr.a,{options:{overrides:ce},children:S.notes})]})}),Object(V.jsxs)("div",{style:"embedding"===h?null:{display:"none"},children:[Object(V.jsx)(yr.a,{}),Object(V.jsx)(M.a,{gutterBottom:!1,component:"h1",className:r.title,children:"View"}),Object(V.jsx)(Fo.a,{style:{marginTop:8},shrink:!0,children:"Marker Opacity"}),Object(V.jsx)(Tl.a,{min:0,max:1,step:.01,sx:{width:190,marginLeft:.5},valueLabelDisplay:"auto",value:j,onChange:this.onMarkerOpacityChange,"aria-labelledby":"continuous-slider"}),Object(V.jsx)(Fo.a,{style:{marginTop:8},shrink:!0,children:"Filtered Marker Opacity"}),Object(V.jsx)(Tl.a,{min:0,max:1,step:.01,sx:{width:190,marginLeft:.5},valueLabelDisplay:"auto",value:g,onChange:this.onUnselectedMarkerOpacityChange,"aria-labelledby":"continuous-slider"}),Object(V.jsxs)(eo.a,{className:r.formControl,children:[Object(V.jsx)(Fo.a,{htmlFor:"point_size",children:"Marker Size"}),Object(V.jsx)(Fr.a,{label:"Marker Size",labelId:"point_size",size:"small",className:r.select,onChange:this.onPointSizeChange,value:u,multiple:!1,children:Yl.map((function(e){return Object(V.jsx)(Qe.a,{value:e.value,children:Object(V.jsx)(Br.a,{primary:e.label})},e.label)}))})]}),Object(V.jsxs)(eo.a,{className:r.formControl,children:[Object(V.jsx)(Fo.a,{htmlFor:"filtered_point_size",children:"Filtered Marker Size"}),Object(V.jsx)(Fr.a,{label:"Filtered Marker Size",labelId:"filtered_point_size",size:"small",className:r.select,onChange:this.onUnselectedPointSizeChange,value:v,multiple:!1,children:Yl.map((function(e){return Object(V.jsx)(Qe.a,{value:e.value,children:Object(V.jsx)(Br.a,{primary:e.label})},e.label)}))})]}),Object(V.jsxs)(eo.a,{className:r.formControl,children:[Object(V.jsx)(Fo.a,{htmlFor:"chart_size",children:"Gallery Chart Size"}),Object(V.jsx)(Fr.a,{label:"Gallery Chart Size",labelId:"chart_size",size:"small",className:r.select,onChange:this.onChartSizeChange,value:i,multiple:!1,children:Ql.map((function(e){return Object(V.jsx)(Qe.a,{value:e.value,children:Object(V.jsx)(Br.a,{primary:e.label})},e.label)}))})]}),Object(V.jsx)("div",{children:Object(V.jsx)(Jo.a,{control:Object(V.jsx)(Lo.a,{checked:a.showGalleryLabels,onChange:this.onShowGalleryLabelsChange}),label:"Gallery Labels"})}),Object(V.jsx)(Yo,{textColor:p,interpolator:c,domain:b&&b.continuous&&"__count"!==b.name?b.colorScale.domain():null,min:O,max:x,onMinChange:this.onMinChange,onMaxChange:this.onMaxChange,onMinUIChange:this.onMinUIChange,onMaxUIChange:this.onMaxUIChange,onInterpolator:this.props.handleInterpolator}),Object(V.jsx)(eo.a,{className:r.formControl,children:Object(V.jsx)(qr.a,{value:this.state.labelFontSize,onChange:this.onLabelFontSize,size:"small",InputLabelProps:{shrink:!0},fullWidth:!0,label:"Label Font Size"})}),Object(V.jsx)(eo.a,{className:r.formControl,children:Object(V.jsx)(qr.a,{value:this.state.labelStrokeWidth,onChange:this.onLabelStrokeWidth,size:"small",InputLabelProps:{shrink:!0},fullWidth:!0,label:"Label Shadow Size"})})]}),d.capabilities.has("SERVER_CAPABILITY_LINKS")&&Object(V.jsxs)("div",{style:"embedding"===h||"distribution"===h||"composition"===h?null:{display:"none"},children:[Object(V.jsx)(yr.a,{}),Object(V.jsx)(M.a,{gutterBottom:!1,component:"h1",className:r.title,children:"Links"}),Object(V.jsx)(yr.a,{}),Object(V.jsx)(eo.a,{className:r.formControl,children:Object(V.jsx)(qe.a,{title:"Save Current Visualization State",children:Object(V.jsx)(T.a,{style:{float:"right",fontSize:"0.75rem"},onClick:this.onViewSaved,children:"Save"})})}),0===s.length&&Object(V.jsx)(Vi.a,{color:"text.secondary",children:"No saved links"}),s.length>0&&Object(V.jsx)(El.a,{dense:!0,style:{marginTop:10},children:s.map((function(t){return Object(V.jsxs)(Ps.a,{"data-key":t.id,button:!0,onClick:function(n){return e.openView(t.id)},children:[Object(V.jsx)(Br.a,{primary:t.name}),Object(V.jsxs)(zl.a,{children:[(t.notes||t.last_updated)&&Object(V.jsx)(Ze.a,{edge:"end","aria-label":"info",onClick:function(n){return e.viewDetails(n,t.id)},size:"small",children:Object(V.jsx)(Gr.a,{})}),Object(V.jsx)(Ze.a,{edge:"end","aria-label":"copy",onClick:function(n){return e.copyView(t.id)},size:"small",children:Object(V.jsx)(Cs.a,{})}),Object(V.jsx)(Ze.a,{edge:"end","aria-label":"delete",onClick:function(n){return e.deleteView(t.id)},size:"small",children:Object(V.jsx)(Ml.a,{})})]})]},t.id)}))})]}),Object(V.jsx)("div",{style:"results"===h?null:{display:"none"},children:Object(V.jsx)(Dl,{})})]})}}]),n}(i.a.PureComponent),ec=Object(P.a)((function(e){return{root:{display:"flex",flexDirection:"column",margin:e.spacing(0,.5)},title:{textTransform:"uppercase"},formControl:{display:"block",minWidth:200,maxWidth:200,marginBottom:e.spacing(1)},select:{minWidth:200}}}))(Object(o.b)((function(e){return{activeFeature:e.activeFeature,categoricalNames:e.categoricalNames,chartSize:e.chartSize,chartOptions:e.chartOptions,combineDatasetFilters:e.combineDatasetFilters,dataset:e.dataset,datasetFilter:e.datasetFilter,datasetFilters:e.datasetFilters,datasetViews:e.datasetViews,distributionPlotOptions:e.distributionPlotOptions,embeddingData:e.embeddingData,embeddingLabels:e.embeddingLabels,embeddings:e.embeddings,globalFeatureSummary:e.globalFeatureSummary,interpolator:e.interpolator,markerOpacity:e.markerOpacity,markers:e.markers,numberOfBins:e.numberOfBins,pointSize:e.pointSize,savedDatasetFilter:e.savedDatasetFilter,searchTokens:e.searchTokens,selection:e.selection,serverInfo:e.serverInfo,tab:e.tab,textColor:e.textColor,unselectedPointSize:e.unselectedPointSize,unselectedMarkerOpacity:e.unselectedMarkerOpacity}}),(function(e,t){return{handleDialog:function(t){e(vi(t))},handleTab:function(t){e(ji(t))},handleActiveFeature:function(t){e(Ja(t))},handleInterpolator:function(t){e({type:ra,payload:t})},handleChartSize:function(t){e({type:Ln,payload:t})},handleChartOptions:function(t){e(Ha(t))},onDomain:function(t){e(Qa(t))},handleCombineDatasetFilters:function(t){e(Wa(t))},removeDatasetFilter:function(t){e(Fa(t))},handleEmbeddings:function(t){e(Pi(t))},handlePointSize:function(t){e({type:oa,payload:t})},handleUnselectedPointSize:function(t){e({type:sa,payload:t})},handleMarkerOpacity:function(t){e({type:Qn,payload:t})},handleEmbeddingLabel:function(t){e(wi(t))},handleUnselectedMarkerOpacity:function(t){e({type:$n,payload:t})},handleSearchTokens:function(t,n){e(zi(null==t?[]:t,n))},handleOpenView:function(t){e(Da(t))},handleDeleteView:function(t){e(_a(t))},handleDeleteFeatureSet:function(t){e(Na(t))},handleSubmitJob:function(t){e(Ra(t))},onDistributionPlotOptions:function(t){e(Va(t))}}}))($l)),tc=[{title:"Differential Expression",jobType:"de",version:"1.0.0",tooltip:"Find differentially expressed features between two groups of cells"}],nc=n(41),ac=n(403);var ic=Object(P.a)({})(Object(o.b)((function(e){return{email:e.email,jobResultId:e.jobResult,jobResults:e.jobResults}}),(function(e,t){return{handleDeleteJob:function(t){e(function(e){return function(t,n){t(gi(!0)),n().dataset.api.deleteJob(e).then((function(){var a=n().jobResults,i=Object(f.findIndex)(a,(function(t){return t.id===e}));a.splice(i,1),n().jobResult===e&&t(Si(null)),t(yi(a.slice()))})).finally((function(){t(gi(!1))})).catch((function(e){Li(t,e,"Unable to delete result. Please try again.")}))}}(t))},handleJobResult:function(t){e(function(e){return function(t,n){var a=n().jobResults;if(null!=Object(f.find)(a,(function(t){return t.id===e})).data)return t(Si(e));t(gi(!0)),n().dataset.api.getJob(e,!0).then((function(a){var i=n().jobResults,r=Object.assign(Object(f.find)(i,(function(t){return t.id===e})),a);t(Si(r))})).finally((function(){t(gi(!1))})).catch((function(e){Li(t,e,"Unable to retrieve result. Please try again.")}))}}(t))}}}))((function(e){var t=Object(a.useState)(!1),n=Object(Xe.a)(t,2),i=n[0],r=n[1],o=Object(a.useState)(null),s=Object(Xe.a)(o,2),l=s[0],c=s[1],u=e.email,d=e.handleJobResult,h=e.handleDeleteJob,p=e.jobResults,f=e.jobResultId;function v(){r(!1)}function b(){c(null)}var m=function(){for(var e=0;e<p.length;e++){if(!(""+p[e].id).startsWith("cirro-"))return!0}return!1}(),g={},j=null==f&&p.length>0||p.length>1;return tc.forEach((function(e){return g[e.jobType]=e.title})),Object(V.jsxs)(V.Fragment,{children:[Object(V.jsx)(Bl.a,{container:!0,alignItems:"center",children:j&&Object(V.jsx)(wr.a,{size:"small",onClick:function(e){r(!0)},variant:"outlined",color:"primary",children:"Browse All Results"})}),Object(V.jsxs)(br.a,{open:null!=l,onClose:b,"aria-labelledby":"confirm-dialog-title","aria-describedby":"conform-dialog-description",children:[Object(V.jsx)(mr.a,{id:"confirm-dialog-title",children:"Confirm Delete"}),Object(V.jsx)(Jr.a,{children:Object(V.jsxs)(ac.a,{id:"confirm-dialog-description",children:["Are you sure you want to delete ",l?l.name:"","?"]})}),Object(V.jsxs)(_o.a,{children:[Object(V.jsx)(wr.a,{onClick:b,children:"Cancel"}),Object(V.jsx)(wr.a,{variant:"contained",onClick:function(e){return t=l.id,h(t),void c(null);var t},color:"primary",autoFocus:!0,children:"OK"})]})]}),Object(V.jsxs)(br.a,{onClose:v,"aria-labelledby":"job-results-title",open:i&&p.length>0,children:[Object(V.jsx)(mr.a,{id:"job-results-title",onClose:v,children:"Results"}),Object(V.jsx)(Jr.a,{children:Object(V.jsxs)(Hi.a,{size:"small",stickyHeader:!0,children:[Object(V.jsx)(Wi.a,{children:Object(V.jsxs)(Gi.a,{children:[Object(V.jsx)(Ji.a,{children:"Name"}),Object(V.jsx)(Ji.a,{children:"Type"}),m&&Object(V.jsx)(Ji.a,{children:"Status"})]})}),Object(V.jsx)(qi.a,{children:p.map((function(e){var t=e.name;e.title&&(t+=" - "+e.title);var n=(""+e.id).startsWith("cirro-"),a=n||"complete"===e.status,i=n?"complete":e.status,o=u==e.email||null===u&&""===e.email,s=g[e.type];return Object(V.jsxs)(Gi.a,{hover:!0,selected:e.id===f,onClick:a?function(t){return n=e.id,d(n),void r(!1);var n}:null,role:"checkbox",tabIndex:-1,children:[Object(V.jsx)(Ji.a,{children:t}),Object(V.jsx)(Ji.a,{children:s}),m&&Object(V.jsxs)(Ji.a,{children:[i,o&&!n&&Object(V.jsx)(Ze.a,{edge:"end","aria-label":"delete",onClick:function(t){return function(e,t){e.stopPropagation(),c(t)}(t,e)},size:"large",children:Object(V.jsx)(Ml.a,{})})]})]},e.id)}))})]})})]})]})})));var rc=Object(o.b)((function(e){return{jobResultId:e.jobResult,jobResults:e.jobResults,tab:e.tab}}),(function(e,t){return{}}))((function(e){var t=e.setTooltip,n=e.jobResultId,a=e.jobResults,i=null!=n?Object(f.find)(a,(function(e){return e.id===n})):null,r=null!=i?i.type:null;return Object(V.jsxs)(V.Fragment,{children:[Object(V.jsx)(ic,{}),"de"==r&&Object(V.jsx)(nr,{setTooltip:t,jobResult:i})]})})),oc=240,sc=function(e){Object(O.a)(n,e);var t=Object(x.a)(n);function n(e){var a;return Object(j.a)(this,n),(a=t.call(this,e)).handleMessageClose=function(){a.props.setMessage(null)},a.onGallery=function(){window.scrollTo(0,a.galleryRef.current.offsetTop)},a.setTooltip=function(e){e=""===e||null==e?"&nbsp;":e,a.tooltipElementRef.current.innerHTML=e},a.tooltipElementRef=i.a.createRef(),a.galleryRef=i.a.createRef(),a}return Object(C.a)(n,[{key:"render",value:function(){var e=this.props,t=e.theme,n=e.dataset,a=e.dialog,i=e.loading,r=e.loadingApp,o=e.message,s=e.tab,l=t.palette.primary.main,c=t.palette.background.paper;return Object(V.jsxs)(Vi.a,{sx:{display:"flex"},children:[(a===fa||a===va)&&Object(V.jsx)(Ts,{}),a===ja&&Object(V.jsx)(No,{}),a===ba&&Object(V.jsx)(wl,{}),a===ga&&Object(V.jsx)(yl,{}),a===ma&&Object(V.jsx)(kl,{}),Object(V.jsx)(io,{}),Object(V.jsx)(gr.a,{variant:"permanent",anchor:"left",sx:{width:oc,flexShrink:0,"& .MuiDrawer-paper":{width:oc,boxSizing:"border-box"}},children:null!=n&&Object(V.jsx)(ec,{compareActions:tc},n.id)}),Object(V.jsxs)(Vi.a,{scomponent:"main",sx:{flexGrow:1,paddingBottom:24,color:l,backgroundColor:c},children:[Object(V.jsx)(Er.a,{}),r.loading&&Object(V.jsx)("div",{children:Object(V.jsxs)("h2",{children:["Loading",Object(V.jsx)(jr.a,{style:{width:"90%"},variant:"determinate",value:r.progress})]})}),null==n&&!i&&!r.loading&&Object(V.jsx)("div",{children:Object(V.jsx)(Ol,{})}),null!=n&&Object(V.jsxs)(V.Fragment,{children:[Object(V.jsxs)("div",{role:"tabpanel",hidden:"embedding"!==s,children:[Object(V.jsx)(pl,{onGallery:this.onGallery,setTooltip:this.setTooltip}),Object(V.jsx)(xs,{}),Object(V.jsx)("div",{ref:this.galleryRef,children:Object(V.jsx)(gl,{})})]}),Object(V.jsx)("div",{role:"tabpanel",hidden:"distribution"!==s,children:Object(V.jsx)(Os,{setTooltip:this.setTooltip})}),Object(V.jsx)("div",{role:"tabpanel",hidden:"composition"!==s,children:Object(V.jsx)(Do,{})}),Object(V.jsx)("div",{role:"tabpanel",hidden:"results"!==s,children:Object(V.jsx)(rc,{setTooltip:this.setTooltip})}),Object(V.jsx)(M.a,{className:"cirro-condensed",color:"textPrimary",ref:this.tooltipElementRef,style:{position:"fixed",background:c,width:"100%",bottom:0,top:"auto",marginBottom:0,whiteSpace:"nowrap",textOverflow:"ellipsis"},children:"\xa0"})]})]}),i&&Object(V.jsx)(br.a,{"aria-labelledby":"loading-dialog-title",open:!0,children:Object(V.jsxs)(mr.a,{id:"loading-dialog-title",children:[Object(V.jsx)(vr.a,{size:20})," Loading..."]})}),null!=o&&Object(V.jsx)(fr.a,{anchorOrigin:{vertical:"bottom",horizontal:"left"},ContentProps:{"aria-describedby":"message-id"},onClose:this.handleMessageClose,open:!0,autoHideDuration:6e3,action:[Object(V.jsx)(Ze.a,{"aria-label":"Close",color:"inherit",onClick:this.handleMessageClose,size:"large",children:Object(V.jsx)(xr.a,{})},"close")],message:Object(V.jsx)("span",{id:"message-id",children:o instanceof Error?o.message:o})})]})}}]),n}(a.PureComponent),lc=Object(nc.d)(Object(o.b)((function(e){return{dataset:e.dataset,dialog:e.dialog,loading:e.loading,loadingApp:e.loadingApp,message:e.message,tab:e.tab}}),(function(e){return{handleDialog:function(t){e(vi(t))},setMessage:function(t){e(pi(t))}}}))(sc)),cc=Object(pr.a)({palette:{mode:"dark"}}),uc=Object(pr.a)({palette:{mode:"light"}});var dc=Object(o.b)((function(e){return{chartOptions:e.chartOptions}}),{})((function(e){var t=e.chartOptions.darkMode?cc:uc;return Object(V.jsx)(dr.a,{injectFirst:!0,children:Object(V.jsx)(hr.a,{theme:t,children:Object(V.jsx)(lc,{})})})})),hc=n(152),pc=n.n(hc),fc=!1,vc=Object(s.c)(ur,Object(s.a)(l.a,(function(e){return function(e){return function(t){return t.type===Un&&t.payload.mixpanel&&(pc.a.init(t.payload.mixpanel),fc=!0),fc&&(t.type===ua?pc.a.track("Open Dataset",{name:t.payload.name,id:t.payload.id}):t.type===la&&pc.a.identify(t.payload)),e(t)}}})));vc.dispatch((function(e,t){e(Oi({loading:!0,progress:0}));var n=(new Date).getTime();if(window.setTimeout((function a(){if(t().loadingApp.loading){var i=((new Date).getTime()-n)/1e3,r=Math.min(100,i/10*100);e(Oi({loading:!0,progress:r})),r<100&&window.setTimeout(a,300)}}),500),"true"===Object({NODE_ENV:"production",PUBLIC_URL:".",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_VERSION:"1.1.2-2.post2"}).REACT_APP_STATIC){var a={clientId:"",capabilities:new Set};return a.api=new Ft,e(ai(a)),e(Oi({loading:!1})),e(Bi()).then((function(){e(li())})),Promise.resolve()}var i=window.location.search.substring(1),r=null;return i.length>0&&i.split("&").forEach((function(e){var t=e.split("=");2!==t.length||"url"!==t[0]&&"id"!==t[0]||(r=t[1])})),fetch(Cn+"/server").then((function(e){return e.json()})).then((function(t){t.api=new Nt,null==t.clientId&&(t.clientId="");var a=new Set;for(var i in t.capabilities)t.capabilities[i]&&a.add(i);if(t.capabilities=a,e(ai(t)),""===t.clientId||null==t.clientId)e(Oi({loading:!1})),e(Ei(a.has(X)?"":null)),a.has(X)&&e(ni({importer:!0})),null==r?e(Bi()).then((function(){e(li())})):(e(mi([{id:r,url:r,name:r,description:""}])),e(li()));else{console.log(((new Date).getTime()-n)/1e3+" startup time");var o=document.createElement("script");o.type="text/javascript",o.src="https://apis.google.com/js/api.js",o.onload=function(n){window.gapi.load("client:auth2",(function(){window.gapi.client.init({clientId:t.clientId,scope:kn.join(" ")}).then((function(){e(Oi({loading:!1,progress:0})),e(ci(!0))}))}))},document.getElementsByTagName("head")[0].appendChild(o)}})).catch((function(t){console.log(t),e(Oi({loading:!1,progress:0})),Li(e,"Unable to load app. Please try again.")}))})),Object(r.render)(Object(V.jsx)(o.a,{store:vc,children:Object(V.jsx)(dc,{})}),document.getElementById("root"))}},[[269,1,2]]]);
//# sourceMappingURL=main.97f96c17.chunk.js.map